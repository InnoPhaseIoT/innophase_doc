<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prerequisites &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Prerequisites</a><ul>
<li><a class="reference internal" href="#install-talaria-two-sdk">Install Talaria TWO SDK</a></li>
<li><a class="reference internal" href="#required-software">Required Software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#talaria-two-software-crash">Talaria TWO Software Crash</a><ul>
<li><a class="reference internal" href="#generate-coredump-from-within-gdb">Generate Coredump from within GDB</a></li>
</ul>
</li>
<li><a class="reference internal" href="#analyzing-the-coredump">Analyzing the Coredump</a><ul>
<li><a class="reference internal" href="#capturing-a-back-trace">Capturing a Back Trace</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Prerequisites</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/1. Getting Started/3. Debugging an Application/2. Coredump Generation and Analysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>This section describes the procedure for generating a core dump and
analyzing it to understand the possible reasons for the software crash.</p>
<section id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h1>
<section id="install-talaria-two-sdk">
<h2>Install Talaria TWO SDK<a class="headerlink" href="#install-talaria-two-sdk" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Download Talaria TWO FreeRTOS SDK from the InnoPhase portal:
<a class="reference external" href="https://innophaseiot.com/portal/portal-hub/">https://innophaseiot.com/portal/portal-hub/</a></p></li>
<li><p>Unzip the SDK in an appropriate location as per requirement.</p></li>
</ol>
</section>
<section id="required-software">
<h2>Required Software<a class="headerlink" href="#required-software" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>PC with Ubuntu 20.04 (or higher).</p></li>
<li><p>GNU GDB v.10.1 (or higher).</p></li>
</ol>
<p><strong>Note</strong>: For details regarding Linux set-up, refer the following
document: UG_Environment_Setup_for_Linux.pdf.</p>
</section>
</section>
<section id="talaria-two-software-crash">
<h1>Talaria TWO Software Crash<a class="headerlink" href="#talaria-two-software-crash" title="Link to this heading"></a></h1>
<p>When the application on Talaria TWO crashes, a coredump file can be
generated. Coredump captures the working memory of the application and
firmware and generates a coredump file that is used for analyzing the
cause of the crash.</p>
<p>Following method is used to collect the coredump:</p>
<p>Assuming Talaria TWO has already crashed for a particular reason and is
currently in a crashed state, open a new terminal window in Linux and
execute the commands mentioned in the following section to collect core
dump.</p>
<section id="generate-coredump-from-within-gdb">
<h2>Generate Coredump from within GDB<a class="headerlink" href="#generate-coredump-from-within-gdb" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Execute the following command in VM UBUNTU Linux shell</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>echo “set auto-load safe-path /” &gt; ~/.gdbinit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Change directory to conf folder in SDK</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd ~/sdks/sdk_x.y</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>Execute the following command from the same shell as mentioned in
step 2</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>openocd -s ./conf -f ftdi.cfg -f t2.cfg</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Let the openocd run in the current shell and open a new Linux shell
to execute the following. The output of the openocd execution is
shown in Figure 1.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image110.png"><img alt="Text Description automatically generated" src="../../_images/image110.png" style="width: 4.33071in; height: 2.76947in;" /></a></p>
<p>Figure : Terminal output</p>
<ol class="arabic simple" start="5">
<li><p>Execute the following command from apps folder</p></li>
</ol>
<p><strong>Note</strong>: The default elf given with the SDK package under bin will be a
stripped one and this cannot be used for coredump analysis. Hence, do a
make for the application which needs to be tested and use the elf from
the out folder.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>gdb-multiarch ./my_test.elf</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><p>gdb session will start now and execute the command ocd in GDB
session.</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>(gdb) ocd</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="7">
<li><p>Collect the core dump using the following command:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>(gdb) coredump coredump_any_filename.bin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="8">
<li><p>Core dump is collected in coredump_any_filename.bin.</p></li>
<li><p>Core dump file can be opened using xxd editor to check the content\
from the Linux shell.</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>xxd coredump_any_filename.bin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Output for the sample elf is as shown in Figure 2.</p>
<p><a class="reference internal" href="../../_images/image210.png"><img alt="image1" src="../../_images/image210.png" style="width: 5.11811in; height: 3.21041in;" /></a></p>
<p>Figure : Opening the coredump file</p>
</section>
</section>
<section id="analyzing-the-coredump">
<h1>Analyzing the Coredump<a class="headerlink" href="#analyzing-the-coredump" title="Link to this heading"></a></h1>
<p>The coredump analysis will be done after capturing the coredump file to
identify the section of the code that caused the crash. The following
procedure describes the core dump analysis.</p>
<ol class="arabic simple">
<li><p>Start GDB server with the coredump file from the SDK directory:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/gdbremote.py –core coredump.bin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>and the GDB will start listening on port 3333.</p>
<p><a class="reference internal" href="../../_images/image310.png"><img alt="image2" src="../../_images/image310.png" style="width: 6.53543in; height: 0.53943in;" /></a></p>
<p>Figure : GDB listening on port 3333</p>
<ol class="arabic simple" start="2">
<li><p>Start GDB to inspect the coredump in a separate terminal from the SDK
directory:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>gdb-multiarch apps/my-program.elf</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>and the GDB prompt is observed.</p>
<ol class="arabic simple" start="3">
<li><p>In the GDB prompt execute the following command:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>(gdb) target remote localhost:3333</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The following output is observed once the remote debugging has started.</p>
<p><a class="reference internal" href="../../_images/image410.png"><img alt="image3" src="../../_images/image410.png" style="width: 5.51181in; height: 2.76363in;" /></a></p>
<p>Figure : Remote debugging</p>
<section id="capturing-a-back-trace">
<h2>Capturing a Back Trace<a class="headerlink" href="#capturing-a-back-trace" title="Link to this heading"></a></h2>
<p>Backtrace shows the point of crash which helps identify the problem. It
shows the contents of the stack. In this section, the analysis of the
coredump is done for two applications that has crashed for different
reasons.</p>
<p><strong>Sample application-1:</strong></p>
<ol class="arabic simple">
<li><p>Execute the following instruction:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>(gdb) bt</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The bt instructions prints the content of the stack.</p>
<p><a class="reference internal" href="../../_images/image510.png"><img alt="image4" src="../../_images/image510.png" style="width: 6.29921in; height: 1.89035in;" /></a></p>
<p>Figure : Contents of the stack</p>
<ol class="arabic simple" start="2">
<li><p>Execute the instruction list_thread to display the address of the
thread and the last thread executed prior to the crash. In the sample
app sensor.elf, a thread with the name app is executed prior to the
crash. The thread app is indicated with * mark as shown in Figure 6
when the list_thread instruction is executed.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image61.png"><img alt="Text Description automatically generated with medium confidence" src="../../_images/image61.png" style="width: 4.72441in; height: 2.1846in;" /></a></p>
<p>Figure : app - list_thread instruction</p>
<ol class="arabic simple" start="3">
<li><p>The address of the app thread of the sensor application as shown in
Figure 6 is 0xb9738. Now, resolve thread &lt;address of the thread&gt;
instruction is executed to point to the location of the instruction
in the code that was executed just before the crash.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image71.png"><img alt="image5" src="../../_images/image71.png" style="width: 6.53543in; height: 1.35468in;" /></a></p>
<p>Figure : Resolve thread instruction</p>
<ol class="arabic simple" start="4">
<li><p>Last instruction executed was from the file sensor/main.c at line
number 525. An assert function was called to crash the application at
this point.</p></li>
</ol>
<p>This helps identify the problem by pointing to the last instruction
executed prior to the crash that could be the reason for the crash.</p>
<p><strong>Sample application 2:</strong></p>
<ol class="arabic simple">
<li><p>The coredump for the sample application 2 is captured using the same
procedure described in section: <em>Generate Coredump from within GDB</em>.</p></li>
<li><p>The output of list_threads instruction for the sample application 2
displays the following:</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image81.png"><img alt="Shape, rectangle Description automatically generated" src="../../_images/image81.png" style="width: 5.90551in; height: 1.91888in;" /></a></p>
<p>Figure : list_threads output</p>
<ol class="arabic simple" start="3">
<li><p>The last thread executed just before the crash is wifi as shown in
Figure 8. However, when the restore_thread command is executed, the
following output is observed:</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image91.png"><img alt="image6" src="../../_images/image91.png" style="width: 5.90551in; height: 0.41391in;" /></a></p>
<p>Figure : restore_thread output</p>
<p>Looking back at the crash log captured in the download tool’s console,
The PC and BFAR values shows that address 0x60dbc (callback from the
app) tries to access address 0xc0073 (outside RAM area). This is done in
an interrupt context and is the reason why the list_threads do not
provide the right information running in process context.</p>
<p><a class="reference internal" href="../../_images/image101.png"><img alt="Table Description automatically generated" src="../../_images/image101.png" style="width: 3.93701in; height: 3.07432in;" /></a></p>
<p>Figure : Download tool - crash log</p>
<ol class="arabic simple" start="4">
<li><p>When the restore_thread is executed for a different thread – mqttcli,
the following output is observed:</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image112.png"><img alt="image7" src="../../_images/image112.png" style="width: 5.90551in; height: 1.43585in;" /></a></p>
<p>Figure : restore_thread for - mqttcli</p>
<p>It is observed that there is no message Thread stack does not seem to
have a pushed exception frame when the restore_thread command is
executed. This is checked on the mqttcli thread as this thread is
receiving the data from a callouts handler that is executing in the
interrupt context. After checking the mqttcli thread, it is observed
that the reason for the crash is because a pointer is accessed and freed
with out allocating any memory for it.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>