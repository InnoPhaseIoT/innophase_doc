<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heartbeat Monitor Application &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Heartbeat Monitor Application</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#command-description">Command Description</a></li>
<li><a class="reference internal" href="#procedure">Procedure</a></li>
<li><a class="reference internal" href="#expected-output">Expected Output</a><ul>
<li><a class="reference internal" href="#host-console-logs">Host Console Logs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#list-of-message-ids-used">List of Message IDs Used</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Heartbeat Monitor Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/3. Software Reference/4. Example Applications/Heartbeat Monitor Application.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="heartbeat-monitor-application">
<h1>Heartbeat Monitor Application<a class="headerlink" href="#heartbeat-monitor-application" title="Link to this heading"></a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<p>Heartbeat monitor application demonstrates use of custom indications in
Dual-Stack custom applications. It monitors heartbeat failure.</p>
<p>Under normal Dual-Stack working, if Talaria TWO crashes or hangs, the
host application will be unable to detect it. The heartbeat feature is
implemented to avoid this. Every 10 seconds, the host sends a heartbeat
signal to Talaria TWO. Talaria TWO acknowledges this by sending an
indication of its normal working. If Talaria TWO stops responding, the
host detects this issue notifies this in the custom application:
heartbeat_monitor.</p>
<p>The custom application is located in <em>hapi/dual_stack/bins</em> folder.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>GTKTerm or similar application.</p></li>
<li><p>Start the tunadapter with heartbeat=1.</p></li>
</ol>
</section>
<section id="command-description">
<h2>Command Description<a class="headerlink" href="#command-description" title="Link to this heading"></a></h2>
<p>Enable the heartbeat feature. By default, the heartbeat feature is
disabled.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./tunadapter heartbeat=1&amp;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Monitor heartbeat failure.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>$./heartbeat_monitor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Link to this heading"></a></h2>
<p>Execute the following operations on Talaria TWO:</p>
<p><strong>Step 1</strong>: Start the tunadapter with heartbeat=1.</p>
<p><strong>Step 2</strong>: Heartbeat message is sent every 10 seconds, which is fixed.</p>
<p><strong>Step 3</strong>: Run the custom application (heartbeat_monitor), to monitor
heartbeat feature.</p>
<p><strong>Step 4</strong>: When Talaria TWO crashes or is out-of-sync with the host,
the host notifies the custom application and displays the same.</p>
<p><strong>Step 5</strong>: The custom application waits for the indication message from
the host and once received, prints the message.</p>
</section>
<section id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Link to this heading"></a></h2>
<section id="host-console-logs">
<h3>Host Console Logs<a class="headerlink" href="#host-console-logs" title="Link to this heading"></a></h3>
<p><a class="reference internal" href="../../_images/image149.png"><img alt="image1" src="../../_images/image149.png" style="width: 1.575in; height: 0.26531in;" /></a><a class="reference internal" href="../../_images/image149.png"><img alt="image2" src="../../_images/image149.png" style="width: 1.50833in; height: 0.35in;" /></a><a class="reference internal" href="../../_images/image228.png"><img alt="A computer screen shot of a black screen Description automatically generated" src="../../_images/image228.png" style="width: 6.96042in; height: 5.48681in;" /></a></p>
<p><a class="reference internal" href="../../_images/image324.png"><img alt="A screen shot of a computer program Description automatically generated" src="../../_images/image324.png" style="width: 6.96042in; height: 1.50694in;" /></a></p>
<p>Figure 4: Heartbeat monitor - Host console logs</p>
<p>Host serial log – text output:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>[root&#64;:]# ./tunadapter heartbeat=1 &amp;</p>
<p>[root&#64;:]# heartbeat=1</p>
<p>./tunadapter: platform=&lt;host&gt;_SDIO</p>
<p>Opening Serial device /dev/wlanSDIO0</p>
<p>Speed=10000000</p>
<p>[ 45.335718] sw_open</p>
<p>hapi_recv_thread:943 DEBUG:recv thread entry</p>
<p>wakeup gpio(gpio_63) conf success</p>
<p>in hapi_wakeup_config. dev=/sys/class/gpio/gpio63/value</p>
<p>wakeup_fd = 4</p>
<p>hapi_config:1526 DEBUG:hapi_config. 14 1 0 0</p>
<p>hapi_config:1586 DEBUG:before calling hio_query</p>
<p>hapi_hio_query:352 DEBUG:Connected to T2, max packet size is 4092</p>
<p>hapi_hio_query:353 DEBUG:Firmware version: , patch version</p>
<p>hapi_hio_query:354 DEBUG:Hapi version: 1</p>
<p>hapi_config:1588 DEBUG:after calling hio_query</p>
<p>hapi init:start</p>
<p>Registering Wake up Indication Handlers</p>
<p>Registering Shutdown Indication Handlers</p>
<p>hapi init:done</p>
<p>dual_stack_status:0:0:0</p>
<p>dual_stack_ver:e4f2ebcd:FREERTOS_SDK_1.0:1.0.05</p>
<p>port:70-40000</p>
<p>dual_stack_sockid:-1:-1:-1</p>
<p>Creating tun interface</p>
<p>Initialising tun interface</p>
<p>hapi_wcm_create:105 DEBUG:WiFi interface created with mac addr:
00:00:00:00:18:1F</p>
<p>Regsitering WCM Indication Handlers</p>
<p>heartbeat[10-30000] conf done</p>
<p>waiting for data from tun….</p>
<p>ptsname:/dev/pts/0</p>
<p>[root&#64;:]# ./heartbeat_monitor &amp;</p>
<p>[root&#64;:]# register_custom_inds. num=1</p>
<p>custom_ind_msgq created—-</p>
<p>registering ind. g=0x54, m=0xc0</p>
<p>register_custom_inds. num=1. done</p>
<p>dualstack custom ind reg success.!</p>
<p>calling msgrcv.rxmsg size=136, payload size=132,long=4</p>
<p>hapi_show_packet_infos:189
DEBUG:pkt_out:0x005b0c40,group=0x55,msg=0x00,trxid=0006</p>
<p>hapi_show_packet_infos:189 DEBUG:
pkt_in:0x769004f0,group=0x55,msg=0xc1,trxid=0000</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>In case of heartbeat failure, host prints the following hexdump on the
console:</p>
<p><a class="reference internal" href="../../_images/image424.png"><img alt="A screen shot of a computer Description automatically generated" src="../../_images/image424.png" style="width: 7.48031in; height: 1.78668in;" /></a></p>
<p>Figure 5: Heartbeat failure hexdump</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>heartbeat timeout</p>
<p>calling msgsnd. txmsg size=136, payload size=132,long=4</p>
<p>deliver_ind_to_custom_app: status=0</p>
<p>Heartbeat failed..</p>
<p>Hexdump of rx msg, len=32</p>
<p>17 12 00 00 54 C0 04 00 00 00 00 00 00 00 00 00 | ….T………..</p>
<p>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 | …………….</p>
<p>group_id—–&gt;0x54,msg_id ::0xc0,len=0x4,Hexdump of ind data, len=4</p>
<p>00 00 00 00</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="list-of-message-ids-used">
<h2>List of Message IDs Used<a class="headerlink" href="#list-of-message-ids-used" title="Link to this heading"></a></h2>
<p>This application demonstrates the use of custom indications in
Dual-Stack custom apps and uses Group number 84. Following is the
message ID used:</p>
<ol class="arabic simple">
<li><p>HEARTBEAT_MONITOR_FAILED_IND</p></li>
</ol>
<p>This message is sent to indicate heartbeat failure.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>