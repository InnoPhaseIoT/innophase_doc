<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IoT AWS &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Second Stage Boot Loader" href="4.%20SSBL.html" />
    <link rel="prev" title="Alarm" href="2.%20Alarm.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting%20Started/Getting%20Started%20-%20Landing%20Page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Hardware%20Reference/Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Porting%20Guide/Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Disclaimers/Disclaimers.html">Disclaimer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Appendix/Appendix-Landing_Page.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Support/Support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Software%20Reference/Software_Reference_Landing_Page.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Development%20Environments/Development%20Environments%20-%20Landing%20Page.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Tools/Tools-landing%20page.html">Tools</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html">Applications</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#apps">Apps</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1.%20Alexa_Ready_Application_with_AWS_IoT_Embedded_C_Device_SDK.html">Alexa_Ready_Application_with_AWS_IoT_Embedded_C_Device_SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="2.%20Alarm.html">Alarm</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">IoT AWS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#aws-iot-device-sdk-embedded-c-on-talaria-two-platform">AWS IoT Device SDK Embedded C On Talaria TWO Platform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cloning-talaria-two-aws-repository">Cloning talaria_two_aws Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="#patching-aws-iot-device-sdk-embedded-c-for-talaria-two-sdk-compatibility">Patching AWS IoT Device SDK Embedded C for Talaria TWO SDK Compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-aws-iot-freertos-sdk-and-sample-applications">Compiling AWS IoT FreeRTOS SDK and Sample Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#folder-structure-talaria-two-aws-repository">Folder Structure talaria_two_aws Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview-of-sample-applications">Overview of Sample Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subscribe-publish-sample">Subscribe-Publish Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shadow-sample">Shadow Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jobs-sample">Jobs Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensor2cloud-aws">Sensor2Cloud- AWS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aws-set-up">AWS Set-up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-vm-based-applications">Programming VM-based applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-talaria-two-board-with-certificates">Programming Talaria TWO Board with Certificates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-file-system-contents">Show File System Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-files">Write Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-talaria-two-board-with-elf">Programming Talaria TWO board with ELF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mqtt-publish-and-subscribe">MQTT Publish and Subscribe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subscribe">Subscribe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-sample-application">Running the Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publish">Publish</a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-shadow">Device Shadow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-sample-application-1">Running the Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-jobs">Running Jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-job-in-aws">Creating a job in AWS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-sample-application-2">Running the Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Sensor2Cloud – AWS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-settings-and-evb-sensors">Hardware Settings and EVB Sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-sample-application-3">Running the Sample Application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="4.%20SSBL.html">Second Stage Boot Loader</a></li>
<li class="toctree-l3"><a class="reference internal" href="5.%20Firmware_Over-The-Air-Upgrade.html">Firmware Over The Air</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#examples">Examples</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Regulatory%20Notices/Regulatory%20Notices.html">FCC/ISED Regulatory Notices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Applications%20-%20Landing%20Page.html">Applications</a></li>
      <li class="breadcrumb-item active">IoT AWS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Applications/1. Apps/3. IoT_AWS.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="iot-aws">
<h1>IoT AWS<a class="headerlink" href="#iot-aws" title="Permalink to this heading"></a></h1>
<p>The applications discussed in this document provide a brief on using
Talaria TWO board and the FreeRTOS SDK with Amazon Web Services (AWS)
IoT Core.</p>
<p>More information on the AWS IoT developer guide can be found at:
<a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/">https://docs.aws.amazon.com/iot/latest/developerguide/</a>.</p>
<section id="aws-iot-device-sdk-embedded-c-on-talaria-two-platform">
<h2>AWS IoT Device SDK Embedded C On Talaria TWO Platform<a class="headerlink" href="#aws-iot-device-sdk-embedded-c-on-talaria-two-platform" title="Permalink to this heading"></a></h2>
<p>Version v3.1.5 of aws-iot-device-sdk-embedded-C is ported on Talaria TWO
platform. The port along with the sample applications, is available as a
public Github repository here:
<a class="reference external" href="https://github.com/InnoPhaseIoT/talaria_two_aws">https://github.com/InnoPhaseIoT/talaria_two_aws</a></p>
<p>More information on aws-iot-device-sdk-embedded-C release tag v3.1.5 is
available here:
<a class="reference external" href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/v3.1.5">https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/v3.1.5</a></p>
<p>API Documentation and other details specific to AWS IoT Device SDK
Embedded C release tag V3.1.5 is available here:
<a class="reference external" href="http://aws-iot-device-sdk-embedded-c-docs.s3-website-us-east-1.amazonaws.com/index.html">http://aws-iot-device-sdk-embedded-c-docs.s3-website-us-east-1.amazonaws.com/index.html</a></p>
<p>Follow the instructions in the subsequent sections to clone, patch and
compile the repository with Talaria TWO FreeRTOS SDK.</p>
</section>
<section id="cloning-talaria-two-aws-repository">
<h2>Cloning talaria_two_aws Repository<a class="headerlink" href="#cloning-talaria-two-aws-repository" title="Permalink to this heading"></a></h2>
<p>Create a new folder in any location and clone the talaria_two_aws
repository using the following command:</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">Table : talaria_two_aws repository contents</span><a class="headerlink" href="#id5" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>git clone –recursive
<a class="reference external" href="https://github.com/InnoPhaseIoT/talaria_two_aws.git">https://github.com/InnoPhaseIoT/talaria_two_aws.git</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: This repository uses <a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">Git
Submodules</a> for
its dependencies. The option –recursive is required to clone the Git
Submodule repository, further required by talaria_two_aws repository.</p>
</section>
<section id="patching-aws-iot-device-sdk-embedded-c-for-talaria-two-sdk-compatibility">
<h2>Patching AWS IoT Device SDK Embedded C for Talaria TWO SDK Compatibility<a class="headerlink" href="#patching-aws-iot-device-sdk-embedded-c-for-talaria-two-sdk-compatibility" title="Permalink to this heading"></a></h2>
<p>After the clone is complete as described in section: Cloning
talaria_two_aws Repository, move the folder talaria_two_aws to the
following path: <em>&lt;freertos_sdk_path&gt;\apps\</em>.</p>
<p>Go to (cd) the following directory:
<em>&lt;freertos_sdk_path&gt;\apps\talaria_two_aws\aws-iot-device-sdk-embedded-C</em>
and execute the following command to patch AWS IoT Device SDK for
Talaria TWO compatibility.</p>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Table : AWS Certificates</span><a class="headerlink" href="#id6" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>&lt;f
reertos_sdk_path&gt;/apps/talaria_two_aws/aws-iot-device-sdk-embedded-C$
git apply ../patches/t2_compatibility.patch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: Patching needs to be done only once after cloning is
successful.</p>
</section>
<section id="compiling-aws-iot-freertos-sdk-and-sample-applications">
<h2>Compiling AWS IoT FreeRTOS SDK and Sample Applications<a class="headerlink" href="#compiling-aws-iot-freertos-sdk-and-sample-applications" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Once the patch is applied successfully, running Make from
<em>&lt;freertos_sdk_path&gt;/apps/talaria_two_aws</em> will compile the AWS IoT
SDK along with the Talaria TWO specific Platform Adaptation Layer and
Sample Applications ported to Talaria TWO.</p></li>
<li><p>On running Make, the binaries for the various sample applications
will be created in the out folder in their individual paths:
<em>&lt;freertos_sdk_path&gt;/apps/talaria_two_aws/samples/&lt;application_folder&gt;/out</em>.</p></li>
<li><p>Applications can have their own custom configurations for FreeRTOS
SDK, based on their own needs, and the customized aws_iot_config.h
file can be included by individual applications at the time of
compiling the AWS IoT FreeRTOS SDK.</p></li>
<li><p>All the sample applications use their own individually customizable
aws_iot_config.h file at the following path:
<em>&lt;freertos_sdk_path&gt;/apps/talaria_two_aws/samples/&lt;application_folder&gt;/src/aws_iot_config.h</em>.</p></li>
</ol>
</section>
<section id="folder-structure-talaria-two-aws-repository">
<h2>Folder Structure talaria_two_aws Repository<a class="headerlink" href="#folder-structure-talaria-two-aws-repository" title="Permalink to this heading"></a></h2>
<p>talaria_two_aws repository includes the following directories/files:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Direct
ory/File</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ul class="simple">
<li></li>
</ul>
<p>aws-iot-de
vice-sdk-e
mbedded-C*</p>
</td>
<td><p>AWS IoT Device SDK Embedded-C Release Tag v3.1.5</p></td>
</tr>
<tr class="row-odd"><td><p><em>patches</em></p></td>
<td><p>Patch file t2_compatibility.patch for AWS IoT Device
SDK V3.1.5 for Talaria TWO compatibility</p></td>
</tr>
<tr class="row-even"><td><p><em>talari
a_two_pal</em></p></td>
<td><p>Platform Adaptation Layer with Talaria TWO platform
specific porting for all supported OS, needed to adapt
to AWS IoT SDK</p></td>
</tr>
<tr class="row-odd"><td><p><em>sa
mple_apps</em></p></td>
<td><p>Samples provided by the AWS IoT SDK covering Thing
Shadow, Jobs and Subscribe/Publish which are ported to
Talaria TWO for all the supported OS. Changes done for
porting the sample applications are related to APIs
used to connect to the network, passing connection
params as boot arguments and using dataFS for storing
the certs and keys.</p>
<p>A sensor2cloud-aws app for INP301x EVB’s onboard
sensors is also available here</p>
</td>
</tr>
<tr class="row-even"><td><p><em>data</em></p></td>
<td><p>Provides the sample dataFS folder structure to be used
while programming the AWS certs and keys to EVB-A for
talaria_two_aws Sample Applications.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Makefile</em></p></td>
<td><p>Generates the sample application executable binaries
and AWS IoT SDK libraries, using AWS IoT SDK source
files, sample application source files and
<em>&lt;sdk_path&gt;/apps/talaria_two_aws/sampl
e_apps/&lt;os&gt;/&lt;application_folder&gt;/src/aws_iot_config.h</em>.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="overview-of-sample-applications">
<h2>Overview of Sample Applications<a class="headerlink" href="#overview-of-sample-applications" title="Permalink to this heading"></a></h2>
<p>Sample Applications ported onto the Talaria TWO platform are available
at: \talaria_two_aws\sample_apps\&lt;os&gt;.</p>
<p>A brief overview of these applications is provided in this section.</p>
</section>
<section id="subscribe-publish-sample">
<h2>Subscribe-Publish Sample<a class="headerlink" href="#subscribe-publish-sample" title="Permalink to this heading"></a></h2>
<p>This example takes the parameters from the aws_iot_config.h file and
Talaria TWO boot arguments and establishes a connection to the AWS IoT
MQTT Platform.</p>
<p>It then subscribes and publishes to the topics provided as bootargs
subscribe_topic and publish_topic.</p>
<p>If the topic bootArgs are not provided, then it defaults to
inno_test/ctrl as the subscribe_topic and inno_test/data as the
publish_topic.</p>
<p>If all the certs/keys are correct, alternate QoS0 and QoS1 messages
being published to publish_topic by the application in a loop is seen on
the Talaria TWO console.</p>
<p>If publishCount in code is given a non-zero value, then it defines the
number of times the publish should happen. With publishCount as 0, it
keeps publishing in a loop.</p>
<p><em>AWS IoT Console-&gt;Test</em> page can be used to subscribe to inno_test/data
(or Talaria TWO’s publish_topic provided as the bootArg to the
application) to observe the messages published by the application.</p>
<p><em>AWS IoT Console-&gt;Test</em> page can be used to publish the message to
inno_test/ctrl (or Talaria TWO’s subscribe_topic provided as the bootArg
to the application), and Talaria TWO application will receive the
messages which will be visible on the Talaria TWO console.</p>
<p>Following JSON formatted text should be used for publishing to Talaria
TWO:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>{</p>
<p>“from”: “AWS IoT console”</p>
<p>“to”: “T2”</p>
<p>“msg”: “Hello from AWS IoT console”</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The application takes SSID, passphrase, aws host name, aws port and
thing name (as client-id) as mandatory bootArgs and publish_topic,
subscribe_topic and suspend as optional bootargs.</p>
<p>Certs and keys are stored in dataFS and read from application specific
paths defined in the sample code.</p>
<p><strong>Note</strong>: For Subscribe Publish sample, it is not necessary to create a
Thing in the AWS IoT Core. However, it is required that the Client ID be
unique. Any string can be given if it is unique. If two devices with
same Client ID are connected, AWS IoT Core keeps only the latest device
connected, and disconnects the device connected earlier. To enforce the
unique Client ID and avoid disconnects, Thing Name is used as Client ID
for sample applications.</p>
</section>
<section id="shadow-sample">
<h2>Shadow Sample<a class="headerlink" href="#shadow-sample" title="Permalink to this heading"></a></h2>
<p>The goal of this sample application is to demonstrate the capabilities
of aws iot thing shadow service.</p>
<p>This example takes the parameters from the aws_iot_config.h file and
Talaria TWO boot arguments and establishes a connection to the AWS IoT
Shadow Service.</p>
<p>This device acts as a Connected Window and periodically reports (once
every 3 seconds) the following parameters to the Thing’s Classic Shadow
:</p>
<ol class="arabic simple">
<li><p>Temperature of the room (double)</p></li>
</ol>
<p><strong>Note</strong>: Temperature changes are simulated.</p>
<ol class="arabic simple" start="2">
<li><p>Open/close status of the window (bool). Open or close as windowOpen
true/false</p></li>
</ol>
<p>The device also listens for a shadow state change for windowOpen to act
on commands from the cloud. Two variables from a device’s perspective
are,</p>
<ol class="arabic simple">
<li><p>Double temperature</p></li>
<li><p>Bool windowOpen</p></li>
</ol>
<p>Hence, the corresponding Shadow Json Document in the cloud would be as
follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>{ “reported”: {</p>
<p>“temperature”: 32,</p>
<p>“windowOpen”: false</p>
<p>},</p>
<p>“desired”: {</p>
<p>“windowOpen”: false</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The device opens or closes the window based on json object windowOpen
data (true/false) received as part of shadow delta callback. Hence, a
jsonStruct_t object windowActuator is created with pKey = “windowOpen”
of type = SHADOW_JSON_BOOL and a delta callback windowActuate_Callback.</p>
<p>The application then registers for a Delta callback for windowActuator
and receives a callback whenever a state change happens for this object
in Thing Shadow.</p>
<p>For example: Based on temperature reported, a logic running in the AWS
cloud infra can either automatically decide when to open or close the
window, and thereby control it by changing the desired state of
windowOpen or a manual input by the end-user using a web/phone
application can change the desired state of windowOpen.</p>
<p>For the sample application, change in desired section can be done
manually as shown:</p>
<p>Assume the reported and desired states of windowOpen are false as shown
in the above JSON. From AWS IoT Web Console’s Thing Shadow, if the
desired section is edited/saved as shown, then a delta callback will be
received by the application as there is a difference between desired vs
reported.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>   “desired”:</p>
<p>{</p>
<p>     “windowOpen”: false</p>
<p>   }</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Received Delta message</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>“delta”: {</p>
<blockquote>
<div><p>“windowOpen”: true</p>
</div></blockquote>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This delta message implies that the desired windowOpen variable has
changed to true. The application will act on this delta message and
publish back windowOpen as true as part of the reported section of the
shadow document from the device when the next periodic temperature value
is reported.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>   “reported”:</p>
<p>{</p>
<p>     “temperature”: 28,</p>
<p>     “windowOpen”: true</p>
<p>   }</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This update reported message will remove the delta that was created, as
the desired and reported states will now match. If this delta message is
not removed, then the AWS IoT Thing Shadow is always going to have a
delta, and will keep sending delta callback anytime an update is applied
to the Shadow.</p>
<p><strong>Note</strong>: Ensure the buffer sizes in aws_iot_config.h are big enough to
receive the delta message. The delta message will also contain the
metadata with the timestamps.</p>
<p>The application takes SSID, passphrase, AWS host name, AWS port and
thing name as must provide bootargs and suspend as optional bootArgs.</p>
<p>Certs and keys are stored in dataFS and read from app specific paths
defined in the sample code.</p>
</section>
<section id="jobs-sample">
<h2>Jobs Sample<a class="headerlink" href="#jobs-sample" title="Permalink to this heading"></a></h2>
<p>This example takes the parameters from aws_iot_config.h file and Talaria
TWO boot arguments and establishes a connection to the AWS IoT MQTT
Platform.</p>
<p>It performs several operations to demonstrate the basic capabilities of
the AWS IoT Jobs platform.</p>
<p>If all the certs/keys are correct, a list of pending Job Executions
printed out by the iot_get_pending_callback_handler can be seen.</p>
<p>If there are any existing pending job executions, each will be processed
one at a time in the iot_next_job_callback_handler.</p>
<p>After all of the pending jobs have been processed, the program will wait
for notifications for new pending jobs and process them one at a time as
they come in.</p>
<p>In the main body, registration of each callback for each corresponding
Jobs topic can be seen.</p>
<p>The application takes SSID, passphrase, AWS host name, AWS port and
thing name as must provide boot arguments and suspend as an optional
boot argument. Certs and keys are stored in dataFS and read from app
specific paths defined in the sample code.</p>
</section>
<section id="sensor2cloud-aws">
<h2>Sensor2Cloud- AWS<a class="headerlink" href="#sensor2cloud-aws" title="Permalink to this heading"></a></h2>
<p>This application is a reference example of sensor2cloud-aws for sensors
available onboard in INP301x EVB-A. It is similar to the Shadow Sample
application, which uses the same boot arguments and data from sensors
available onboard in INP301x EVB-A instead of simulated data. Boot
arguments are also similar to the Shadow Sample application with an
additional boot-arg added, named sensor_poll_interval.</p>
<p>The application takes SSID, passphrase, aws host name, aws port thing
name (as client-id) and sensor_poll_interval as mandatory boot arguments
and suspend as optional boot arguments.</p>
<p>Certs and keys are stored in dataFS and read from application specific
paths defined in the sample code.</p>
<p>Following are the shadow attributes used by this application:</p>
<ol class="arabic simple">
<li><p>temperature</p></li>
<li><p>pressure</p></li>
<li><p>humidity</p></li>
<li><p>opticalPower</p></li>
<li><p>sensorPollInterval</p></li>
<li><p>sensorSwitch</p></li>
</ol>
<p>If sensorSwitch is ON, sensor values are read periodically every
sensorPollInterval (in seconds) and sent to AWS IoT Thing Shadow
associated with the thing_name passed in the boot argument. If
sensorSwitch is OFF, no values are sent, but the application waits for
incoming delta callbacks for sensorSwitch and sensorPollInterval.</p>
<p>On boot, sensorSwitch is forced to be ON (‘true’) and sensorPollInterval
is forced to be the value passed using boot arguments for
sensor_poll_interval (in seconds). This can be later controlled by
changing these attributes values from the cloud and it takes effect on
Talaria TWO running via shadow delta callbacks.</p>
</section>
<section id="aws-set-up">
<h2>AWS Set-up<a class="headerlink" href="#aws-set-up" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create an AWS IoT account</p></li>
</ol>
<p>An AWS account is needed to run the sample applications. AWS accounts
include twelve months of Free Tier Access.</p>
<p>More information on: <a class="reference external" href="https://portal.aws.amazon.com/billing/signup#/start">https://portal.aws.amazon.com/billing/signup#/start</a></p>
<ol class="arabic simple" start="2">
<li><p>Create and register device/thing</p></li>
</ol>
<p>Device/thing must be registered onto the AWS IoT registry.</p>
<p>Use the following link to AWS IoT user guide to download the necessary
certificates and private key:
<a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/create-iot-resources.html">https://docs.aws.amazon.com/iot/latest/developerguide/create-iot-resources.html</a>.</p>
<p><strong>Note</strong>:</p>
<ul class="simple">
<li><p>Ensure the downloaded certificates and private key are saved in a
secure location as it allows the user to download only once.</p></li>
<li><p>To determine your custom AWS, download location, go to AWS IoT
Console -&gt; Settings</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Save Certificate and Private Key onto the device</p></li>
</ol>
<p>There are four certificates that will be downloaded from AWS for the
created Thing. Out of which Public Key will not be used in this example.</p>
<p>Save the certificates (as there is a need to install these in the
device) and rename them as per the following table to create file system
and write it into Talaria TWO using the download tool:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>File Name</strong></p></th>
<th class="head"><p><strong>Rename</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>private.pem.key</p></td>
<td><p>aws_device_pkey</p></td>
</tr>
<tr class="row-odd"><td><p>device.pem.crt</p></td>
<td><p>aws_device_cert</p></td>
</tr>
<tr class="row-even"><td><p>amazon-root-CA-1.pem</p></td>
<td><p>aws_root_ca</p></td>
</tr>
<tr class="row-odd"><td><p>Public Key</p></td>
<td><p>Not used in these examples</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Create and attach a Policy to the certificate associated with the
device/thing. To allow interaction with all the topics and other
resources used in the example codes, a wildcard policy is set and
attached to the thing’s certificate. Please edit and update the
policy as shown below:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>{</p>
<p>“Version”: “2012-10-17”,</p>
<p>“Statement”: [</p>
<p>{</p>
<p>“Effect”: “Allow”,</p>
<p>“Action”: “iot:*”,</p>
<p>“Resource”: “*”</p>
<p>}</p>
<p>]</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="programming-vm-based-applications">
<h2>Programming VM-based applications<a class="headerlink" href="#programming-vm-based-applications" title="Permalink to this heading"></a></h2>
</section>
<section id="programming-talaria-two-board-with-certificates">
<h2>Programming Talaria TWO Board with Certificates<a class="headerlink" href="#programming-talaria-two-board-with-certificates" title="Permalink to this heading"></a></h2>
<p>The default path for sample AWS should be: \data\certs\aws\app.</p>
<p>The default path for sensor2cloud-aws application:
\data\certs\sensor2aws</p>
</section>
<section id="show-file-system-contents">
<h2>Show File System Contents<a class="headerlink" href="#show-file-system-contents" title="Permalink to this heading"></a></h2>
<p>Click on Show File System Contents field to see the currently available
files in the file system.</p>
</section>
<section id="write-files">
<h2>Write Files<a class="headerlink" href="#write-files" title="Permalink to this heading"></a></h2>
<p>To write files into Talaria TWO, user must create a folder with the name
data and place all certificates either directly into the data or they
can create multiple subfolders (for example: /data/iot_aws) and place
the certificates inside the sub-directory and update the path as per the
file system in the .c file.</p>
<p>The default path is \data\certs\aws\app. If the user writes into
data\iot_aws\cert_names then the path should be updated in the .c file
accordingly.</p>
<p><strong>Note</strong>: The default path for sensor2cloud-aws application is
\data\certs\sensor2aws</p>
<p>All the files/folders inside data will be written to Talaria TWO dataFS.</p>
<p>For reference, an example data folder is provided in the talaria_two_aws
repo, in the following path: /talaria_two_aws/data.</p>
<p>For more information on using the Download Tool, refer:
UG_Download_Tool.pdf (path:
<em>freertos_sdk_x.y/pc_tools/Download_Tool/doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the FreeRTOS SDK release version. For
example: freertos_sdk_3.0/doc.</p>
</section>
<section id="programming-talaria-two-board-with-elf">
<h2>Programming Talaria TWO board with ELF<a class="headerlink" href="#programming-talaria-two-board-with-elf" title="Permalink to this heading"></a></h2>
<p>Program the generated ELFs onto Talaria TWO using the Download Tool
freertos_sdk_x.y\pc_tools\Download_Tool)provided with InnoPhase
Talaria TWO FreeRTOS SDK.</p>
<p>Launch the Download tool.</p>
<ol class="arabic simple">
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the appropriate ELF by clicking on Select ELF
File.</p></li>
<li><p>AP Options: Provide the SSID and Passphrase under AP Options to
connect to an Access Point.</p></li>
<li><p>Boot arguments: Pass the following boot arguments:</p></li>
</ol>
</li>
</ol>
<blockquote>
<div><p>sensor2cloud-aws application:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>aws_host=xxxxxx.amazonaws.com,aws_
port=8883,thing_name=xxxxx,sensor_poll_interval=&lt;interval_in_seconds&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>All other applications:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>aws_host=xxxxxx.amazonaws.com, aws_port=8883,thing_name=xxxxx</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p><strong>Note</strong>: Replace the xxxxxx with the appropriate details.</p>
<p>Ensure correct boot parameters are supplied of your Wi-Fi network and
the information from the device/thing created previously on AWS.</p>
</div></blockquote>
<ol class="lowerroman simple">
<li><p>aws_host is the custom AWS location.</p></li>
<li><p>thing_name is the name of the device/thing we created earlier.</p></li>
</ol>
<ol class="loweralpha simple" start="5">
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</section>
<section id="mqtt-publish-and-subscribe">
<h2>MQTT Publish and Subscribe<a class="headerlink" href="#mqtt-publish-and-subscribe" title="Permalink to this heading"></a></h2>
<p><strong>Note</strong>: All AWS IoT Console screenshots might not look exactly as
shown in the figures but might be a variation of the same. This is
in-line with the ever-evolving console and its layouts.</p>
</section>
<section id="subscribe">
<h2>Subscribe<a class="headerlink" href="#subscribe" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In the AWS IoT Console, go to Test-&gt;MQTT test client.</p></li>
<li><p>In the Subscription topic text box, type inno_test/data and click on
Subscribe.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image17.png"><img alt="Table Description automatically generated" src="../../_images/image17.png" style="width: 6.69291in; height: 1.60048in;" /></a></p>
<p>Figure : Subscribe to topic</p>
<ol class="arabic simple" start="3">
<li><p>In the Publish to a topic tab, click on inno_test/data.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image21.png"><img alt="Graphical user interface, application Description automatically generated" src="../../_images/image21.png" style="width: 6.69291in; height: 3.09426in;" /></a></p>
<p>Figure : Subscriptions – inno_test/data</p>
</section>
<section id="running-the-sample-application">
<h2>Running the Sample Application<a class="headerlink" href="#running-the-sample-application" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Program the Talaria TWO board with sample_pub_sub.elf using the
process described in section: Programming Talaria TWO board with ELF.</p></li>
<li><p>Upon successful execution, the following console output will be
provided:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>[8.538,997] partitions mounted</p>
<p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWWAE</p>
<p>Build $Id: git-831e563 $</p>
<p>Flash detected. flash.hw.uuid: 394b3437-3802-004d-00e2-ffffffffffff</p>
<p>Bootargs: aws_host=a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com
aws_port=8883 thing_name=ble_new np_conf_path=/data/nprofile.json
ssid=FASTFIBER passphrase=MD123456</p>
<p>AWS IoT SDK Version 3.1.5-</p>
<p>Mounting file system</p>
<p>read_certs() success</p>
<p>[0.083,964] rfdrv: unknown module type (0)</p>
<p>addr 02:03:04:57:4d:04</p>
<p>added network profile successfully, will try connecting..</p>
<p>[2.787,785] CONNECT:8c:c7:c3:50:31:3f Channel:1 rssi:-81 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[3.007,860] MYIP 192.168.1.34</p>
<p>[3.008,025] IPv6 [fe80::3:4ff:fe57:4d04]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>Connecting…</p>
<p>heap[230488] max contentlen[16384] sizeof IoT_Publish_Message_Params
(16)</p>
<p>. Seeding the random number generator…</p>
<p>. Loading the CA root certificate…</p>
<p>Root Done (0 skipped)</p>
<p>. Loading the client cert and key. size TLSDataParams:2080</p>
<p>Loading the client cert done…. ret[0]</p>
<p>Loading the client pkey done…. ret[0]</p>
<p>ok</p>
<p>. Connecting to
a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com/8883…</p>
<p>ok</p>
<p>. Setting up the SSL/TLS structure…</p>
<p>SSL state connect : 0</p>
<p>ok</p>
<p>SSL state connect : 0</p>
<p>. Performing the SSL/TLS handshake…</p>
<p>Verify requested for (Depth 2):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 1):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 0):</p>
<p>This certificate has no flags</p>
<p>SSL/TLS Handshake DONE.. ret:0</p>
<p>ok</p>
<p>[ Protocol is TLSv1.2 ]</p>
<p>[ Ciphersuite is TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256 ]</p>
<p>[ Record expansion is 29 ]</p>
<p>. Verifying peer X.509 certificate…</p>
<p>ok</p>
<p>Subscribing…</p>
<p>Subscribed to topic [inno_test/ctrl] ret[0] qos[0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:1}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:1. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:2}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:2. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:3}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:3. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:4}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:4. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:5}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:5. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:6}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:6. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:7}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:7. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:8}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:8. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:9}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:9. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:10}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:10. Return Status [0]</p>
<p>sleep</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>The AWS IoT dashboard will appear as in Figure 3.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image31.png"><img alt="Graphical user interface, text, website Description automatically generated" src="../../_images/image31.png" style="width: 6.69291in; height: 5.64533in;" /></a></p>
<p>Figure : AWS IoT Dashboard</p>
</section>
<section id="publish">
<h2>Publish<a class="headerlink" href="#publish" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Program the Talaria TWO board with sample_pub_sub.elf using the
process described in section: Programming Talaria TWO board with ELF.</p></li>
<li><p>In the AWS IoT Console, go to Test.</p></li>
<li><p>On the Publish topic text box, enter inno_test/ctrl.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image41.png"><img alt="image1" src="../../_images/image41.png" style="width: 6.88976in; height: 2.98556in;" /></a></p>
<p>Figure : Publish to topic</p>
<ol class="arabic simple" start="4">
<li><p>Copy and paste the following json formatted text into the colored
console as shown in Figure 4.</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>{</p>
<p>“from”: “AWS IoT console”</p>
<p>“to”: “T2”</p>
<p>“msg”: “Hello from AWS IoT console”</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><p>On clicking Publish to topic, the following output is displayed in
the console:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWWAE</p>
<p>Build $Id: git-831e563 $</p>
<p>Flash detected. flash.hw.uuid: 394b3437-3802-004d-00e2-ffffffffffff</p>
<p>Bootargs: aws_host=a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com
aws_port=8883 thing_name=ble_new np_conf_path=/data/nprofile.json
ssid=FASTFIBER passphrase=MD123456</p>
<p>AWS IoT SDK Version 3.1.5-</p>
<p>Mounting file system</p>
<p>read_certs() success</p>
<p>[0.083,964] rfdrv: unknown module type (0)</p>
<p>addr 02:03:04:4a:8d:6c</p>
<p>added network profile successfully, will try connecting..</p>
<p>[2.884,395] CONNECT:8c:c7:c3:50:31:3f Channel:1 rssi:-80 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[3.127,409] MYIP 192.168.1.40</p>
<p>[3.127,457] IPv6 [fe80::3:4ff:fe4a:8d6c]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>Connecting…</p>
<p>heap[230440] max contentlen[16384] sizeof IoT_Publish_Message_Params
(16)</p>
<p>. Seeding the random number generator…</p>
<p>. Loading the CA root certificate…</p>
<p>Root Done (0 skipped)</p>
<p>. Loading the client cert and key. size TLSDataParams:2080</p>
<p>Loading the client cert done…. ret[0]</p>
<p>Loading the client pkey done…. ret[0]</p>
<p>ok</p>
<p>. Connecting to
a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com/8883…</p>
<p>ok</p>
<p>. Setting up the SSL/TLS structure…</p>
<p>SSL state connect : 0</p>
<p>ok</p>
<p>SSL state connect : 0</p>
<p>. Performing the SSL/TLS handshake…</p>
<p>Verify requested for (Depth 2):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 1):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 0):</p>
<p>This certificate has no flags</p>
<p>SSL/TLS Handshake DONE.. ret:0</p>
<p>ok</p>
<p>[ Protocol is TLSv1.2 ]</p>
<p>[ Ciphersuite is TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256 ]</p>
<p>[ Record expansion is 29 ]</p>
<p>. Verifying peer X.509 certificate…</p>
<p>ok</p>
<p>Subscribing…</p>
<p>Subscribed to topic [inno_test/ctrl] ret[0] qos[0]</p>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: Hello from AWS IoT</p></li>
</ul>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:1}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:1. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:2}]</p>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: HelloWorld from AWS IoT console Team_BLE1</p></li>
</ul>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: HelloWorld from AWS IoT console Team_BLE2</p></li>
</ul>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: HelloWorld from AWS IoT console Team_BLE3</p></li>
</ul>
<p>QoS1 Message Publish Successful for “msg_id”:2. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:3}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:3. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:4}]</p>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: HelloWorld from AWS IoT console Team_BLE4</p></li>
</ul>
<p>&lt;— Message Received on Subscribed Topic [inno_test/ctrl]</p>
<ul class="simple">
<li><p>from: AWS IoT console</p></li>
<li><p>to: T2</p></li>
<li><p>message: HelloWorld from AWS IoT console Team_BLE5</p></li>
</ul>
<p>QoS1 Message Publish Successful for “msg_id”:4. Return Status [0]</p>
<p>sleep</p>
<p>—&gt; Publishing with ‘Message QoS0’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:5}]</p>
<p>QoS0 Message Publish Successful for “msg_id”:5. Return Status [0]</p>
<p>—&gt; Publishing with ‘Message QoS1’ to Topic [inno_test/data]</p>
<p>msg[{“from”:”Talaria T2”,”to”:”AWS”,”msg”:”Howdy Ho”,”msg_id”:6}]</p>
<p>QoS1 Message Publish Successful for “msg_id”:6. Return Status [0]</p>
<p>sleep</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="device-shadow">
<h2>Device Shadow<a class="headerlink" href="#device-shadow" title="Permalink to this heading"></a></h2>
</section>
<section id="running-the-sample-application-1">
<span id="id1"></span><h2>Running the Sample Application<a class="headerlink" href="#running-the-sample-application-1" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In the AWS IoT Console, go to Manage -&gt; Things -&gt;YourThingName -&gt;
Shadow.</p></li>
<li><p>Program the Talaria TWO board with shadow_sample.elf using the
process described in section: Programming Talaria TWO board with ELF.</p></li>
<li><p>On successful execution, the following console output will be
provided:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWWAE</p>
<p>Build $Id: git-831e563 $</p>
<p>Flash detected. flash.hw.uuid: 394b3437-3802-004d-00e2-ffffffffffff</p>
<p>Bootargs: aws_host=a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com
aws_port=8883 thing_name=ble_new np_conf_path=/data/nprofile.json
ssid=FASTFIBER passphrase=MD123456</p>
<p>AWS IoT SDK Version 3.1.5-</p>
<p>Mounting file system</p>
<p>read_certs() success</p>
<p>[0.083,925] rfdrv: unknown module type (0)</p>
<p>addr 02:03:04:63:1c:50</p>
<p>added network profile successfully, will try connecting..</p>
<p>[2.786,471] CONNECT:8c:c7:c3:50:31:3f Channel:1 rssi:-77 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[3.022,963] MYIP 192.168.1.41</p>
<p>[3.023,127] IPv6 [fe80::3:4ff:fe63:1c50]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>Shadow InitShadow Connect</p>
<p>. Seeding the random number generator…</p>
<p>. Loading the CA root certificate…</p>
<p>Root Done (0 skipped)</p>
<p>. Loading the client cert and key. size TLSDataParams:2080</p>
<p>Loading the client cert done…. ret[0]</p>
<p>Loading the client pkey done…. ret[0]</p>
<p>ok</p>
<p>. Connecting to
a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com/8883…</p>
<p>ok</p>
<p>. Setting up the SSL/TLS structure…</p>
<p>SSL state connect : 0</p>
<p>ok</p>
<p>SSL state connect : 0</p>
<p>. Performing the SSL/TLS handshake…</p>
<p>Verify requested for (Depth 2):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 1):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 0):</p>
<p>This certificate has no flags</p>
<p>SSL/TLS Handshake DONE.. ret:0</p>
<p>ok</p>
<p>[ Protocol is TLSv1.2 ]</p>
<p>[ Ciphersuite is TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256 ]</p>
<p>[ Record expansion is 29 ]</p>
<p>. Verifying peer X.509 certificate…</p>
<p>ok</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:25.500000,”windowOpen”:false}},
“clientToken”:”ble_new-0”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:26.000000,”windowOpen”:false}},
“clientToken”:”ble_new-1”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:26.500000,”windowOpen”:false}},
“clientToken”:”ble_new-2”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:27.000000,”windowOpen”:false}},
“clientToken”:”ble_new-3”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:27.500000,”windowOpen”:false}},
“clientToken”:”ble_new-4”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:28.000000,”windowOpen”:false}},
“clientToken”:”ble_new-5”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:28.500000,”windowOpen”:false}},
“clientToken”:”ble_new-6”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:29.000000,”windowOpen”:false}},
“clientToken”:”ble_new-7”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:29.500000,”windowOpen”:false}},
“clientToken”:”ble_new-8”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:30.000000,”windowOpen”:false}},
“clientToken”:”ble_new-9”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:30.500000,”windowOpen”:false}},
“clientToken”:”ble_new-10”}</p>
<p>Update Accepted !!</p>
<p>On Device: window state false</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:31.000000,”windowOpen”:false}},
“clientToken”:”ble_new-11”}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>The AWS IoT dashboard will appear as shown in Figure 5.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image51.png"><img alt="image2" src="../../_images/image51.png" style="width: 6.88976in; height: 6.90973in;" /></a></p>
<p>Figure : AWS IoT Dashboard</p>
</section>
<section id="running-jobs">
<h2>Running Jobs<a class="headerlink" href="#running-jobs" title="Permalink to this heading"></a></h2>
</section>
<section id="creating-a-job-in-aws">
<h2>Creating a job in AWS<a class="headerlink" href="#creating-a-job-in-aws" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create a new .json file.</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>{ “operation”: “customJob”,</p>
<p>“otherInfo”: “someValue” }</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Create a bucket to store files on your Amazon Simple Storage Service
(Amazon S3).</p></li>
</ol>
<p>More information on creating buckets on the Amazon S3 can be found here:
<a class="reference external" href="https://s3.console.aws.amazon.com">https://s3.console.aws.amazon.com</a>.</p>
<p><a class="reference internal" href="../../_images/image61.png"><img alt="Graphical user interface, text, application, email Description automatically generated" src="../../_images/image61.png" style="width: 6.69291in; height: 1.89148in;" /></a></p>
<p>Figure : Creating a bucket to store files on Amazon S3</p>
<ol class="arabic simple" start="3">
<li><p>Upload the new .json file onto the Amazon S3 bucket.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image71.png"><img alt="Graphical user interface, text, application Description automatically generated" src="../../_images/image71.png" style="width: 6.69291in; height: 2.61897in;" /></a></p>
<p>Figure : Uploading .json file onto the Amazon S3 bucket</p>
<ol class="arabic simple" start="4">
<li><p>In the AWS IoT Console, go to Manage -&gt; Jobs.</p></li>
<li><p>Click on Create and then on Create custom job.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image81.png"><img alt="Graphical user interface, application, email Description automatically generated" src="../../_images/image81.png" style="width: 6.69291in; height: 5.18943in;" /></a></p>
<p>Figure : Creating a custom job</p>
<ol class="arabic simple" start="6">
<li><p>Fill the Job ID and Description as per your requirement.</p></li>
<li><p>In Select devices to update, select your thing as the device to be
included in the job.</p></li>
</ol>
<p><strong>Note</strong>: If your thing name is not found in the dropdown, then make
sure to select the correct region available at the top right side of AWS
IoT console.</p>
<p><a class="reference internal" href="../../_images/image91.png"><img alt="image3" src="../../_images/image91.png" style="width: 6.69291in; height: 4.72384in;" /></a></p>
<p>Figure : Selecting devices to update</p>
<ol class="arabic simple" start="8">
<li><p>In Add a job file, go ahead, and select the job file uploaded into
your S3 bucket.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image101.png"><img alt="image4" src="../../_images/image101.png" style="width: 6.69291in; height: 1.76053in;" /></a></p>
<p>Figure : Adding a job file</p>
<ol class="arabic simple" start="9">
<li><p>Click on Next. In the next window, click on Create.</p></li>
<li><p>The new job you created will now appear on the AWS IoT Console.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image111.png"><img alt="image5" src="../../_images/image111.png" style="width: 6.69291in; height: 3.19589in;" /></a></p>
<p>Figure : AWS IoT Console – new job created</p>
</section>
<section id="running-the-sample-application-2">
<span id="id2"></span><h2>Running the Sample Application<a class="headerlink" href="#running-the-sample-application-2" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Program the Talaria TWO board with jobs_sample.elf using the process
described in section: Programming Talaria TWO board with ELF.</p></li>
<li><p>Boot arguments: Pass the following boot arguments</p></li>
<li><p>On successful execution, the following console output will be
provided:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWWAE</p>
<p>Build $Id: git-831e563 $</p>
<p>Flash detected. flash.hw.uuid: 394b3437-3802-004d-00e2-ffffffffffff</p>
<p>Bootargs: aws_host=a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com
aws_port=8883 thing_name=ble_new np_conf_path=/data/nprofile.json
ssid=FASTFIBER passphrase=MD123456</p>
<p>Mounting file system</p>
<p>read_certs() success</p>
<p>[0.083,832] rfdrv: unknown module type (0)</p>
<p>addr 02:03:04:92:c7:65</p>
<p>added network profile successfully, will try connecting..</p>
<p>[2.787,325] CONNECT:8c:c7:c3:50:31:3f Channel:1 rssi:-79 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[3.078,714] MYIP 192.168.1.42</p>
<p>[3.078,879] IPv6 [fe80::3:4ff:fe92:c765]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>AWS IoT SDK Version 3.1.5-</p>
<p>Connecting…</p>
<p>heap[228688] max contentlen[16384] sizeof IoT_Publish_Message_Params
(16)</p>
<p>. Seeding the random number generator…</p>
<p>. Loading the CA root certificate…</p>
<p>Root Done (0 skipped)</p>
<p>. Loading the client cert and key. size TLSDataParams:2080</p>
<p>Loading the client cert done…. ret[0]</p>
<p>Loading the client pkey done…. ret[0]</p>
<p>ok</p>
<p>. Connecting to
a3th11zq4plemm-ats.iot.us-east-2.amazonaws.com/8883…</p>
<p>ok</p>
<p>. Setting up the SSL/TLS structure…</p>
<p>SSL state connect : 0</p>
<p>ok</p>
<p>SSL state connect : 0</p>
<p>. Performing the SSL/TLS handshake…</p>
<p>Verify requested for (Depth 2):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 1):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 0):</p>
<p>This certificate has no flags</p>
<p>SSL/TLS Handshake DONE.. ret:0</p>
<p>ok</p>
<p>[ Protocol is TLSv1.2 ]</p>
<p>[ Ciphersuite is TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256 ]</p>
<p>[ Record expansion is 29 ]</p>
<p>. Verifying peer X.509 certificate…</p>
<p>ok</p>
<p>Success subscribing JOB_GET_PENDING_TOPIC: 0</p>
<p>Success subscribing JOB_NOTIFY_NEXT_TOPIC: 0</p>
<p>Success subscribing JOB_DESCRIBE_TOPIC ($next): 0</p>
<p>Success subscribing JOB_UPDATE_TOPIC/accepted: 0</p>
<p>Success subscribing JOB_UPDATE_TOPIC/rejected: 0</p>
<p>Success calling aws_iot_jobs_send_query: 0</p>
<p>Success aws_iot_jobs_describe: 0</p>
<p>JOB_GET_PENDING_TOPIC callback</p>
<p>topic: $aws/things/ble_new/jobs/get/accepted</p>
<p>payload:
{“timestamp”:1697702118,”inProgr
essJobs”:[],”queuedJobs”:[{“jobId”:”AWS_IoT_Job”,”queuedAt”:169763328
0,”lastUpdatedAt”:1697633280,”executionNumber”:1,”versionNumber”:1}]}</p>
<p>inProgressJobs: []</p>
<p>queuedJobs:
[{“jobId”:”AWS_IoT_Job”,”queuedAt”:16976332
80,”lastUpdatedAt”:1697633280,”executionNumber”:1,”versionNumber”:1}]</p>
<p>JOB_NOTIFY_NEXT_TOPIC / JOB_DESCRIBE_TOPIC($next) callback</p>
<p>topic: $aws/things/ble_new/jobs/$next/get/accepted</p>
<p>payload:
{“timestamp”:169770211
8,”execution”:{“jobId”:”AWS_IoT_Job”,”status”:”QUEUED”,”queuedAt”:169
7633280,”lastUpdatedAt”:1697633280,”versionNumber”:1,”executionNumber
“:1,”jobDocument”:{“operation”:”customJob”,”otherInfo”:”someValue”}}}</p>
<p>execution:
{“jobId”:”AWS_IoT_Job”,”status”:”QUEUED”,”queuedAt”:16
97633280,”lastUpdatedAt”:1697633280,”versionNumber”:1,”executionNumbe
r”:1,”jobDocument”:{“operation”:”customJob”,”otherInfo”:”someValue”}}</p>
<p>jobId: AWS_IoT_Job</p>
<p>jobDocument: {“operation”:”customJob”,”otherInfo”:”someValue”}</p>
<p>JOB_UPDATE_TOPIC / accepted callback</p>
<p>topic: $aws/things/ble_new/jobs/AWS_IoT_Job/update/accepted</p>
<p>payload: {“timestamp”:1697702119}</p>
<p>JOB_NOTIFY_NEXT_TOPIC / JOB_DESCRIBE_TOPIC($next) callback</p>
<p>topic: $aws/things/ble_new/jobs/notify-next</p>
<p>payload: {“timestamp”:1697702119}</p>
<p>execution property not found, nothing to do</p>
<p>aws_iot_mqtt_yield: 0</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>The AWS IoT Console will display as completed once the job is
completed.</p></li>
</ol>
<p><a class="reference internal" href="../../_images/image121.png"><img alt="image6" src="../../_images/image121.png" style="width: 6.69291in; height: 3.17186in;" /></a></p>
<p>Figure : AWS IoT Console – Job Completed</p>
<ol class="arabic simple" start="5">
<li><p>You can continue creating new jobs which will be executed by your
device/thing.</p></li>
</ol>
</section>
<section id="id3">
<h2>Sensor2Cloud – AWS<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
</section>
<section id="hardware-settings-and-evb-sensors">
<h2>Hardware Settings and EVB Sensors<a class="headerlink" href="#hardware-settings-and-evb-sensors" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Install jumper on J8 and J7 of EVB-A to enable SCL and SDA I2C line</p></li>
<li><p>Install jumper on J1 header to supply 3.3v on vio_sensor</p></li>
<li><p>There are 3 sensor chips available</p>
<ol class="loweralpha simple">
<li><p>U10(SHTC)  –&gt; Temperature/Humidity</p></li>
<li><p>U11(BMP)   –&gt;  Temperature/Pressure</p></li>
<li><p>U12(OPT)   –&gt;  Light (Optical Power)</p></li>
</ol>
</li>
</ol>
</section>
<section id="running-the-sample-application-3">
<span id="id4"></span><h2>Running the Sample Application<a class="headerlink" href="#running-the-sample-application-3" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Program the Talaria TWO board with sensor2cloud-aws_inp301x_app.elf
using the process described in section: <em>Programming Talaria TWO
board with ELF</em>.</p></li>
<li><p>Boot arguments: Pass the following boot arguments:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>aws_host=xxxxxx.amazonaws.com,aws_
port=8883,thing_name=xxxxx,sensor_poll_interval=&lt;interval_in_seconds&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>On successful execution, the following console output can be
observed:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>[8.354,841] partitions mounted</p>
<p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWWAE</p>
<p>Build $Id: git-831e563 $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-00a6-00ad-ffffffffffff</p>
<p>Bootargs: aws_host=a3t0o11ohwlo2h-ats.iot.us-east-2.amazonaws.com
aws_port=8883 thing_name=InnoAWS2023 suspend=1 wifi.cloud_pm=1
cloudpm.cpm_period=60 sensor_poll_interval=20
np_conf_path=/data/nprofile.json ssid=Xiaomi_Ax6000_iop
passphrase=InnoQA2023$</p>
<p>Mounting file system</p>
<p>read_certs() success</p>
<p>Initializing bmp388…</p>
<p>Initializing opt3002…</p>
<p>Initializing shtc3…</p>
<p>bmp388 ID: 0x50</p>
<p>opt3002 ID: 0x5449</p>
<p>shtc3 ID: 0x803C01D7</p>
<p>addr e0:69:3a:00:16:e6</p>
<p>Connecting to WiFi…</p>
<p>added network profile successfully, will try connecting..</p>
<p>connecting to network status: 0</p>
<p>[2.248,021] Trying to connect in 1 seconds</p>
<p>[4.631,119] CONNECT:d4:da:21:54:d3:c6 Channel:11 rssi:-35 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[6.999,336] MYIP 192.168.31.172</p>
<p>[6.999,424] IPv6 [fe80::e269:3aff:fe00:16e6]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>—–Timestamp: 7000716 uS—–</p>
<p>Pressure: 91387.7109 Pa</p>
<p>Temperature (bmp): 31.7900 C</p>
<p>Optical power: 239462.4062 nW/cm2</p>
<p>Humidity: 35.5169 %</p>
<p>Temperature (shtc): 32.1599 C</p>
<p>Shadow Connect</p>
<p>. Seeding the random number generator…</p>
<p>. Loading the CA root certificate…</p>
<p>Root Done (0 skipped)</p>
<p>. Loading the client cert and key. size TLSDataParams:2080</p>
<p>Loading the client cert done…. ret[0]</p>
<p>Loading the client pkey done…. ret[0]</p>
<p>ok</p>
<p>. Connecting to
a3t0o11ohwlo2h-ats.iot.us-east-2.amazonaws.com/8883…</p>
<p>ok</p>
<p>. Setting up the SSL/TLS structure…</p>
<p>SSL state connect : 0</p>
<p>ok</p>
<p>SSL state connect : 0</p>
<p>. Performing the SSL/TLS handshake…</p>
<p>Verify requested for (Depth 2):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 1):</p>
<p>This certificate has no flags</p>
<p>Verify requested for (Depth 0):</p>
<p>This certificate has no flags</p>
<p>SSL/TLS Handshake DONE.. ret:0</p>
<p>ok</p>
<p>[ Protocol is TLSv1.2 ]</p>
<p>[ Ciphersuite is TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256 ]</p>
<p>[ Record expansion is 29 ]</p>
<p>. Verifying peer X.509 certificate…</p>
<p>ok</p>
<p>Shadow Connected</p>
<p>init_and_connect_aws_iot. ret:0</p>
<p>Update Shadow: {“state”:{“desired”:{“sensorSwitch”:true}},
“clientToken”:”InnoAWS2023-0”}</p>
<p>Update Timeout–</p>
<p>Update Shadow: {“state”:{“desired”:{“sensorPollInterval”:20}},
“clientToken”:”InnoAWS2023-1”}</p>
<p>Registering for Delta callbacks on shadow attributes
:sensorPollInterval</p>
<p>Update Accepted !!</p>
<p>Registering for Delta callbacks on shadow attributes :sensorSwitch</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:32.009998,”pressu
re”:91384.617188,”humidity”:35.054001,”opticalPower”:244531.203125}},
“clientToken”:”InnoAWS2023-2”}</p>
<p>Recieved Delta Callback for shadow attribute: sensorPollInterval,
with desired state: 20</p>
<p>Update Accepted !!</p>
<p>Update Shadow: {“state”:{“reported”:{“sensorPollInterval”:20}},
“clientToken”:”InnoAWS2023-3”}</p>
<p>Update Accepted !!</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:32.080002,”pressu
re”:91383.273438,”humidity”:34.840000,”opticalPower”:241152.000000}},
“clientToken”:”InnoAWS2023-4”}</p>
<p>Update Accepted !!</p>
<p>Update Shadow:
{“state”:{“reported”:{“temperature”:32.099998,”pressu
re”:91387.031250,”humidity”:34.584000,”opticalPower”:246067.203125}},
“clientToken”:”InnoAWS2023-5”}</p>
<p>Update Accepted !!</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="2.%20Alarm.html" class="btn btn-neutral float-left" title="Alarm" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="4.%20SSBL.html" class="btn btn-neutral float-right" title="Second Stage Boot Loader" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>