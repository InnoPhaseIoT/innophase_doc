<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LPS Scan &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MQTT" href="Example_for_MQTT.html" />
    <link rel="prev" title="I2C" href="Example_for_I2C.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting%20Started/Getting%20Started%20-%20Landing%20Page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Hardware%20Reference/Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Software%20Reference/Software_Reference_Landing_Page.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Development%20Environments/Development%20Environments%20-%20Landing%20Page.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Tools/Tools-landing%20page.html">Tool</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#apps">Apps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#examples">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Example_for_Analog_to_Digital_Converter.html">Analog to Digital Converter (ADC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Audio_over_I2S.html">Audio Over I2S</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_BLE_WiFi_Bridge.html">BLE WiFi Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Crash_handling.html">Crash Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_I2C.html">I2C</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">LPS Scan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#system-api-functions">System / API Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sdk-provided-data-structures-and-objects">SDK Provided Data Structures and Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-functions">API Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wcm-create">wcm_create()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wifi-init-scan-default">wifi_init_scan_default()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wcm-scan">wcm_scan()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wi-fi-scan-related-data-retrieval">Wi-Fi Scan Related Data Retrieval</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-walkthrough">Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lpscan-c">lpscan.c</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-code-walkthrough">Sample Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application">Running the Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output">Expected Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_MQTT.html">MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Pulse_Width_Modulation.html">Pulse Width Modulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Radio_and_Module_Parameters.html">Radio and Module Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Secure_Files.html">Secure Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Socket_Wakeup.html">Socket Wakeup</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Software_SPI_Master.html">Software SPI Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_Chip_Monitor.html">Chip Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_Filesystem.html">Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_GPIO.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_SNTP.html">SNTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_WiFi.html">WIFI</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_WiFi_Power_Management.html">WiFi Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_BLE_5_0.html">BLE 5.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_BLE_Beacons.html">BLE Beacon</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Custom_ATCMDLIB.html">Custom ATCMDLIB</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_HTTP_Client.html">HTTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_IFTTT.html">IFTTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Low_Power_UART.html">Low Power UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_mDNS.html">mDNS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html">Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#scan-data">Scan Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#configuration-data-format">Configuration Data Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#service">Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#characteristics">Characteristics</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#application-flow">Application Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#sample-code-walkthrough">Sample Code Walkthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#write-the-provisioning-file-into-talaria-two-filesystem">Write the Provisioning File into Talaria TWO Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#programming-talaria-two-board-with-elf">Programming Talaria TWO board with ELF</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#running-the-application-using-android-or-ios-app">Running the Application using Android or iOS App</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Unassociated_Mode.html">Unassociated Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Watchdog_Timer.html">Watchlog Timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_WCM_Multi_AP.html">WCM Multi AP</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Websock_Client.html">Websock Client</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Regulatory%20Notices/Regulatory%20Notices.html">Regulatory Notices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Porting%20Guide/Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Support/Support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Disclaimers/Disclaimers.html">Disclaimer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Appendix/Appendix-Landing_Page.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Applications%20-%20Landing%20Page.html">Applications</a></li>
      <li class="breadcrumb-item active">LPS Scan</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Applications/2. Examples/Example_for_LPScan.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lps-scan">
<h1>LPS Scan<a class="headerlink" href="#lps-scan" title="Permalink to this heading"></a></h1>
<p>This application note describes the basics of the Low Power Wi-Fi scan
feature with an example illustrating Talaria TWO implementation, using
the provided data structs and API calls in the FreeRTOS SDK release.</p>
<section id="system-api-functions">
<h2>System / API Functions<a class="headerlink" href="#system-api-functions" title="Permalink to this heading"></a></h2>
</section>
<section id="sdk-provided-data-structures-and-objects">
<h2>SDK Provided Data Structures and Objects<a class="headerlink" href="#sdk-provided-data-structures-and-objects" title="Permalink to this heading"></a></h2>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Table : SDK Provided Data Structures/Objects</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Data
St
ructure/Object</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>struct
wcm_handle</em></p></td>
<td><p>Handle to the Wi-Fi connection manager. It is a
pointer return from the API call wcm_create().</p></td>
</tr>
<tr class="row-odd"><td><p><em>struct
wifi_netinfo</em></p></td>
<td><p>Used to hold the properties of a Wi-Fi network</p></td>
</tr>
<tr class="row-even"><td><p><em>struct
wifi_scan_param</em></p></td>
<td><p>Used to hold the parameters for Wi-Fi scan
operation.</p></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>:</p>
<ol class="arabic simple">
<li><p>Wi-Fi data structures are declared in:
<em>freertos_sdk_x.y\include\wifi\scan.h</em>.</p></li>
</ol>
<blockquote>
<div><p><strong>Note</strong>: x and y in freertos_sdk_x.y refers to the SDK release
version.</p>
</div></blockquote>
</section>
<section id="api-functions">
<h2>API Functions<a class="headerlink" href="#api-functions" title="Permalink to this heading"></a></h2>
</section>
<section id="wcm-create">
<h2>wcm_create()<a class="headerlink" href="#wcm-create" title="Permalink to this heading"></a></h2>
<p>Create a Wi-Fi network interface and return a struct wcm_handle pointer.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>static inline struct wcm_handle *</p>
<p>wcm_create(const uint8_t *hwaddr)</p>
<p>{</p>
<p>……</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="wifi-init-scan-default">
<h2>wifi_init_scan_default()<a class="headerlink" href="#wifi-init-scan-default" title="Permalink to this heading"></a></h2>
<p>Get the current Wi-Fi scan parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>void</p>
<p>wifi_init_scan_default(struct wifi_scan_param *param);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wifi_init_scan_default() is called to get the current Wi-Fi scan
parameters in the param of struct wifi_scan_param.</p>
</section>
<section id="wcm-scan">
<h2>wcm_scan()<a class="headerlink" href="#wcm-scan" title="Permalink to this heading"></a></h2>
<p>Perform Wi-Fi scan with the parameter block. Results are contained in
the buffer pointed with the parameter wifi_netinfo **result.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>int wcm_scan(struct wcm_handle *h, const struct wifi_scan_param
*param, struct wifi_netinfo **result, size_t max);</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="wi-fi-scan-related-data-retrieval">
<h2>Wi-Fi Scan Related Data Retrieval<a class="headerlink" href="#wi-fi-scan-related-data-retrieval" title="Permalink to this heading"></a></h2>
<p>A set of Wi-Fi scan related functions for retrieval of data from
wifi_netinfo.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>int wifi_netinfo_get_ssid(const struct wifi_netinfo* ni, struct
wifi_ssid* ssid);</p>
<p>int wifi_netinfo_get_chan(const struct wifi_netinfo* ni, uint8_t*
chan);</p>
<p>int wifi_netinfo_get_authmode(const struct wifi_netinfo* ni,struct
wifi_authmode* authmode);</p>
<p>size_t wifi_netinfo_authmode_tostr(uint32_t authmask, char*
mode_name, size_t size);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="code-walkthrough">
<h2>Code Walkthrough<a class="headerlink" href="#code-walkthrough" title="Permalink to this heading"></a></h2>
</section>
<section id="lpscan-c">
<h2>lpscan.c<a class="headerlink" href="#lpscan-c" title="Permalink to this heading"></a></h2>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The sample code is the path: <em>examples/lpscan/src/lpscan.c</em> is a simple
application which demonstrates the low power scan feature.</p>
</section>
<section id="sample-code-walkthrough">
<h2>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>User-defined Data Struct for the Scan Work Task:</p></li>
</ol>
<blockquote>
<div><p>Declare a data struct scan_workq_task for the scan work task:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>struct scan_workq_task {</p>
<p>struct {</p>
<p>uint32_t counter;</p>
<p>size_t max_nets;</p>
<p>int sum_total;</p>
<p>struct wcm_handle *h;</p>
<p>const struct wifi_scan_param *param;</p>
<p>struct wifi_netinfo **scan_result;</p>
<p>} conf;</p>
<p>};</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Static Variables for the Scan Work Task</p></li>
</ol>
<blockquote>
<div><p>Define the static variables for the scan feature:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#define TIME_BETWEEN_SCAN_ITERS 10</p>
<p>static bool ap_logging;</p>
<p>static uint32_t num_iterations, dt_iterations;</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>Initialization of the Static Variables for the Scan Work Task:</p></li>
</ol>
<blockquote>
<div><p>The app initializes the static variables from the boot arguments:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>ap_logging = os_get_boot_arg_int(“ap_logging”, 0);</p>
<p>//0 means infinity</p>
<p>num_iterations = os_get_boot_arg_int(“num_iterations”, 0);</p>
<p>//time between iterations (in seconds)</p>
<p>dt_iterations = os_get_boot_arg_int(“dt_iterations”,
TIME_BETWEEN_SCAN_ITERS);</p>
<p>assert(dt_iterations &gt;= 5);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Creation of WCM Object for the Wi-Fi Interface</p></li>
</ol>
<blockquote>
<div><p>In the following code, a Wi-Fi handle is created. The NULL parameter
in the wcm_create() specifies that no user-specified MAC address is
used, and the MAC address in the flash will be used to create the
Wi-Fi interface.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>h = wcm_create(NULL);</p>
<p>assert(h != NULL}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><p>Creation of Local Data for Wi-Fi Scan Results</p></li>
</ol>
<blockquote>
<div><p>Use the SDK provided data struct wifi_netinfo as the data object for
the scan results. This is the scan result data container.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>struct wifi_netinfo **scan_result;</p>
<p>scan_result = osal_alloc(max_nets * sizeof(void *));</p>
<p>assert(scan_result != NULL);</p>
<p>);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><p>Set-up of Wi-Fi Scan Parameter Block</p></li>
</ol>
<blockquote>
<div><p>Use the SDK provided data struct wifi_scan_param to retrieve the
default values for the Wi-Fi scan task from SDK in the param, get the
user-entry values from the bootargs, convert the values for format,
and populate the param with the new values for the scan task.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wifi_init_scan_default(&amp;param);</p>
<p>uint32_t channel_mask</p>
<p>= os_get_boot_arg_int(“wifi.scan_channel_mask”, 0xffffffff);</p>
<p>memset(param.channel_mask, 0, sizeof(param.channel_mask));</p>
<p>memcpy(&amp;param.channel_mask, &amp;channel_mask, sizeof(channel_mask));</p>
<p>tmp = os_get_boot_arg_str(“addr”);</p>
<p>if (tmp)</p>
<p>parse_macaddr(tmp, param.bssid);</p>
<p>param.txrate = os_get_boot_arg_int(“rate”, RATE_6);</p>
<p>tmp = os_get_boot_arg_str(“scan_ssid”);</p>
<p>if (tmp)</p>
<p>wifi_ssid_from_bytes(&amp;param.ssid, tmp, strlen(tmp));</p>
<p>max_listen_time = os_get_boot_arg_int(</p>
<p>“wifi.scan_max_listen_time”, param.max_listen_time / SYSTIME_MS(1));</p>
<p>min_listen_time = os_get_boot_arg_int(</p>
<p>“wifi.scan_min_listen_time”, param.min_listen_time / SYSTIME_MS(1));</p>
<p>wait_time = os_get_boot_arg_int(</p>
<p>“wifi.scan_wait_time”, param.wait_time / SYSTIME_MS(1));</p>
<p>probe_tx_timeout = os_get_boot_arg_int(</p>
<p>“wifi.scan_probe_tx_timeout”, param.probe_tx_timeout /
SYSTIME_MS(1));</p>
<p>param.min_listen_time = SYSTIME_MS(min_listen_time);</p>
<p>param.max_listen_time = SYSTIME_MS(max_listen_time);</p>
<p>param.wait_time = SYSTIME_MS(wait_time);</p>
<p>param.probe_tx_timeout = SYSTIME_MS(probe_tx_timeout);</p>
<p>param.num_probes</p>
<p>= os_get_boot_arg_int(“wifi.scan_num_probes”, param.num_probes);</p>
<p>param.idleslots</p>
<p>= os_get_boot_arg_int(“wifi.scan_idleslots”, param.idleslots);</p>
<p>param.max_responses</p>
<p>= os_get_boot_arg_int(“wifi.scan_max_responses”,
param.max_responses);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="7">
<li><p>Setup for the Suspend Mode Enable</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/* Enable device suspend (deep sleep) via boot argument */</p>
<p>if (os_get_boot_arg_int(“suspend”, 1) != 0)</p>
<p>os_suspend_enable();</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="8">
<li><p>Setup of the Scan Work Control Block</p></li>
</ol>
<blockquote>
<div><p>Populate the Scan work control block sworkt with the parameter block
and the scan result object:</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>// set up confs</p>
<p>twork.conf.counter = 0;</p>
<p>twork.conf.max_nets = max_nets;</p>
<p>twork.conf.h = h;</p>
<p>twork.conf.param = &amp;param;</p>
<p>twork.conf.scan_result = scan_result;</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="9">
<li><p>Scan operation</p></li>
</ol>
<blockquote>
<div><p>The function scan_work() is called every timeout of the interval that
is specified with dt_iterations.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>static void</p>
<p>scan_work()</p>
<p>{</p>
<p>int num_ap_found;</p>
<p>uint32_t next_tmo = os_systime() + SYSTIME_SEC(dt_iterations);</p>
<p>twork.conf.counter++;</p>
<p>num_ap_found = wcm_scan(twork.conf.h, twork.conf.param,</p>
<p>twork.conf.scan_result, twork.conf.max_nets);</p>
<p>pr_always(“Round:%u Found %d nets:\n”, twork.conf.counter,
num_ap_found); /*</p>
<p>More code …</p>
<p>*/</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="10">
<li><p>Display of the Scan Results</p></li>
</ol>
<blockquote>
<div><p>Under the set of the ap_logging flag, the data list from the scan
work is populated with API calls.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>if (ap_logging) {</p>
<p>for (int i = 0; i &lt; num_ap_found; i++) {</p>
<p>uint8_t chan;</p>
<p>char mode_name[64];</p>
<p>struct wifi_ssid ssid;</p>
<p>struct wifi_authmode authmode;</p>
<p>wifi_netinfo_get_ssid(twork.conf.scan_result[i], &amp;ssid);</p>
<p>wifi_netinfo_get_chan(twork.conf.scan_result[i], &amp;chan);</p>
<p>wifi_netinfo_get_authmode(twork.conf.scan_result[i], &amp;authmode);</p>
<p>wifi_netinfo_authmode_tostr(authmode.authmask, mode_name, 64);</p>
<p>pr_always(“%6pM on channel %2d &#64; %3d ‘%s’ ‘%s’\n”,</p>
<p>twork.conf.scan_result[i]-&gt;ni_bssid, chan,</p>
<p>twork.conf.scan_result[i]-&gt;ni_rssi, ssid.ws_ssid, mode_name);</p>
<p>}</p>
<p>}</p>
<p>wcm_free_scanresult(twork.conf.scan_result, num_ap_found);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application">
<h2>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this heading"></a></h2>
<p>Program lpscan.elf <em>(freertos_sdk_x.y\examples\lp_scan\bin)</em> using
the Download tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down</p></li>
<li><p>ELF Input: Load the lpscan.elf by clicking on Select ELF File.</p></li>
<li><p>Boot arguments: Pass the following boot arguments:</p></li>
</ol>
</li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wifi.scan_min_listen_time=8, wifi.scan_max_listen_time=24,
wifi.scan_num_probes=1, wifi.scan_idleslots=3, wifi.nap_scan=1,
dt_iterations=10, ap_logging=1, mpd.suspend=1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="4">
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</section>
<section id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h2>
<p>lpscan.elf is created when compiling the code which provides the
following console output when programmed to Talaria TWO:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PWWWWWWAE</p>
<p>Build $Id: git-2eebd42 $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-0080-0055-ffffffffffff</p>
<p>Bootargs: wifi.scan_min_listen_time=8 wifi.scan_max_listen_time=24
wifi.scan_num_probes=1 wifi.scan_idleslots=3 wifi.nap_scan=1
dt_iterations=5000 ap_logging=1 mpd.suspend=1</p>
<p>addr e0:69:3a:00:08:38</p>
<p>[0.566,075] Round:1 Found 12 nets:</p>
<p>[0.566,503] ac:9e:17:45:fc:28 on channel 8 &#64; -36 ‘Asus_AC87U’
‘WPA2-PSK+PMF’</p>
<p>[0.566,726] 10:c3:7b:52:6b:c8 on channel 11 &#64; -39 ‘dtim100’
‘WPA2-PSK+PMF’</p>
<p>[0.566,946] f6:c3:2a:92:3a:fa on channel 6 &#64; -40 ‘’ ‘WPA2-PSK’</p>
<p>[0.567,083] 00:24:a5:f1:8c:9e on channel 10 &#64; -45 ‘IP006’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>[0.567,199] 74:da:88:a9:02:dd on channel 4 &#64; -46 ‘TPLinkC3’
‘WPA2-PSK’</p>
<p>[0.567,310] ec:41:18:1a:d5:05 on channel 13 &#64; -46 ‘IP014’ ‘WPA2-PSK’</p>
<p>[0.567,423] 28:80:88:28:4c:d2 on channel 1 &#64; -48 ‘NGR8000_1’
‘WPA2-PSK+PMF’</p>
<p>[0.567,533] 8c:fe:74:35:40:a8 on channel 6 &#64; -54 ‘RuckusR500’
‘WPA2-PSK’</p>
<p>[0.567,670] bc:54:fc:c7:1c:8c on channel 8 &#64; -57 ‘IP011’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>[0.567,789] 14:d6:4d:25:67:b2 on channel 2 &#64; -57 ‘dlink’ ‘WPA2-PSK’</p>
<p>[0.567,896] d0:ae:ec:99:97:fc on channel 12 &#64; -57 ‘360cn’ ‘WPA2-PSK’</p>
<p>[0.568,339] 08:9b:b9:3d:1d:14 on channel 1 &#64; -65 ‘ATTsyYY4SQ’
‘WPA2-PSK+PMF’</p>
<p>[10.600,973] Round:2 Found 10 nets:</p>
<p>[10.601,061] 04:d4:c4:3e:74:88 on channel 6 &#64; -36 ‘AsusC3’
‘WPA2-PSK+PMF’</p>
<p>[10.601,174] 10:c3:7b:52:6b:c8 on channel 11 &#64; -38 ‘dtim100’
‘WPA2-PSK+PMF’</p>
<p>[10.601,290] 3c:7c:3f:62:5f:f8 on channel 6 &#64; -39 ‘AsusC4’
‘WPA2-PSK+PMF’</p>
<p>[10.601,403] e4:c3:2a:92:3a:fa on channel 6 &#64; -40 ‘TPLinkC4’
‘WPA2-PSK’</p>
<p>[10.601,843] 86:da:88:a9:02:dd on channel 4 &#64; -43 ‘’ ‘WPA2-PSKip’
‘WPA2-PSK+PMF’</p>
<p>[10.603,544] d0:ae:ec:99:97:fc on channel 12 &#64; -58 ‘360cn’ ‘WPA2-PSK’</p>
<p>[10.603,681] bc:54:fc:c7:1c:8c on channel 8 &#64; -59 ‘IP011’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>[10.603,795] 84:82:f4:35:f5:58 on channel 13 &#64; -61 ‘IP021’ ‘WPA2-PSK’</p>
<p>[10.604,019] 08:9b:b9:3d:1d:14 on channel 1 &#64; -63 ‘ATTsyYY4SQ’
‘WPA2-PSK+PMF’</p>
<p>[10.604,243] 14:1f:ba:7a:30:04 on channel 11 &#64; -66
‘NVR-2.4G_2M024D2PAZ00916’ ‘WPA2-PSK’</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Example_for_I2C.html" class="btn btn-neutral float-left" title="I2C" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Example_for_MQTT.html" class="btn btn-neutral float-right" title="MQTT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>