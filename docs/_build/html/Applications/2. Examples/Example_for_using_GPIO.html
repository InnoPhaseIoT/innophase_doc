<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPIO &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SNTP" href="Example_for_using_SNTP.html" />
    <link rel="prev" title="Filesystem" href="Example_for_using_Filesystem.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting%20Started/Getting%20Started%20-%20Landing%20Page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Hardware%20Reference/Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Software%20Reference/Software_Reference_Landing_Page.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Development%20Environments/Development%20Environments%20-%20Landing%20Page.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Tools/Tools-landing%20page.html">Tool</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#apps">Apps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Applications%20-%20Landing%20Page.html#examples">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Example_for_Analog_to_Digital_Converter.html">Analog to Digital Converter (ADC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Audio_over_I2S.html">Audio Over I2S</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_BLE_WiFi_Bridge.html">BLE WiFi Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Crash_handling.html">Crash Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_I2C.html">I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_LPScan.html">LPS Scan</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_MQTT.html">MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Pulse_Width_Modulation.html">Pulse Width Modulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Radio_and_Module_Parameters.html">Radio and Module Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Secure_Files.html">Secure Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Socket_Wakeup.html">Socket Wakeup</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_Software_SPI_Master.html">Software SPI Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_Chip_Monitor.html">Chip Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_Filesystem.html">Filesystem</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">GPIO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#demo-applications">Demo Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#evb-a-hardware-configuration">EVB-A Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building">Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-demo-apis">GPIO Demo APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-code-walkthrough">Source Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-blink-demo-example">GPIO Blink Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-flow">Application Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-code-walkthrough">Sample Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application">Running the Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output">Expected Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-suspend-demo-example">GPIO Suspend Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-flow-1">Application Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-code-walkthrough-1">Sample Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application-1">Running the Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output-1">Expected Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-suspend-mask-demo-example">GPIO Suspend Mask Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-flow-2">Application Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-code-walkthrough-2">Sample Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application-2">Running the Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output-2">Expected Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-interrupt-awake-demo-example">GPIO Interrupt Awake Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-flow-3">Application Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-code-walkthrough-3">Sample Code Walkthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application-3">Running the Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output-3">Expected Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_SNTP.html">SNTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_using_WiFi.html">WIFI</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_for_WiFi_Power_Management.html">WiFi Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_BLE_5_0.html">BLE 5.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_BLE_Beacons.html">BLE Beacon</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Custom_ATCMDLIB.html">Custom ATCMDLIB</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_HTTP_Client.html">HTTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_IFTTT.html">IFTTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Low_Power_UART.html">Low Power UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_mDNS.html">mDNS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html">Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#scan-data">Scan Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#configuration-data-format">Configuration Data Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#service">Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#characteristics">Characteristics</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#application-flow">Application Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#sample-code-walkthrough">Sample Code Walkthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#write-the-provisioning-file-into-talaria-two-filesystem">Write the Provisioning File into Talaria TWO Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#programming-talaria-two-board-with-elf">Programming Talaria TWO board with ELF</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Provisioning.html#running-the-application-using-android-or-ios-app">Running the Application using Android or iOS App</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Unassociated_Mode.html">Unassociated Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Watchdog_Timer.html">Watchlog Timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_WCM_Multi_AP.html">WCM Multi AP</a></li>
<li class="toctree-l3"><a class="reference internal" href="Example_using_Websock_Client.html">Websock Client</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Regulatory%20Notices/Regulatory%20Notices.html">Regulatory Notices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Porting%20Guide/Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Support/Support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Disclaimers/Disclaimers.html">Disclaimer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Appendix/Appendix-Landing_Page.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Applications%20-%20Landing%20Page.html">Applications</a></li>
      <li class="breadcrumb-item active">GPIO</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Applications/2. Examples/Example_for_using_GPIO.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gpio">
<h1>GPIO<a class="headerlink" href="#gpio" title="Permalink to this heading"></a></h1>
<p>This application note describes the usage of GPIO pins on Talaria TWO
module. Talaria TWO module allows up to 11 GPIOS to be configured as
digital I/O pins.</p>
<section id="demo-applications">
<h2>Demo Applications<a class="headerlink" href="#demo-applications" title="Permalink to this heading"></a></h2>
</section>
<section id="evb-a-hardware-configuration">
<h2>EVB-A Hardware Configuration<a class="headerlink" href="#evb-a-hardware-configuration" title="Permalink to this heading"></a></h2>
<p>The demo application utilizes the LED D1 on the Talaria TWO EVB-A board.
Use jumper on J3 header to connect LED D1 to GPIO14.</p>
<p><a class="reference internal" href="../../_images/image1.jpeg"><img alt="image1" src="../../_images/image1.jpeg" style="width: 6.49606in; height: 4.54969in;" /></a></p>
<p>Figure : Talaria TWO EVB-A</p>
</section>
<section id="building">
<h2>Building<a class="headerlink" href="#building" title="Permalink to this heading"></a></h2>
<p>To build the sample applications, execute the following commands from
the FreeRTOS SDK directory:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd examples/gpio</p>
<p>make</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The make command generates the following files in the out directory:</p>
<ol class="arabic simple">
<li><p>gpio_blink.elf</p></li>
<li><p>gpio_suspend.elf</p></li>
<li><p>gpio_interrupt_awake.elf</p></li>
<li><p>gpio_suspend_mask.elf</p></li>
</ol>
</section>
<section id="gpio-demo-apis">
<h2>GPIO Demo APIs<a class="headerlink" href="#gpio-demo-apis" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>os_suspend_enable(): Enables system suspend when idle.</p></li>
</ol>
<blockquote>
<div><p>Calling os_suspend_enable() enables system suspend (deep sleep). If
enabled, the system will go into a suspended mode when the processor
is idle. Entering and leaving suspend mode takes additional time.
Hence, enabling this will affect the real-time response of the
system.</p>
<p>When in a suspended state, the system will still wake up if an
interrupt occurs, but the latency will be much larger compared to
running with suspend mode disabled.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>os_suspend_disable(): Disables system suspend when idle.</p></li>
</ol>
<blockquote>
<div><p>When disabled, the system will never go into suspend mode. When the
system is idle, the kernel puts the CPU into low-power mode, ready to
swiftly resume execution if an interrupt occurs.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>os_gpio_set_irq_level_low(): Configures the GPIO input pin to signal
interrupt on low level.</p></li>
<li><p>os_gpio_set_irq_level_high(): Configures the GPIO input pin to signal
interrupt on high level.</p></li>
<li><p>os_gpio_set_value(os_gpio_set_t gpios_hi, os_gpio_set_t gpios_lo):
Sets the value of GPIO pins.</p></li>
</ol>
<blockquote>
<div><p>This function is used to change the value of several GPIO pins at
once. The pins in the gpio_hi set will be driven to ‘1’ and the pins
in the gpios_lo set will be set to level ‘0’.</p>
<p>Change of signals occur at the same time. This property might be
important when “bit-banging” some wire protocol which requires two
signals to change simultaneously.</p>
<p>Simpler functions for changing the output value: os_gpio_set_pin,
os_gpio_clr_pin().</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>os_gpio_request(): Allocates and setup pins as GPIO.</p></li>
</ol>
<blockquote>
<div><p>Allocate the specified pins and configure them as GPIO. The pins are
initially setup to be inputs. The direction of the pins can be
changed using os_gpio_set_output().</p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>os_gpio_set_input(): Sets up GPIO pins for input.</p></li>
</ol>
<blockquote>
<div><p>Configure the specified GPIO pins to be inputs.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>os_gpio_set_output(): Configures the specified GPIO pins to be
output pins.</p></li>
<li><p>os_gpio_enable_irq(): Enables the interrupt generation for the
specified set of GPIO input pins.</p></li>
<li><p>os_gpio_set_pull(): Configures the GPIO pull up/down, all pins
except GPIO18 are pullup.</p></li>
<li><p>os_gpio_get_value(): Reads the value of the specified GPIO pins.</p></li>
<li><p>os_gpio_clr_pin(): Clears the specified GPIO pins. Sets the output
value of the GPIO pins ‘0’.</p></li>
<li><p>os_gpio_set_pin(): Sets the specified GPIO pins. Sets the output
value of the GPIO pins to ‘1’.</p></li>
<li><p>os_gpio_attach_event(): Attaches an event handler function to a GPIO
event.</p></li>
<li><p>os_gpio_detach_event(): Detaches an attached event handler function
from a GPIO event.</p></li>
</ol>
</section>
<section id="source-code-walkthrough">
<h2>Source Code Walkthrough<a class="headerlink" href="#source-code-walkthrough" title="Permalink to this heading"></a></h2>
<p><strong>Note</strong>: All the applicable ELFs are available in the following
location of the SDK release package:
<em>freertos_sdk_x.y\examples\gpio\bin</em>.</p>
<p>x and y in freertos_sdk_x.y refer to the SDK release version.</p>
</section>
<section id="gpio-blink-demo-example">
<h2>GPIO Blink Demo Example<a class="headerlink" href="#gpio-blink-demo-example" title="Permalink to this heading"></a></h2>
</section>
<section id="application-flow">
<h2>Application Flow<a class="headerlink" href="#application-flow" title="Permalink to this heading"></a></h2>
<p>The GPIO blink demo application demonstrates toggling a GPIO output and
is connected to an LED on the Talaria TWO EVB-A.</p>
<p>Following steps describe the flow to toggle the GPIOs:</p>
<ol class="arabic simple">
<li><p>Allocates the specified pins and configures them as GPIO.</p></li>
<li><p>Sets up GPIO pins as output.</p></li>
<li><p>Toggles the GPIO to high and low.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough">
<h2>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough" title="Permalink to this heading"></a></h2>
<p>This section describes the procedure to configure the selected GPIO as
digital I/O and toggle the LEDs connected to the selected GPIOs. The
os_gpio_request() API requests the pins and configures the pin as GPIO,
os_gpio_set_output() API configures the GPIO pins as digital output
pins. os_gpio_clr_pin() is used to clear the specified GPIO pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>int led_pin = 1 &lt;&lt; LED_PIN;</p>
<p>os_gpio_request(led_pin);</p>
<p>os_gpio_set_output(led_pin);</p>
<p>os_gpio_clr_pin(led_pin);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>os_gpio_set_pin() is used to set the GPIO high and os_gpio_clr_pin() is
used to set GPIO low. This is the main thread where the LED blinks every
500ms by toggling the LED to high and low.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>vTaskDelay(500);</p>
<p>os_gpio_set_pin(led_pin);</p>
<p>os_wait_usec(500 * 1000);</p>
<p>os_gpio_clr_pin(led_pin);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application">
<h2>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this heading"></a></h2>
<p>Program gpio_blink.elf using the Download tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_blink.elf by clicking on Select ELF File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</li>
</ol>
</section>
<section id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h2>
<p>Once the application is downloaded onto the Talaria TWO EVB-A, the LED
D1 blinks every 500ms.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-ef87896f9 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWAE</p>
<p>Build $Id: git-df9b9ef $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-00b0-0064-ffffffffffff</p>
<p>Hello blinky</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="gpio-suspend-demo-example">
<h2>GPIO Suspend Demo Example<a class="headerlink" href="#gpio-suspend-demo-example" title="Permalink to this heading"></a></h2>
</section>
<section id="application-flow-1">
<span id="id1"></span><h2>Application Flow<a class="headerlink" href="#application-flow-1" title="Permalink to this heading"></a></h2>
<p>The GPIO suspend demo application is to demonstrate configuring GPIO as
an interrupt and is connected to an LED on the Talaria TWO EVB-A.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Initialize the semaphores, threads, and timer.</p></li>
<li><p>If or else statement puts Talaria TWO into sleep or awake state by
os_suspend_enable or disable APIs.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-1">
<span id="id2"></span><h2>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-1" title="Permalink to this heading"></a></h2>
<p>This section describes the function definition for the timer call back,
xSemaphoreGive()increments the value of semaphores and wakes up the
first thread. Inside event_wakeup() configuration, the interrupt level
and sleep state of the Talaria TWO depends on its current state.</p>
<p>If suspend is enabled os_suspend_enable(), then the IRQ level is set to
LOW. Here, Talaria TWO is in sleep state.</p>
<p>If suspend is disabled os_suspend_disable(), then the IRQ level is set
to HIGH. Here, Talaria TWO is awake.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>static int __irq</p>
<p>event_wakeup(uint32_t irqno, void *arg)</p>
<p>{</p>
<p>if (state) {</p>
<p>os_suspend_enable();</p>
<p>os_gpio_set_irq_level_low(wakeup_pin);</p>
<p>os_gpio_set_value(led_pin, 0);</p>
<p>os_printf(“sleeping\n”);</p>
<p>}</p>
<p>else {</p>
<p>os_suspend_disable();</p>
<p>os_gpio_set_irq_level_high(wakeup_pin);</p>
<p>os_gpio_set_value(0, led_pin);</p>
<p>os_printf(“awake\n”);</p>
<p>}</p>
<p>state ^= 1;</p>
<p>os_clear_event(EVENT_GPIO_3);</p>
<p>return IRQ_HANDLED;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This section describes the worker thread. When the state is set to 0,
the suspend is enabled. If not, it is disabled. This is commonly used as
a background task.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/* The worker thread */</p>
<p>static void my_thread(void* arg)</p>
<p>{</p>
<p>for (;;) {</p>
<p>xSemaphoreTake(work_sem, portMAX_DELAY);</p>
<p>if (state == 0) {</p>
<p>os_gpio_set_value(0, led_pin);</p>
<p>os_suspend_disable();</p>
<p>vTaskDelay(t_awake);</p>
<p>os_suspend_enable();</p>
<p>os_gpio_set_value(led_pin, 0);</p>
<p>os_printf(“.”);</p>
<p>} else {</p>
<p>os_printf(”’”);</p>
<p>}</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This section configures GPIO as an interrupt:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wakeup_pin = 1 &lt;&lt; os_get_boot_arg_int(“wakeup”, 18);</p>
<p>/* Request pin for led indication */</p>
<p>os_gpio_request(led_pin);</p>
<p>os_gpio_set_output(led_pin);</p>
<p>os_gpio_set_value(0, led_pin);</p>
<p>/* gpio wakeup */</p>
<p>state = 0;</p>
<p>/*Request pin for wakeup from suspend*/</p>
<p>os_gpio_request(wakeup_pin);</p>
<p>os_gpio_set_input(wakeup_pin);</p>
<p>os_gpio_set_irq_level_low(wakeup_pin);</p>
<p>/*gpio event that is wakeup capable from suspend*/</p>
<p>os_gpio_enable_irq(wakeup_pin, 3);</p>
<p>/*Register gpio wakeup event handler*/</p>
<p>os_attach_event(EVENT_GPIO_3, event_wakeup, NULL);</p>
<p>/*enable pull-up as the irq will trigger on high to low*/</p>
<p>os_gpio_set_pull(GPIO_PIN(wakeup_pin));</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Here, wakeup_pin (18) is configured as an interrupt which is triggered
whenever the GPIO18 is set to LOW. It is also configured to call
event_wakeup(), whenever Talaria TWO wakes up from GPIO interrupt
source.</p>
</section>
<section id="running-the-application-1">
<span id="id3"></span><h2>Running the Application<a class="headerlink" href="#running-the-application-1" title="Permalink to this heading"></a></h2>
<p>Program gpio_suspend.elf using the Download tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_suspend.elf by clicking on Select ELF
File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</li>
</ol>
</section>
<section id="expected-output-1">
<span id="id4"></span><h2>Expected Output<a class="headerlink" href="#expected-output-1" title="Permalink to this heading"></a></h2>
<p>Once the application is downloaded onto the Talaria TWO EVB-A, the LED
D1 is ON.</p>
<p>In the demo application, Talaria TWO goes into Sleep Mode and wakes up
and prints a ‘.’ every 300ms.</p>
<p>Next, use a jumper on GPIO18 and pull it LOW or connect it to GND.
Connecting GPIO18 to GND will wake the Talaria TWO from sleep, and then
go back to sleep.</p>
<p>This is achieved by attaching a GPIO interrupt on GPIO18. It is observed
that LED D1 is turned OFF every time Talaria TWO wakes up.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWAE</p>
<p>Build $Id: git-df9b9ef $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-00b0-0064-ffffffffffff</p>
<p>SUSPEND test</p>
<p>timer started</p>
<p>……………………………….awake</p>
<p>sleeping</p>
<p>awake</p>
<p>‘sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>……awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>‘sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>‘sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
<p>awake</p>
<p>sleeping</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="gpio-suspend-mask-demo-example">
<h2>GPIO Suspend Mask Demo Example<a class="headerlink" href="#gpio-suspend-mask-demo-example" title="Permalink to this heading"></a></h2>
</section>
<section id="application-flow-2">
<span id="id5"></span><h2>Application Flow<a class="headerlink" href="#application-flow-2" title="Permalink to this heading"></a></h2>
<p>The GPIO suspend mask demo application demonstrates configuring the
GPIOs as input or output when the Talaria TWO module is in suspend mode.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Configure the GPIOs to desired state.</p></li>
<li><p>Output enable (oe) for GPIO14 and GPIO5 using bit masking.</p></li>
<li><p>GPIO5 is set to HIGH when in suspend.</p></li>
<li><p>In a while (1) loop, GPIO5 is set to HIGH when in suspend and
previous GPIO level is restored for every configured interval (5
seconds).</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-2">
<span id="id6"></span><h2>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-2" title="Permalink to this heading"></a></h2>
<p>To configure the GPIOs to a desired state when Talaria TWO is in suspend
mode, os_gpio_masks_suspend_set(struct os_gpio_masks mask) can be used
according to the os_gpio_masks struct.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>struct os_gpio_masks {
uint32_t ie;
uint32_t oe;
uint32_t pe;
uint32_t o;
};</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>When the Talaria TWO module comes out of suspend mode, the kernel would
configure the GPIOs to their previous state before entering suspend.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>suspend_mask.ie = 0x00;</p>
<p>suspend_mask.oe = 0b100000000100000; //OE on gpio14 and gpio5</p>
<p>suspend_mask.pe = 0x00;</p>
<p>suspend_mask.o = 0b000000000100000; //gpio5 set to HIGH when suspend</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application-2">
<span id="id7"></span><h2>Running the Application<a class="headerlink" href="#running-the-application-2" title="Permalink to this heading"></a></h2>
<p>Program gpio_suspend_mask.elf using the Download Tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download Tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_suspend_mask.elf by clicking on Select ELF
File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</section>
<section id="expected-output-2">
<span id="id8"></span><h2>Expected Output<a class="headerlink" href="#expected-output-2" title="Permalink to this heading"></a></h2>
<p>As shown in Figure 2, connect the Talaria TWO board with the appropriate
GPIOs to the Logic Analyzer with the required wires, and check the Logic
analyzer’s output.</p>
<p><a class="reference internal" href="../../_images/image23.png"><img alt="image2" src="../../_images/image23.png" style="width: 5.90551in; height: 3.52683in;" /></a></p>
<p>Figure : GPIO suspend mask demo- Block diagram</p>
<p>As shown in Figure 3, GPIO 5 is set to HIGH when in suspend and previous
GPIO level is restored for every configure interval (5 seconds).</p>
<p><a class="reference internal" href="../../_images/image33.png"><img alt="image3" src="../../_images/image33.png" style="width: 6.29921in; height: 2.4958in;" /></a></p>
<p>Figure : Logic Analyzer output</p>
<p><strong>Console output</strong>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>Build $Id: git-b664be2af $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWAEBuild $Id: git-1ce73bb $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-0094-0054-ffffffffffff</p>
<p>GPIO Mask test</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="gpio-interrupt-awake-demo-example">
<h2>GPIO Interrupt Awake Demo Example<a class="headerlink" href="#gpio-interrupt-awake-demo-example" title="Permalink to this heading"></a></h2>
</section>
<section id="application-flow-3">
<span id="id9"></span><h2>Application Flow<a class="headerlink" href="#application-flow-3" title="Permalink to this heading"></a></h2>
<p>The GPIO interrupt awake demo application demonstrates the configuration
of two GPIO input pins to signal interrupt on low level.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Initialize the wakeup parameters.</p></li>
<li><p>Select a GPIO for waking up the Talaria TWO module and attach an
event handler function to a GPIO event.</p></li>
<li><p>Identify the wakeup source array index of the wakeup signal currently
being debounced.</p></li>
<li><p>Debouncing logic to detect the switch debouncing.</p></li>
<li><p>Callback function to show case enabling the interrupt.</p></li>
<li><p>Detach an attached event handler function from a GPIO event.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-3">
<span id="id10"></span><h2>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-3" title="Permalink to this heading"></a></h2>
<p>This section describes the main function of the gpio_interrupt_awake
application. It initializes the wakeup parameters and initiates the GPIO
configured as an interrupt pin through boot arguments.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wakeup_init();</p>
<p>wakeup_gpio = os_get_boot_arg_int(“key_pin”, 0xFF);</p>
<p>if(wakeup_gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_gpio_select(0, wakeup_gpio, WAKEUP_TRIG_LVL_LOW,</p>
<p>DEBOUNCE_TIME_MS, callback_1) == -1)</p>
<p>return -1;</p>
<p>}</p>
<p>wakeup_gpio = os_get_boot_arg_int(“pir_pin”, 0xFF);</p>
<p>if(wakeup_gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_gpio_select(1, wakeup_gpio, WAKEUP_TRIG_LVL_LOW,</p>
<p>DEBOUNCE_TIME_MS, callback_2) == -1)</p>
<p>return -1;</p>
<p>}</p>
<p>/*Enter suspend state*/</p>
<p>os_suspend_enable();</p>
<p>while(1){</p>
<p>vTaskDelay(10000);</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wakeup_init()initiates the wakeup parameters. wakeup_gpio_select()
selects a GPIO to wake up the Talaria TWO module and then the Talaria
TWO module will enter into suspend mode (sleep mode).</p>
<p>wakeup_gpio_select() selects a GPIO for waking up the Talaria TWO module
through an interrupt event (GPIO to which the wakeup source (Push button
switch) is connected).</p>
<p>os_gpio_set_irq_level_low() is a logic level of the GPIO pin when a
wakeup signal is invoked. This level is used for identifying the IRQ
level.</p>
<p>This block of code will attach an event handler function to a GPIO
event. The GPIO pin configured through the boot argument is an input pin
and the os_gpio_attach_event() attaches an event handler function to a
GPIO event.</p>
<p><strong>Note:</strong> In this example we have demonstrated event 3 (gpio_event_3).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>if(!os_gpio_request(GPIO_PIN(gpio_pin)) || wakeup_index &gt;=</p>
<p>MAX_WAKEUP_SOURCE_CNT) {</p>
<p>os_printf(”\n wakeup_gpio_select for gpio %d failed..!\n”,</p>
<p>gpio_pin);</p>
<p>return -1;</p>
<p>}</p>
<p>wakeup_src[wakeup_index].gpio = gpio_pin;</p>
<p>os_gpio_set_input(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>if(trigger_level == 0){</p>
<p>wakeup_src[wakeup_index].irq_level = 0;</p>
<p>os_gpio_set_irq_level_low(GPIO_PIN(wakeup_src[wakeup_in</p>
<p>dex].gpio));</p>
<p>}</p>
<p>wakeup_src[wakeup_index].wakeup_clbk = fptr;</p>
<p>wakeup_src[wakeup_index].debounce_ms = 1000UL * debounce_ms;</p>
<p>os_gpio_attach_event(gpio_event_3, gpio_changed, NULL);</p>
<p>wakeup_src[wakeup_index].xTimer = xTimerCreate(</p>
<p>/* Just a text name, not used by the RTOS kernel. */</p>
<p>“Timer”,</p>
<p>/* The timer period in ticks, must be greater than 0. */</p>
<p>wakeup_src[wakeup_index].debounce_ms,</p>
<p>/* The timers will auto-reload themselves when they expire. */</p>
<p>pdFALSE,</p>
<p>/* The ID is used to store a count of the number of times the</p>
<p>timer has expired, which is initialised to 0. */</p>
<p>(void*)0,</p>
<p>/* Each timer calls the same callback when it expires. */</p>
<p>vTimerCallback);</p>
<p>if (wakeup_src[wakeup_index].xTimer == NULL) {</p>
<p>/* The timer was not created. */</p>
<p>os_printf(“timer create failed.!\n”);</p>
<p>return -1;</p>
<p>}</p>
<p>os_gpio_enable_irq(GPIO_PIN(wakeup_src[wakeup_index].gpio), 3);</p>
<p>//Testing with gpio event 3 for key_pin</p>
<p>os_printf(”\n gpio-%d is selected for the interrupt \n”,</p>
<p>wakeup_src[wakeup_index].gpio);</p>
<p>return 0;</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>After attaching the event, the timer will be created to check the
interrupt occurrence in the configured GPIO PIN.</p>
<p>If an interrupt occurs in any of the configured GPIO pins, the
gpio_changed() handler function will be executed. The GPIO ISR handler
finds which wake-up source triggered the IRQ.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/* find which wakeup source triggered the IRQ */</p>
<p>wakeup_index = wakeup_index_from_irq();</p>
<p>if (wakeup_index != 0xFF) {</p>
<p>// delay for debounce</p>
<p>if (xTimerStart(wakeup_src[wakeup_index].xTimer, 0) != pdPASS) {</p>
<p>while (1)</p>
<p>;</p>
<p>}</p>
<p>/* disable all wakeup source IRQs, debounce one at a time */</p>
<p>disable_wakeup_irqs();</p>
<p>wakeup_src[wakeup_index].debouncing = true;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The wakeup_index_from_irq()identifies which wakeup source is causing the
interruption.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;
wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].invoked == true)</p>
<p>{</p>
<p>irq_level = !wakeup_src[wakeup_index].irq_level;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>irq_level = wakeup_src[wakeup_index].irq_level;</p>
<p>}</p>
<p>gpio_val = os_gpio_get_value(</p>
<p>GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>gpio_val = gpio_val &gt;&gt; wakeup_src[wakeup_index].gpio;</p>
<p>if(irq_level == (uint8_t)gpio_val)</p>
<p>{</p>
<p>return wakeup_index;</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The xTimerStart() executes the timer delay function and debounce logic
to avoid registering multiple interrupts in a short period of time. The
debouncing logic executes the 40ms debouncing time.</p>
<p>The disable_wakeup_irqs() will disable all wakeup source IRQs, debounce
one at a time and it will find which wakeup source is being debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;</p>
<p>wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>os_gpio_disable_irq(GPIO_PIN(</p>
<p>wakeup_src[wakeup_index].gpio));</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The debouncing_wakeup_src()identifies the wake-up source array index of
the wake-up signal currently being debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;</p>
<p>wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].debouncing == true)</p>
<p>{</p>
<p>return wakeup_index;</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The debounce_fn()is called from the configured callout. This callout
function is for debouncing the wakeup signal. The debounce logic will
validate that the wake-up signal is in a stable state after the delay.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index = debouncing_wakeup_src();</p>
<p>if(wakeup_src[wakeup_index].invoked == false){</p>
<p>if(wakeup_src[wakeup_index].irq_level == 0){</p>
<p>if(os_gpio_get_value</p>
<p>(GPIO_PIN(wakeup_src[wakeup_index].gpio)) == false){</p>
<p>wakeup_src[wakeup_index].invoked = true;</p>
<p>os_gpio_set_irq_level_high</p>
<p>(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>// send message to custom task</p>
<p>wakeup_src[wakeup_index].invoke_count++;</p>
<p>wakeup_src[wakeup_index].wakeup_clbk();</p>
<p>os_suspend_disable();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>else{</p>
<p>if(wakeup_src[wakeup_index].irq_level == 0){</p>
<p>if(os_gpio_get_value(</p>
<p>GPIO_PIN(wakeup_src[wakeup_index].gpio)) != false){</p>
<p>wakeup_src[wakeup_index].invoked = false;</p>
<p>os_gpio_set_irq_level_low(</p>
<p>GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>os_suspend_enable();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>if ((wakeup_src[wakeup_index].invoke_count) == 10){</p>
<p>os_gpio_detach_event(gpio_event_3, gpio_changed);</p>
<p>os_printf(” \n Interrupt_count exceeded to -%d \n”,</p>
<p>wakeup_src[wakeup_index].invoke_count);</p>
<p>}</p>
<p>enable_wakeup_irqs();</p>
<p>wakeup_src[wakeup_index].debouncing = false;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> The debounce logic will count the number of interrupt
occurrences. Once the number of interrupts equals 10, the
os_gpio_detach_event()will detach an attached event handler function
from a GPIO event. Also, Talaria TWO module will enter awake state.</p>
<p>enable_wakeup_irqs()enables the interrupt from all wake-up sources once
the switch is debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;</p>
<p>wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>os_gpio_enable_irq(</p>
<p>GPIO_PIN(wakeup_src[wakeup_index].gpio), 3);</p>
<p>/*Testing with <em>gpio</em> event 3 for key_pin */</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application-3">
<span id="id11"></span><h2>Running the Application<a class="headerlink" href="#running-the-application-3" title="Permalink to this heading"></a></h2>
<p>Program gpio_interrupt_awake.elf using the Download tool:</p>
<ol class="arabic simple" start="3">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p></li>
</ol>
<ol class="loweralpha simple" start="4">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_interrupt_awake.elf by clicking on Select
ELF File.</p></li>
<li><p>Boot Arguments: Pass the following boot arguments:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>key_pin=20, pir_pin=21</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="7">
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</section>
<section id="expected-output-3">
<span id="id12"></span><h2>Expected Output<a class="headerlink" href="#expected-output-3" title="Permalink to this heading"></a></h2>
<p>In the demo application, Talaria TWO goes into Sleep Mode. Use a push
button switch on which all the GPIOs are configured as an Interrupt.
Connecting push button switch to GND will wake the Talaria TWO from
sleep, and then goes back to sleep.</p>
<p>After ten (10) interrupts in any one of the configured interrupt pins,
the application will detach an attached event handler function from a
GPIO event.</p>
<p><strong>Note</strong>: In this example, GPIO 20 and 21 are used as an external
interrupt pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWAEBuild $Id: git-1ce73bb $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-0094-0054-ffffffffffff</p>
<p>Interrupt test</p>
<p>UART:SNWWWWAE</p>
<p>Build $Id: git-b664be2af $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWAEBuild $Id: git-1ce73bb $</p>
<p>Flash detected. flash.hw.uuid: 39483937-3207-0094-0054-ffffffffffff</p>
<p>Bootargs: key_pin=20 pir_pin=21</p>
<p>Interrupt test</p>
<p>gpio-20 is selected for the interrupt</p>
<p>gpio-21 is selected for the interrupt</p>
<p>Key_Pin interrupt enabled</p>
<p>Pir_pin interrupt enabled</p>
<p>Key_Pin interrupt enabled</p>
<p>Pir_pin interrupt enabled</p>
<p>Key_Pin interrupt enabled</p>
<p>Pir_pin interrupt enabled</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image43.png"><img alt="image4" src="../../_images/image43.png" style="width: 6.10236in; height: 3.51897in;" /></a></p>
<p>Figure : Otii capture for gpio_interrupt_awake application</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Example_for_using_Filesystem.html" class="btn btn-neutral float-left" title="Filesystem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Example_for_using_SNTP.html" class="btn btn-neutral float-right" title="SNTP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>