<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction" href="Host%20Interface%20Protocol.html" />
    <link rel="prev" title="Introduction" href="Firmware%20Over%20the%20Air%20Upgrade.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Getting_Started_Landing_page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Software_Reference/Prerequisites/libusbK_driver-Zadig.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Development_Environments/Development_Environments.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Tools_Landing.html">Tools</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Applications-Landing_Page.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#alarm">1.  Alarm</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#analog-to-digital-converter">2.  Analog to Digital Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#audio-over-i2s">3.  Audio over I2S</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-5-0">4.  BLE 5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-beacons">3.  BLE Beacons</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-wi-fi-bridge">4.  BLE Wi-Fi Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#chip-monitor">5.  Chip Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#crash-handling">6.  Crash Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#custom-atcmdlib">6.  Custom ATCMDLIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#filesystem">7.  Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#firmware-over-the-air-upgrade">8.  Firmware Over the Air Upgrade</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="Applications-Landing_Page.html#gpio">9.  GPIO</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demo-applications">Demo Applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#evb-a-hardware-configuration">EVB-A Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building">Building</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpio-demo-apis">GPIO Demo APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#source-code-walkthrough">Source Code Walkthrough</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpio-blink-demo-example">GPIO Blink Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-suspend-demo-example">GPIO Suspend Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-suspend-mask-demo-example">GPIO Suspend Mask Demo Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-interrupt-awake-demo-example">GPIO Interrupt Awake Demo Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#host-interface-protocol">10. Host Interface Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#http-client">11. HTTP Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#i2c">12. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ifttt">13. IFTTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-aws">14. IoT AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-azure">15. IoT Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-scan">16. Low Power Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-uart">17. Low Power UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mdns">18. mDNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#memory-management-and-error-handling">19.  Memory Management and Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#message-queues">20.  Message Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mqtt">21.  MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#provisioning">22.  Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#pulse-width-modulation">23.  Pulse Width Modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#radio-and-module-parameters">24. Radio and Module Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#secure-files">25. Secure Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#simple-network-time-protocol">26.  Simple Network Time Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#sleep-enable-disable">27.  Sleep Enable Disable</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#socket-wakeup">28. Socket Wakeup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#software-spi-master">29. Software SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#spi-flash">30. SPI Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ssbl">31. SSBL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#thread-and-semaphores">32.  Thread and Semaphores</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#throughput-measurement">32.  Throughput Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#timers-and-callouts">33. Timers and Callouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#unassociated-mode">34. Unassociated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#using-wi-fi">35. Using Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#watchdog-timer">36. Watchdog Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#websocket-client">37. Websocket Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-connection-manager-multi-ap">38. Wi-Fi Connection Manager Multi-AP</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-power-management">39. Wi-Fi Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#work-queues">40. Work Queues</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Regulatory%20Notices/Regulatory%20Notices.html">Regulatory Notice</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Backend%20Files%20-%20for%20cross%20referencing/Backend%20File%20Landing.html">Backend Files - for cross referencing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Applications-Landing_Page.html">Applications</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Applications/GPIO.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<p>This application note describes the usage of GPIO pins on Talaria TWO
module. Talaria TWO module allows up to 11 GPIOS to be configured as
digital I/O pins.</p>
</section>
<section id="demo-applications">
<h1>Demo Applications<a class="headerlink" href="#demo-applications" title="Permalink to this heading"></a></h1>
<section id="evb-a-hardware-configuration">
<h2>EVB-A Hardware Configuration<a class="headerlink" href="#evb-a-hardware-configuration" title="Permalink to this heading"></a></h2>
<p>The demo application utilizes the LED D1 on the Talaria TWO EVB-A board.
Use jumper on J3 header to connect LED D1 to GPIO14.</p>
<p><a class="reference internal" href="../_images/image1.jpeg"><img alt="image1" src="../_images/image1.jpeg" style="width: 4.72441in; height: 3.30886in;" /></a></p>
<p>Figure : Talaria TWO EVB-A</p>
</section>
<section id="building">
<h2>Building<a class="headerlink" href="#building" title="Permalink to this heading"></a></h2>
<p>To build the sample applications, execute the following commands from
the SDK directory:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd examples/gpio</p>
<p>make</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The make command generates the following files in the out directory:</p>
<ol class="arabic simple">
<li><p>gpio_blink.elf</p></li>
<li><p>gpio_suspend.elf</p></li>
<li><p>gpio_interrupt_awake.elf</p></li>
<li><p>gpio_suspend_mask.elf</p></li>
</ol>
</section>
</section>
<section id="gpio-demo-apis">
<h1>GPIO Demo APIs<a class="headerlink" href="#gpio-demo-apis" title="Permalink to this heading"></a></h1>
<ol class="arabic simple">
<li><p>os_sem_post(): Unlocks semaphore.</p></li>
</ol>
<blockquote>
<div><p>Increments the value of a semaphore and wakes the first thread
waiting for this semaphore.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>callout_schedule_at(): Schedules callback at absolute time.</p></li>
</ol>
<blockquote>
<div><p>This function is identical to callout_schedule(), except that it
takes an absolute time to specify when the callout expires.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>os_suspend_enable(): Enables system suspend when idle.</p></li>
</ol>
<blockquote>
<div><p>Calling os_suspend_enable() will enable system suspend (deep sleep).
If enabled, the system will go into a suspended mode when the
processor is idle. Entering and leaving suspend mode takes additional
time. Hence, enabling this will affect the real-time response of the
system.</p>
<p>When in a suspended state, the system will still wake up if an
interrupt occurs, but the latency will be much larger compared to
running with suspend mode disabled.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>os_suspend_disable(): Disables system suspend when idle.</p></li>
</ol>
<blockquote>
<div><p>When disabled, the system will never go into suspend mode. When the
system is idle, the kernel puts the CPU into low-power mode, ready to
swiftly resume execution if an interrupt occurs.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>os_gpio_set_irq_level_low(): Configures the GPIO input pin to signal
interrupt on low level.</p></li>
<li><p>os_gpio_set_irq_level_high(): Configures the GPIO input pin to signal
interrupt on high level.</p></li>
<li><p>os_gpio_set_value(os_gpio_set_t gpios_hi, os_gpio_set_t gpios_lo):
Sets the value of GPIO pins.</p></li>
</ol>
<blockquote>
<div><p>This function is used to change the value of several GPIO pins at
once. The pins in the gpio_hi set will be driven to ‘1’ and the pins
in the gpios_lo set will be set to level ‘0’.</p>
<p>Change of signals occur at the same time. This property might be
important when “bit-banging” some wire protocol which requires two
signals to change simultaneously.</p>
<p>Simpler functions for changing the output value: os_gpio_set_pin,
os_gpio_clr_pin().</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>os_sem_wait(): Locks a semaphore.</p></li>
</ol>
<blockquote>
<div><p>If the value of the semaphore is greater than zero, decrement the
counter. If the value is zero, it puts the current thread to sleep
until the value becomes positive. This function cannot be used in
interrupt context.</p>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>os_gpio_request(): Allocates and setup pins as GPIO.</p></li>
</ol>
<blockquote>
<div><p>Allocate the specified pins and configure them as GPIO. The pins are
initially setup to be inputs. The direction of the pins can be
changed using os_gpio_set_output().</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>os_gpio_set_input(): Sets up GPIO pins for input.</p></li>
</ol>
<blockquote>
<div><p>Configure the specified GPIO pins to be inputs.</p>
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>os_gpio_set_output(): Configures the specified GPIO pins to be
output pins.</p></li>
<li><p>os_gpio_enable_irq(): Enables the interrupt generation for the
specified set of GPIO input pins.</p></li>
<li><p>os_gpio_set_pull(): Configures the GPIO pull up/down, all pins
except GPIO18 are pullup.</p></li>
<li><p>os_gpio_get_value(): Reads the value of the specified GPIO pins.</p></li>
<li><p>os_sem_init(): Initializes a semaphore.</p></li>
</ol>
<blockquote>
<div><p>This must be performed before other operations. It is possible to
statically initialize a semaphore with the OS_SEM_INITALIZER macro.</p>
</div></blockquote>
<ol class="arabic simple" start="16">
<li><p>os_create_thread(): Creates a new thread.</p></li>
</ol>
<blockquote>
<div><p>This creates a new thread with priority specified in flags (via
OS_CRTHREAD_PRIO macro). The thread is placed in the run queue, but
there is no immediate reschedule. The thread continues to run until
the entry point returns, at which point return value (a pointer) can
be obtained with os_join_thread. If the return value is of no
consequence, OS_CRTHREAD_DETACHED can be passed in flags. This causes
the OS to reap the thread.</p>
</div></blockquote>
<ol class="arabic simple" start="17">
<li><p>callout_init(): Initializes a callout object.</p></li>
<li><p>os_join_thread(): Waits for a thread to terminate and destroy the
thread.</p></li>
</ol>
<blockquote>
<div><p>Calling this function will suspend execution of the calling thread
until the target thread exits. The memory used to hold the threads
stack and control block is freed.</p>
</div></blockquote>
<ol class="arabic simple" start="19">
<li><p>os_gpio_clr_pin(): Clears the specified GPIO pins. Sets the output
value of the GPIO pins ‘0’.</p></li>
<li><p>os_gpio_set_pin(): Sets the specified GPIO pins. Sets the output
value of the GPIO pins to ‘1’.</p></li>
<li><p>os_gpio_attach_event(): Attaches an event handler function to a GPIO
event.</p></li>
<li><p>os_gpio_detach_event(): Detaches an attached event handler function
from a GPIO event.</p></li>
</ol>
</section>
<section id="source-code-walkthrough">
<h1>Source Code Walkthrough<a class="headerlink" href="#source-code-walkthrough" title="Permalink to this heading"></a></h1>
<section id="gpio-blink-demo-example">
<h2>GPIO Blink Demo Example<a class="headerlink" href="#gpio-blink-demo-example" title="Permalink to this heading"></a></h2>
<section id="application-flow">
<h3>Application Flow<a class="headerlink" href="#application-flow" title="Permalink to this heading"></a></h3>
<p>The GPIO blink demo application demonstrates toggling a GPIO output and
is connected to an LED on the Talaria TWO EVB-A.</p>
<p>Following steps describe the flow to toggle the GPIOs:</p>
<ol class="arabic simple">
<li><p>Allocates the specified pins and configures them as GPIO.</p></li>
<li><p>Sets up GPIO pins as output.</p></li>
<li><p>Toggles the GPIO to high and low.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough">
<h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough" title="Permalink to this heading"></a></h3>
<p>This section describes the procedure to configure the selected GPIO as
digital I/O and toggle the LEDs connected to the selected GPIOs. The
os_gpio_request() API requests the pins and configures the pin as GPIO,
os_gpio_set_output() API configures the GPIO pins as digital output
pins. os_gpio_clr_pin() is used to clear the specified GPIO pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>int led_pin = 1 &lt;&lt; LED_PIN;</p>
<p>os_gpio_request(led_pin);</p>
<p>os_gpio_set_output(led_pin);</p>
<p>os_gpio_clr_pin(led_pin);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>os_gpio_set_pin() is used to set the GPIO high and os_gpio_clr_pin() is
used to set GPIO low. This is the main thread where the LED blinks every
500ms by toggling the LED to high and low.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>os_wait_usec(500 * 1000);</p>
<p>os_gpio_set_pin(led_pin);</p>
<p>os_wait_usec(500 * 1000);</p>
<p>os_gpio_clr_pin(led_pin);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application">
<h3>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this heading"></a></h3>
<p>Program gpio_blink.elf (sdk_x.y\examples\gpio\bin) using the Download
tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_blink.elf by clicking on Select ELF File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</li>
</ol>
<p>For more details on using the Download tool, refer to the document:
UG_Download_Tool.pdf (path: <em>sdk_x.y\pc_tools\Download_Tool\doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the SDK release version. For example:
<em>sdk_2.5\doc</em>.</p>
</section>
<section id="expected-output">
<h3>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h3>
<p>Once the application is downloaded onto the Talaria TWO EVB-A, the LED
D1 blinks every 500ms.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:NWWWWAE</p>
<p>Build $Id: git-b664be2af $</p>
<p>hio.baudrate=115200</p>
<p>flash: Gordon ready!</p>
<p>UART:NWWWAEBuild $Id: git-b664be2af $</p>
<p>Hello blinky</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="gpio-suspend-demo-example">
<h2>GPIO Suspend Demo Example<a class="headerlink" href="#gpio-suspend-demo-example" title="Permalink to this heading"></a></h2>
<section id="application-flow-1">
<span id="id1"></span><h3>Application Flow<a class="headerlink" href="#application-flow-1" title="Permalink to this heading"></a></h3>
<p>The GPIO suspend demo application is to demonstrate configuring GPIO as
an interrupt and is connected to an LED on the Talaria TWO EVB-A.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Initializes the semaphores, threads, and callouts.</p></li>
<li><p>Creates a scheduler.</p></li>
<li><p>If or else statement to put Talaria TWO into sleep or awake state by
os_suspend_enable or disable APIs.</p></li>
<li><p>Worker thread used as a background task.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-1">
<span id="id2"></span><h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-1" title="Permalink to this heading"></a></h3>
<p>This section describes the function definition for scheduler,
os_sem_post() will increment the value of semaphores and wakes up the
first thread, callout_scedule_at() will check for the absolute time to
specify when the callout expires.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>os_sem_post( &amp;work_sem );</p>
<p>wakeup_time += t_cycle;</p>
<p>callout_schedule_at(c, wakeup_time);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Inside event_wakeup() configuration, the interrupt level and sleep state
of the Talaria TWO depends on its current state.</p>
<p>If suspend is enabled os_suspend_enable() then the IRQ level is set to
low. Here, Talaria TWO is at sleeping state.</p>
<p>If suspend is disabled os_suspend_disable() then the IRQ level is set to
high. Here, Talaria TWO is awake.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>static int __irq</p>
<p>event_wakeup(uint32_t irqno, void *arg)</p>
<p>{</p>
<p>if (state) {</p>
<p>os_suspend_enable();</p>
<p>os_gpio_set_irq_level_low(wakeup_pin);</p>
<p>os_gpio_set_value(led_pin, 0);</p>
<p>os_printf(“sleeping\n”);</p>
<p>}</p>
<p>else {</p>
<p>os_suspend_disable();</p>
<p>os_gpio_set_irq_level_high(wakeup_pin);</p>
<p>os_gpio_set_value(0, led_pin);</p>
<p>os_printf(“awake\n”);</p>
<p>}</p>
<p>state ^= 1;</p>
<p>os_clear_event(EVENT_GPIO_3);</p>
<p>return IRQ_HANDLED;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This section describes the worker thread. When the state is set to 0,
the suspend is enabled. If not, it is disabled. This is commonly used as
a background task.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>static void* my_thread(void* arg)</p>
<p>{</p>
<p>for(;;) {</p>
<p>os_sem_wait( &amp;work_sem );</p>
<p>if (state == 0) {</p>
<p>os_gpio_set_value(0, led_pin);</p>
<p>os_suspend_disable();</p>
<p>os_usleep(t_awake);</p>
<p>os_suspend_enable();</p>
<p>os_gpio_set_value(led_pin, 0);</p>
<p>os_printf(“.”);</p>
<p>}</p>
<p>else {</p>
<p>os_printf(”’”);</p>
<p>}</p>
<p>}</p>
<p>return NULL;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>This section configures a GPIO as an interrupt:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wakeup_pin = 1&lt;&lt; os_get_boot_arg_int(“wakeup”, 18);</p>
<p>…</p>
<p>os_gpio_request(wakeup_pin);</p>
<p>os_gpio_set_input(wakeup_pin);</p>
<p>os_gpio_set_irq_level_low(wakeup_pin);</p>
<p>os_gpio_enable_irq(wakeup_pin, 3);</p>
<p>os_attach_event(EVENT_GPIO_3, event_wakeup, NULL);</p>
<p>os_gpio_set_pull(GPIO_PIN(wakeup_pin));</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Here, wakeup_pin (18) is configured as an interrupt which is triggered
whenever the GPIO18 is set to LOW. It is also configured to call
event_wakeup(), whenever Talaria TWO wakes up from GPIO interrupt
source.</p>
</section>
<section id="running-the-application-1">
<span id="id3"></span><h3>Running the Application<a class="headerlink" href="#running-the-application-1" title="Permalink to this heading"></a></h3>
<p>Program gpio_suspend.elf(sdk_x.y\examples\gpio\bin) using the
Download tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_suspend.elf by clicking on Select ELF
File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
</li>
</ol>
<p>For more details on using the Download tool, refer to the document:
UG_Download_Tool.pdf (path: <em>sdk_x.y\pc_tools\Download_Tool\doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the SDK release version. For example:
<em>sdk_2.5\doc</em>.</p>
</section>
<section id="expected-output-1">
<span id="id4"></span><h3>Expected Output<a class="headerlink" href="#expected-output-1" title="Permalink to this heading"></a></h3>
<p>Once the application is downloaded onto the Talaria TWO EVB-A, the LED
D1 is ON.</p>
<p>In the demo application, Talaria TWO goes into Sleep Mode and wakes up
and prints a ‘.’ every 300ms.</p>
<p>Next, use a jumper on GPIO18 and pull it LOW or connect it to GND.
Connecting GPIO18 to GND will wake the Talaria TWO from sleep, and then
go back to sleep.</p>
<p>This is achieved by attaching a GPIO interrupt on GPIO18. It is observed
that LED D1 is turned OFF every time Talaria TWO wakes up.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:NWWWWAE</p>
<p>Build $Id: git-b664be2af $</p>
<p>hio.baudrate=115200</p>
<p>flash: Gordon ready!</p>
<p>UART:NWWWAEBuild $Id: git-b664be2af $</p>
<p>SUSPEND test</p>
<p>awake</p>
<p>‘’’’’’’’’’’’’’’’’’’’’sleeping</p>
<p>………………………………..awake</p>
<p>‘’’’’’’’’’’’’’’’’’’’’’’’’’’’’’’’’sleeping</p>
<p>awake</p>
<p>‘’’’’’’’sleeping</p>
<p>..awake</p>
<p>sleeping</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="gpio-suspend-mask-demo-example">
<h2>GPIO Suspend Mask Demo Example<a class="headerlink" href="#gpio-suspend-mask-demo-example" title="Permalink to this heading"></a></h2>
<section id="application-flow-2">
<span id="id5"></span><h3>Application Flow<a class="headerlink" href="#application-flow-2" title="Permalink to this heading"></a></h3>
<p>The GPIO suspend mask demo application demonstrates configuring the
GPIOs as input or output when the Talaria TWO module is in suspend mode.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Configure the GPIOs to desired state.</p></li>
<li><p>Output enable (oe) for GPIO14 and GPIO5 using bit masking.</p></li>
<li><p>GPIO5 is set to HIGH when in suspend.</p></li>
<li><p>In a while (1) loop, GPIO5 is set to HIGH when in suspend and
previous GPIO level is restored for every configured interval (5
seconds).</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-2">
<span id="id6"></span><h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-2" title="Permalink to this heading"></a></h3>
<p>To configure the GPIOs to a desired state when Talaria TWO is in suspend
mode, os_gpio_masks_suspend_set(struct os_gpio_masks mask) can be used
according to the os_gpio_masks struct.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Struct os_gpio_masks {
uint32_t ie;
uint32_t oe;
uint32_t pe;
uint32_t o;
};</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>When the Talaria TWO module comes out of suspend mode, the kernel would
configure the GPIOs to their previous state before entering suspend.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>suspend_mask.ie = 0x00;</p>
<p>suspend_mask.oe = 0b100000000100000; //OE on gpio14 and gpio5</p>
<p>suspend_mask.pe = 0x00;</p>
<p>suspend_mask.o = 0b000000000100000; //gpio5 set to HIGH when suspend</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application-2">
<span id="id7"></span><h3>Running the Application<a class="headerlink" href="#running-the-application-2" title="Permalink to this heading"></a></h3>
<p>Program gpio_suspend_mask.elf (<em>sdk_x.y\examples\gpio\bin</em>) using the
Download Tool:</p>
<ol class="arabic simple">
<li><p>Launch the Download Tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_suspend_mask.elf by clicking on Select ELF
File.</p></li>
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
<p>For more details on using the Download tool, refer to the document:
UG_Download_Tool.pdf (path: <em>sdk_x.y\pc_tools\Download_Tool\doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the SDK release version. For example:
<em>sdk_2.5\doc</em>.</p>
</section>
<section id="expected-output-2">
<span id="id8"></span><h3>Expected Output<a class="headerlink" href="#expected-output-2" title="Permalink to this heading"></a></h3>
<p>As shown in Figure 2, connect the Talaria TWO board with the appropriate
GPIOs to the Logic Analyzer with the required wires, and check the Logic
analyzer’s output.</p>
<p><a class="reference internal" href="../_images/image21.png"><img alt="image2" src="../_images/image21.png" style="width: 4.78033in; height: 2.85486in;" /></a></p>
<p>Figure : GPIO suspend mask demo- Block diagram</p>
<p>As shown in Figure 3, GPIO 5 is set to HIGH when in suspend and previous
GPIO level is restored for every configure interval (5 seconds).</p>
<p><a class="reference internal" href="../_images/image31.png"><img alt="image3" src="../_images/image31.png" style="width: 6.29921in; height: 2.4958in;" /></a></p>
<p>Figure : Logic Analyzer output</p>
<p><strong>Console output</strong>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWAEBuild $Id: git-34e3eddb8 $</p>
<p>GPIO Mask test</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
<p>T2 sleeping</p>
<p>T2 awake</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="gpio-interrupt-awake-demo-example">
<h2>GPIO Interrupt Awake Demo Example<a class="headerlink" href="#gpio-interrupt-awake-demo-example" title="Permalink to this heading"></a></h2>
<section id="application-flow-3">
<span id="id9"></span><h3>Application Flow<a class="headerlink" href="#application-flow-3" title="Permalink to this heading"></a></h3>
<p>The GPIO interrupt awake demo application demonstrates the configuration
of two GPIO input pins to signal interrupt on low level.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Initialize the wakeup parameters.</p></li>
<li><p>Select a GPIO for waking up the Talaria TWO module and attach an
event handler function to a GPIO event.</p></li>
<li><p>Identify the wakeup source array index of the wakeup signal currently
being debounced.</p></li>
<li><p>Debouncing logic to detect the switch debouncing.</p></li>
<li><p>Callback function to show case enabling the interrupt.</p></li>
<li><p>Detach an attached event handler function from a GPIO event.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-3">
<span id="id10"></span><h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-3" title="Permalink to this heading"></a></h3>
<p>This section describes the main function of the gpio_interrupt_awake
application. It initializes the wakeup parameters and initiates the GPIO
configured as an interrupt pin through boot arguments.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wakeup_init();</p>
<p>wakeup_gpio = os_get_boot_arg_int(“key_pin”, 0xFF);</p>
<p>if(wakeup_gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_gpio_select(0, wakeup_gpio, WAKEUP_TRIG_LVL_LOW,
DEBOUNCE_TIME_MS, callback_1) == -1)</p>
<p>return -1;</p>
<p>}</p>
<p>wakeup_gpio = os_get_boot_arg_int(“pir_pin”, 0xFF);</p>
<p>if(wakeup_gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_gpio_select(1, wakeup_gpio, WAKEUP_TRIG_LVL_LOW,
DEBOUNCE_TIME_MS, callback_2) == -1)</p>
<p>return -1;</p>
<p>}</p>
<p>/*Enter suspend state*/</p>
<p>os_suspend_enable();</p>
<p>while(1){</p>
<p>os_msleep(10000);</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wakeup_init()initiates the wakeup parameters. wakeup_gpio_select()
selects a GPIO to wake up the Talaria TWO module and then the Talaria
TWO module will enter into suspend mode (sleep mode).</p>
<p>wakeup_gpio_select() selects a GPIO for waking up the Talaria TWO module
through an interrupt event (GPIO to which the wakeup source (Push button
switch) is connected).</p>
<p>os_gpio_set_irq_level_low() is a logic level of the GPIO pin when a
wakeup signal is invoked. This level is used for identifying the IRQ
level.</p>
<p>This block of code will attach an event handler function to a GPIO
event. The GPIO pin configured through the boot argument is an input pin
and the os_gpio_attach_event() attaches an event handler function to a
GPIO event.</p>
<p><strong>Note:</strong> In this example we have demonstrated event 3 (gpio_event_3).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>if(!os_gpio_request(GPIO_PIN(gpio_pin)) || wakeup_index &gt;=
MAX_WAKEUP_SOURCE_CNT) {</p>
<p>os_printf(”\n wakeup_gpio_select for gpio %d failed..!\n”,
gpio_pin);</p>
<p>return -1;</p>
<p>}</p>
<p>wakeup_src[wakeup_index].gpio = gpio_pin;</p>
<p>os_gpio_set_input(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>if(trigger_level == 0){</p>
<p>wakeup_src[wakeup_index].irq_level = 0;</p>
<p>os_gpio_set_irq_level_low(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>}</p>
<p>wakeup_src[wakeup_index].wakeup_clbk = fptr;</p>
<p>wakeup_src[wakeup_index].debounce_ms = 1000UL * debounce_ms;</p>
<p>os_gpio_attach_event(gpio_event_3, gpio_changed, NULL);</p>
<p>callout_init(&amp;wakeup_src[wakeup_index].delay_callout, debounce_fn);</p>
<p>os_gpio_enable_irq(GPIO_PIN(wakeup_src[wakeup_index].gpio),
3);//Testing with gpio event 3 for key_pin</p>
<p>os_printf(”\n gpio-%d is selected for the interrupt \n”,
wakeup_src[wakeup_index].gpio);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>After attaching the event, the callout function will be called to check
the interrupt occurrence in the configured GPIO pin.</p>
<p>If an interrupt occurs in any of the configured GPIO pins, the
gpio_changed() handler function will be executed. The GPIO ISR handler
finds which wake-up source triggered the IRQ.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wakeup_index = wakeup_index_from_irq();</p>
<p>if(wakeup_index != 0xFF)</p>
<p>{</p>
<p>callout_schedule(&amp;wakeup_src[wakeup_index].delay_callout,
wakeup_src[wakeup_index].debounce_ms);</p>
<p>// disable all wakeup source IRQs, debounce one at a time</p>
<p>disable_wakeup_irqs();</p>
<p>wakeup_src[wakeup_index].debouncing = true;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The wakeup_index_from_irq()identifies which wakeup source is causing the
interrupt.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;
wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].invoked == true)</p>
<p>{</p>
<p>irq_level = !wakeup_src[wakeup_index].irq_level;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>irq_level = wakeup_src[wakeup_index].irq_level;</p>
<p>}</p>
<p>gpio_val =
os_gpio_get_value(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>gpio_val = gpio_val &gt;&gt; wakeup_src[wakeup_index].gpio;</p>
<p>if(irq_level == (uint8_t)gpio_val)</p>
<p>{</p>
<p>return wakeup_index;</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The callout_schedule() executes the callout delay function and debounce
logic to avoid registering multiple interrupts in a short period of
time. The debouncing logic will execute the 40ms debouncing time.</p>
<p>The disable_wakeup_irqs() will disable all wakeup source IRQs, debounce
one at a time and it will find which wakeup source is being debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;
wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>os_gpio_disable_irq(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The debouncing_wakeup_src()identifies the wake-up source array index of
the wake-up signal currently being debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;
wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].debouncing == true)</p>
<p>{</p>
<p>return wakeup_index;</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The debounce_fn()is called from the configured callout. This callout
function is for debouncing the wakeup signal. The debounce logic will
validate that the wake-up signal is in a stable state after the delay.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index = debouncing_wakeup_src();</p>
<p>if(wakeup_src[wakeup_index].invoked == false){</p>
<p>if(wakeup_src[wakeup_index].irq_level == 0){</p>
<p>if(os_gpio_get_value(GPIO_PIN(wakeup_src[wakeup_index].gpio)) ==
false){</p>
<p>wakeup_src[wakeup_index].invoked = true;</p>
<p>os_gpio_set_irq_level_high(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>// send message to custom task</p>
<p>wakeup_src[wakeup_index].invoke_count++;</p>
<p>wakeup_src[wakeup_index].wakeup_clbk();</p>
<p>os_suspend_disable();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>else{</p>
<p>if(wakeup_src[wakeup_index].irq_level == 0){</p>
<p>if(os_gpio_get_value(GPIO_PIN(wakeup_src[wakeup_index].gpio)) !=
false){</p>
<p>wakeup_src[wakeup_index].invoked = false;</p>
<p>os_gpio_set_irq_level_low(GPIO_PIN(wakeup_src[wakeup_index].gpio));</p>
<p>os_suspend_enable();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>if ((wakeup_src[wakeup_index].invoke_count) == 10){</p>
<p>os_gpio_detach_event(gpio_event_3, gpio_changed);</p>
<p>os_printf(” \n Interrupt_count exceeded to -%d \n”,
wakeup_src[wakeup_index].invoke_count);</p>
<p>}</p>
<p>enable_wakeup_irqs();</p>
<p>wakeup_src[wakeup_index].debouncing = false;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<section id="id13">
<h4><a href="#id11"><span class="problematic" id="id12">**</span></a><a class="headerlink" href="#id13" title="Permalink to this heading"></a></h4>
<p><strong>Note:</strong> The debounce logic will count the number of interrupt
occurrences. Once the number of interrupts equals 10, the
os_gpio_detach_event()will detach an attached event handler function
from a GPIO event. Also, Talaria TWO module will enter awake state.</p>
<p>enable_wakeup_irqs()enables the interrupt from all wake-up sources once
the switch is debounced.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uint8_t wakeup_index;</p>
<p>for(wakeup_index = 0; wakeup_index &lt; MAX_WAKEUP_SOURCE_CNT;
wakeup_index++)</p>
<p>{</p>
<p>if(wakeup_src[wakeup_index].gpio != 0xFF)</p>
<p>{</p>
<p>os_gpio_enable_irq(GPIO_PIN(wakeup_src[wakeup_index].gpio),
3);//Testing with <em>gpio</em> event 3 for key_pin</p>
<p>}</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="running-the-application-3">
<span id="id14"></span><h3>Running the Application<a class="headerlink" href="#running-the-application-3" title="Permalink to this heading"></a></h3>
<p>Program gpio_interrupt_awake.elf(sdk_x.y\examples\gpio\bin) using the
Download tool:</p>
<ol class="arabic simple" start="3">
<li><p>Launch the Download tool provided with InnoPhase Talaria TWO SDK.</p></li>
<li><p>In the GUI window:</p></li>
</ol>
<ol class="loweralpha simple" start="4">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
<li><p>ELF Input: Load the gpio_interrupt_awake.elf by clicking on Select
ELF File.</p></li>
<li><p>Boot Arguments: Pass the following boot arguments:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>key_pin=20, pir_pin=21</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="7">
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
<p>For more details on using the Download tool, refer to the document:
UG_Download_Tool.pdf (path: <em>sdk_x.y\pc_tools\Download_Tool\doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the SDK release version. For example:
<em>sdk_2.5\doc</em>.</p>
</section>
<section id="expected-output-3">
<span id="id15"></span><h3>Expected Output<a class="headerlink" href="#expected-output-3" title="Permalink to this heading"></a></h3>
<p>In the demo application, Talaria TWO goes into Sleep Mode.</p>
<p>Use a push button switch on which all the GPIO’s are configured as an
Interrupt. Connecting push button switch to GND will wake the Talaria
TWO from sleep, and then goes back to sleep.</p>
<p>After ten (10) interrupts in any one of the configured interrupt pins,
the application will detach an attached event handler function from a
GPIO event.</p>
<p><strong>Note</strong>: In this example, GPIO 20 and 21 are used as an external
interrupt pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWAE4 DWT comparators, range 0x8000</p>
<p>Build $Id: git-6ed2e370c $</p>
<p>key_pin=20 pir_pin=21</p>
<p>Interrupt test</p>
<p>gpio-20 is selected for the interrupt</p>
<p>gpio-21 is selected for the interrupt</p>
<p>Pir_pin interrupt enabled</p>
<p>Key_Pin interrupt enabled</p>
<p>Pir_pin interrupt enabled</p>
<p>Key_Pin interrupt enabled</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../_images/image41.png"><img alt="image4" src="../_images/image41.png" style="width: 5.90551in; height: 3.40546in;" /></a></p>
<p><em>Figure 2: Otii capture for gpio_interrupt_awake application.</em></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Firmware%20Over%20the%20Air%20Upgrade.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Host%20Interface%20Protocol.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>