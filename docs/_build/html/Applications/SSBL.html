<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction" href="Throughput%20Measurement.html" />
    <link rel="prev" title="Introduction" href="SPI%20Flash.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Getting_Started_Landing_page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Software_Reference/Prerequisites/libusbK_driver-Zadig.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Development_Environments/Development_Environments.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Tools_Landing.html">Tools</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Applications-Landing_Page.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#alarm">1.  Alarm</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#analog-to-digital-converter">2.  Analog to Digital Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#audio-over-i2s">3.  Audio over I2S</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-5-0">4.  BLE 5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-beacons">3.  BLE Beacons</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-wi-fi-bridge">4.  BLE Wi-Fi Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#chip-monitor">5.  Chip Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#crash-handling">6.  Crash Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#custom-atcmdlib">6.  Custom ATCMDLIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#filesystem">7.  Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#firmware-over-the-air-upgrade">8.  Firmware Over the Air Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#gpio">9.  GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#host-interface-protocol">10. Host Interface Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#http-client">11. HTTP Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#i2c">12. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ifttt">13. IFTTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-aws">14. IoT AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-azure">15. IoT Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-scan">16. Low Power Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-uart">17. Low Power UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mdns">18. mDNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#memory-management-and-error-handling">19.  Memory Management and Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#message-queues">20.  Message Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mqtt">21.  MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#provisioning">22.  Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#pulse-width-modulation">23.  Pulse Width Modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#radio-and-module-parameters">24. Radio and Module Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#secure-files">25. Secure Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#simple-network-time-protocol">26.  Simple Network Time Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#sleep-enable-disable">27.  Sleep Enable Disable</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#socket-wakeup">28. Socket Wakeup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#software-spi-master">29. Software SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#spi-flash">30. SPI Flash</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="Applications-Landing_Page.html#ssbl">31. SSBL</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description-of-operation">Description of Operation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#memory-layout">Memory Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-layout">Flash Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssbl-operation-flow">SSBL Operation Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssbl-configuration">SSBL Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssbl-boot-arguments">SSBL Boot Arguments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-components">Building Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-file-system-root-img-file">Create File System (root.img) file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flashing-components">Flashing Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#non-secure-ssbl-1">Non-Secure SSBL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#secure-ssbl">Secure SSBL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#thread-and-semaphores">32.  Thread and Semaphores</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#throughput-measurement">32.  Throughput Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#timers-and-callouts">33. Timers and Callouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#unassociated-mode">34. Unassociated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#using-wi-fi">35. Using Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#watchdog-timer">36. Watchdog Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#websocket-client">37. Websocket Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-connection-manager-multi-ap">38. Wi-Fi Connection Manager Multi-AP</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-power-management">39. Wi-Fi Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#work-queues">40. Work Queues</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Regulatory%20Notices/Regulatory%20Notices.html">Regulatory Notice</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Backend%20Files%20-%20for%20cross%20referencing/Backend%20File%20Landing.html">Backend Files - for cross referencing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Applications-Landing_Page.html">Applications</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Applications/SSBL.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<p>The Second Stage Boot Loader (SSBL) is a piece of firmware that can be
installed in Talaria TWO to enhance the flexibility of booting the
applications on the device. The SSBL enables the following features on
Talaria TWO:</p>
<ol class="arabic simple">
<li><p>Selective boot of one of the applications loaded into flash.</p></li>
<li><p>Over the Air (OTA) update of applications (requires additional OTA
application).</p></li>
</ol>
<p>SSBL can be built with secureboot which provides a secure way of loading
encrypted and signed applications. This prevents loading of unauthorized
applications and performing a flash readout of application contents.</p>
</section>
<section id="description-of-operation">
<h1>Description of Operation<a class="headerlink" href="#description-of-operation" title="Permalink to this heading"></a></h1>
<p>The Second Stage Boot Loader (SSBL) is a special application that is
written to Talaria TWO’s flash. On boot up, the primary bootloader loads
&amp; starts SSBL. SSBL reads the image index from the boot.json file,
parses the part.json file and picks the image info from the array index
read from boot.json file. The SSBL then loads the image from the sector
mentioned in part.json into the RAM. Applications supported by the SSBL
are stripped ELF files written to flash memory.</p>
<p>In case of secureboot mode, the configuration files are encrypted.</p>
<p>The memory layout mentioned in section 5.1 is for the RAM, where the
SSBL and the application triggered by the SSBL is loaded into memory for
execution. Section 5.2 explains the flash layout where SSBL and multiple
applications can be stored in the flash.</p>
<section id="memory-layout">
<h2>Memory Layout<a class="headerlink" href="#memory-layout" title="Permalink to this heading"></a></h2>
<p>Figure 1 shows the memory layout when using SSBL.</p>
<p>Figure 1: Memory layout on loading the SSBL application</p>
<ol class="arabic simple">
<li><p>There is a total of 512KB RAM in Talaria TWO</p>
<ol class="loweralpha simple">
<li><p>The RAM starts at 0x40000 and ends at 0xc0000.</p></li>
</ol>
</li>
<li><p>User Application area</p>
<ol class="loweralpha simple">
<li><p>Starts at 0x42000 to 0x90000.</p></li>
<li><p>Contains application .text, .data and.bss sections.</p></li>
</ol>
</li>
<li><p>Bootargs</p>
<ol class="loweralpha simple">
<li><p>The memory location for bootargs is at 0xbfffc and it grows
backwards.</p></li>
</ol>
</li>
<li><p>SSBL area</p>
<ol class="loweralpha simple">
<li><p>Starts at 0x90000.</p></li>
</ol>
</li>
</ol>
<p>Figure 2: Memory layout after loading the application</p>
<p>Figure 3 shows the signed and encrypted ELF memory layout when using
SSBL in secureboot mode.</p>
<p><a class="reference internal" href="../_images/image1.png"><img alt="A picture containing diagram Description automatically generated" src="../_images/image1.png" style="width: 6.29921in; height: 1.27297in;" /></a></p>
<p>Figure : Signed and encrypted ELF memory layout</p>
<ol class="arabic simple">
<li><p>In this case, only the .text and .data sections of the application
ELF are encrypted.</p></li>
<li><p>The .virt segment cannot be encrypted. Ensure no sensitive code is
placed in this section of the memory layout.</p></li>
<li><p>Code sections can be forced into .text by either specifying in the
linker script or by adding __ramcode in the function declaration.</p></li>
</ol>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Table 1: SSBL Configuration Files</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>int __ramcode</p>
<p>main(void)</p>
<p>{</p>
<p>…</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="flash-layout">
<h2>Flash Layout<a class="headerlink" href="#flash-layout" title="Permalink to this heading"></a></h2>
<p>Figure 4 shows the layout of flash memory when using the SSBL. To use
the SSBL, flash must contain at minimum the SSBL, the filesystem, and
one application.</p>
<p><a class="reference internal" href="../_images/image21.png"><img alt="image1" src="../_images/image21.png" style="width: 6.69291in; height: 0.71515in;" /></a></p>
<p>Figure 4: Flash layout when using the SSBL</p>
<p>Figure 5 shows the layout of flash memory when using secure SSBL.</p>
<p><a class="reference internal" href="../_images/image31.png"><img alt="Text Description automatically generated with medium confidence" src="../_images/image31.png" style="width: 6.69291in; height: 0.89239in;" /></a></p>
<p>Figure : Flash layout for SSBL with secureboot</p>
</section>
<section id="ssbl-operation-flow">
<h2>SSBL Operation Flow<a class="headerlink" href="#ssbl-operation-flow" title="Permalink to this heading"></a></h2>
<section id="non-secure-ssbl">
<h3>Non-Secure SSBL<a class="headerlink" href="#non-secure-ssbl" title="Permalink to this heading"></a></h3>
</section>
<section id="secureboot-ssbl">
<h3>Secureboot SSBL<a class="headerlink" href="#secureboot-ssbl" title="Permalink to this heading"></a></h3>
<p><a class="reference internal" href="../_images/image41.png"><img alt="image2" src="../_images/image41.png" style="width: 6.44792in; height: 4.05681in;" /></a></p>
<p>Figure : Secureboot SSBL Flow Diagram</p>
</section>
</section>
<section id="ssbl-configuration">
<h2>SSBL Configuration<a class="headerlink" href="#ssbl-configuration" title="Permalink to this heading"></a></h2>
<p>The SSBL is configured with JSON files present in the flash-based
filesystem. Table 1 provides a description of the relevant files and
their purpose. The contents of these files can be updated at
installation time or by a running application to modify the behavior of
the SSBL.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>File</strong></p></th>
<th class="head"><p><strong>Purpose</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>part.json</p></td>
<td><ol class="arabic simple">
<li><p>Image table which is a json array of applications
image information. Each element in the image array
gives information like image name starting sector
of the elf, boot arguments etc.</p></li>
<li><p>Application boot arguments</p></li>
<li><p>Additional SSBL options</p></li>
</ol>
</td>
</tr>
<tr class="row-odd"><td><p>boot.json</p></td>
<td><p>This is a json file stored in root/user FS. It
contains the image index. This is the index in the
image information array present in part.json file.
SSBL gets the index of the image to be loaded from
this file.</p></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: For SSBL in secureboot mode, the configuration files are
encrypted.</p>
<p><strong>part.json</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><blockquote>
<div><p>{</p>
<p>“image” : [</p>
<p>{</p>
<p>“name” : “iperf_vm”,</p>
<p>“version” : “1.0”,</p>
<p>“start_sector” : 32,</p>
<p>“bootargs_start”: 1,</p>
<p>“ssid” : “innotest”,</p>
<p>“passphrase” : “123467890”,</p>
<p>“bootargs_end” : 1</p>
<p>},</p>
<p>{</p>
<p>“name” : “hello_world”,</p>
<p>“version” : “1.0”,</p>
<p>“start_sector” : 232,</p>
<p>“bootargs_start”: 1,</p>
<p>“ssid” : “innotest”,</p>
<p>“passphrase” : “123467890”,</p>
<p>“bootargs_end” : 1</p>
<p>}</p>
<p>],</p>
<p>“baudrate” : 2560000,</p>
<p>“timeout” : 0,</p>
<p>“verbose” : 1</p>
</div></blockquote>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><p>General parameters:</p>
<ol class="loweralpha simple">
<li><p>baud – baud rate used by SSBL when using hio</p></li>
<li><p>timeout – timeout used by SSBL when using hio</p></li>
<li><p>verbose – verbosity mode</p></li>
<li><p>image []: image information</p></li>
</ol>
</li>
<li><p>Image information:</p>
<ol class="loweralpha simple">
<li><p>name: name of application</p></li>
<li><p>version: version number of applications</p></li>
<li><p>sector: start sector of image in flash</p></li>
<li><p>bootargs_start: The following objects will be boot params</p></li>
<li><p>bootargs_end: end of boot arguments</p></li>
</ol>
</li>
</ol>
<p><strong>boot.json</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>boot.json</p>
<p>{ image : 0 }</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>where,</p>
<p>image – The image to boot from part.json</p>
</section>
<section id="ssbl-boot-arguments">
<h2>SSBL Boot Arguments<a class="headerlink" href="#ssbl-boot-arguments" title="Permalink to this heading"></a></h2>
<p>SSBL can pass bootargs to an application by utilizing the filesystem.
SSBL reads the bootargs from the part.json file and stores the bootargs
at memory location 0xbfffc where it grows backwards. The size occupied
by the bootargs is dependent on the length and count of the bootargs
read from the filesystem. Figure 8 shows how they are stored in memory.</p>
<p><a class="reference internal" href="../_images/image51.png"><img alt="image3" src="../_images/image51.png" style="width: 6.69291in; height: 1.06485in;" /></a></p>
<p>Figure 8: SSBL Bootargs stored in memory</p>
</section>
</section>
<section id="building-components">
<h1>Building Components<a class="headerlink" href="#building-components" title="Permalink to this heading"></a></h1>
<p>This section describes building the required components for the SSBL.</p>
<section id="create-file-system-root-img-file">
<h2>Create File System (root.img) file<a class="headerlink" href="#create-file-system-root-img-file" title="Permalink to this heading"></a></h2>
<p>The root folder at root_fs contains the files that will be put into the
filesystem image to be flashed to Talaria TWO. Before building the
filesystem image for the first time, the configuration files need to be
updated based on the applications you will load and your particular use
of the SSBL (refer section 5.3.2).</p>
<p>Once the SSBL configuration files are updated, run the following command
from within the root folder to build the filesystem image:</p>
<p><strong>Non-secure SSBL</strong>:</p>
<p>For non-secure SSBL, filesystem files come from root_fs and the fs
directory of the application.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>~/sdk_x.y/script$ python3 ./build_rootfs_generic.py –folder_path
apps/ssbl</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: x and y in sdk_x.y refer to the SDK release version. For
example: <em>sdk_2.4/</em>.</p>
<p><strong>Secureboot SSBL</strong>:</p>
<p>For secureboot SSBL, filesystem files come from root_fs and the
fs_secure directory of the application.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>python3 ./script/build_rootfs_generic.py –folder_path
examples/secure_files/ –secure True –keyfile
./apps/ssbl/enroll.json</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="flashing-components">
<h1>Flashing Components<a class="headerlink" href="#flashing-components" title="Permalink to this heading"></a></h1>
<p>After the SSBL, filesystem, and applications have been built, follow the
instructions in this section to flash the components to Talaria TWO.</p>
<p><strong>Note</strong>: If Talaria TWO has been flashed before, connect GPIO17 to
ground on the peripheral header of the EVK, then press and release reset
before following the instructions here. This will inhibit flash boot and
allow the flash helper to be loaded, provided fuses have not already
been blown.</p>
<section id="non-secure-ssbl-1">
<span id="id1"></span><h2>Non-Secure SSBL<a class="headerlink" href="#non-secure-ssbl-1" title="Permalink to this heading"></a></h2>
<section id="flashing">
<h3>Flashing<a class="headerlink" href="#flashing" title="Permalink to this heading"></a></h3>
<p>The following commands will write the SSBL and other components to
flash. Run the commands from the sdk_x.y directory:</p>
<p><strong>Load flash helper</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/boot.py –device /dev/ttyUSB2 –reset=evk42_bl
./apps/gordon/bin/gordon.elf</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Invalidate the boot Image</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>dd if=/dev/zero of=./empty.img bs=1K count=1</p></td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/flash.py –device /dev/ttyUSB2 write 0x1000 ./empty.img</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Write partition</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/flash.py –device /dev/ttyUSB2 from_json
./tools/partition_files/ssbl_part_table.json</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Flash SSBL</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/flash.py –device /dev/ttyUSB2 write 0x1000
./apps/ssbl/fast_ssbl.img</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Flash filesystem</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/flash.py –device /dev/ttyUSB2 write 0x180000
./apps/ssbl/root.img</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p><strong>Flash apps</strong></p>
<p>iPerf3 should be flashed into 0x2000 (which is start_sector 32 as
mentioned in part.json), while helloworld.elf should be flashed into
0xE8000 ( which is start_sector sector 232).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/flash.py –device /dev/ttyUSB2 write 0x20000
./apps/iperf3/bin/iperf3.elf</p>
<p>./script/flash.py –device /dev/ttyUSB2 write 0xE8000
./apps/helloworld/bin/helloworld.elf</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Open a miniterm at baud rate of 2457600 and reset the EVB.</p>
<p><a class="reference internal" href="../_images/image6.png"><img alt="image4" src="../_images/image6.png" style="width: 6.49606in; height: 0.34167in;" /></a></p>
</div></blockquote>
<p>Figure : Miniterm console output</p>
<p>Reset the board either by executing the following command or by pressing
the reset button on the EVB.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>./script/boot.py –device /dev/ttyUSB2 –reset=evk42</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="expected-output">
<h3>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PWAEWWWWAE Build $Id: git-a042e9a42 $</p>
<p>Build $Id: git-a042e9a42 $</p>
<p>vm.flash_location=0x00034c00 sys.reset_reason=1 passphrase=1234567890
ssid=innotest</p>
<p>addr f8:e9:43:d2:00:e7</p>
<p>network profile created for ssid: innotest</p>
<p>[1.535,586] CONNECT:60:32:b1:33:b5:7b Channel:11 rssi:-37 dBm</p>
<p>[4.370,448] MYIP 192.168.0.107</p>
<p>[4.370,495] IPv6 [fe80::fae9:43ff:fed2:e7]-link</p>
<p>IPerf3 server &#64; 192.168.0.107</p>
<p>Iperf3 TCP/UDP server listening on 5201</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Run iPerf3 client for this application.</p>
<p><a class="reference internal" href="../_images/image7.png"><img alt="image5" src="../_images/image7.png" style="width: 6.49606in; height: 3.36403in;" /></a></p>
<p>Figure : iPerf3 Client</p>
<p>To run the helloworld application, make changes in
sdk_x.y/root_fs/root/boot.json and execute the following to generate the
root image:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>sdk_x.y/root_fs/root$ python3 ../../script/build_rootfs_generic.py
–folder_path apps/ssbl</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Repeat the steps in section 7.1 and reset the board. On reboot, the new
application will be loaded.</p>
</section>
</section>
<section id="secure-ssbl">
<h2>Secure SSBL<a class="headerlink" href="#secure-ssbl" title="Permalink to this heading"></a></h2>
<section id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Build secure SSBL</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#for development</p>
<p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make clean</p>
<p>make KEY=enroll.json SECUREBOOT=1 DEBUGSECURE=1</p>
<p>#for production</p>
<p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make clean</p>
<p>make KEY=enroll.json SECUREBOOT=1</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Build data filesystem</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;</p>
<p>python3 ./script/build_rootfs_generic.py –folder_path
examples/secure_files/ –secure True –keyfile
./apps/ssbl/enroll.json</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="flashing-and-testing">
<h3>Flashing and Testing<a class="headerlink" href="#flashing-and-testing" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Generate combined “First” application and SSBL</p>
<ol class="loweralpha simple">
<li><p>For emulating/testing SecureSSBL</p></li>
</ol>
</li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make KEY=enroll.json SECUREBOOT=1 DEBUGSECURE=1</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="2">
<li><p>For production</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make KEY=enroll.json SECUREBOOT=1</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Enroll keys</p>
<ol class="loweralpha simple">
<li><p>For emulating SecureSSBL without burning the fuse</p></li>
</ol>
</li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;$</p>
<p>./script/boot.py –reset=evk42_bl apps/gordon/bin/gordon.elf</p>
<p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py enroll –keyfile=enroll.json –secureboot puf
–fuse-location emulated</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="2">
<li><p>For production SecureSSBL and burning the fuse</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;$</p>
<p>./script/boot.py –reset=evk42_bl apps/gordon/bin/gordon.elf</p>
<p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py enroll –keyfile=enroll.json –secureboot puf
–fuse-location one-time-programmable-fuses</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>Flash SSBL partition table</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;$</p>
<p>./script/flash.py from_json
tools/partition_files/ssbl_part_table.json</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Flash both.img at 0x1000</p>
<ol class="loweralpha simple">
<li><p>For emulating SecureSSBL</p></li>
</ol>
</li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py write 0x1000 out/both.img</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="2">
<li><p>For production SecureSSBL</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py write 0x1000 out/ssbl_secure.img</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><p>Build filesystem</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;</p>
<p>python ./script/build_rootfs_generic.py –folder_path
examples/secure_files/ –secure True –keyfile
./apps/ssbl/enroll.json</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><p>Create signed application</p></li>
</ol>
<blockquote>
<div><p><strong>Note</strong>: When building the application, build it as &lt;app&gt;.elf.sign
and pass it as the KEY parameter</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make KEY=enroll.json &lt;app&gt;.elf.sign</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="7">
<li><p>Encrypt application</p></li>
</ol>
<blockquote>
<div><p><strong>Note</strong>: Move &lt;app&gt;.elf.sign into SSBL directory</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>make KEY=enroll.json &lt;app&gt;.elf.enc</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="8">
<li><p>Flash application at 0x20000</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py write 0x20000 app.elf.enc</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="9">
<li><p>Flash filesystem</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cd &lt;sdk&gt;/apps/ssbl$</p>
<p>../../script/flash.py write 0x180000 root_secure.img</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="expected-output-1">
<span id="id2"></span><h3>Expected Output<a class="headerlink" href="#expected-output-1" title="Permalink to this heading"></a></h3>
<p>When DEBUGSECURE=1</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWAE</p>
<p>FIRST:SWWWWAHESi Build $Id: git-a042e9a42 $</p>
<p>***Warning! Make sure to remove this code section once in
production***</p>
<p>secureboot_secret:</p>
<p>8b5
678a045ba66b7ea956d3292aae8dc29ded8de9010efd40980a091734b786b11000000</p>
<p>***Warning! Make sure to remove this code section once in
production***</p>
<p>cipher key:
4e3b0b9792183c53ecc78a38c64a45c071b97bc40b0baba308ed76db8a46cef1</p>
<p>public key:
20b003d2f297be2c5e2c83a7e9f9a5b9eff49111acf4fddbcc0301480e3
59de6dc809c49652aeb6d63329abf5a52155c766345c28fed3024741c8ed01589d28b</p>
<p>Build $Id: git-a042e9a42 $</p>
<p>vm.flash_location=0x0002d000 sys.reset_reason=1</p>
<p>Application Information:</p>
<p>Name       : Secure files demo application</p>
<p>Version    : 1.0</p>
<p>Build Date : Apr 20 2023</p>
<p>Build Time : 07:10:32</p>
<p>Heap Available: 248 KB (254360 Bytes)</p>
<p>Original message: Hello! This is a plain text file.</p>
<p>Writing message to encrypted file</p>
<p>Reading file as ciphertext</p>
<p>Cipher text message: 1~␒M}rQo앺{AÛ␒*_/rY0</p>
<p>Reading and decrypting file</p>
<p>Plain text message: Hello! This is a plain text file.</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SPI%20Flash.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Throughput%20Measurement.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>