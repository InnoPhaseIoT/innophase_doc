<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; InnoPhase 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction" href="Watchdog%20Timer.html" />
    <link rel="prev" title="Introduction" href="Timers%20and%20Callouts.html" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="../_static/js/custom.js" defer></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            InnoPhase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Getting_Started_Landing_page.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hardware-Reference.html">Hardware-Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Porting-Guide.html">Porting-Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Software_Reference/Prerequisites/libusbK_driver-Zadig.html">Software Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Development_Environments/Development_Environments.html">Development Environments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Tools_Landing.html">Tools</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Applications-Landing_Page.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#alarm">1.  Alarm</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#analog-to-digital-converter">2.  Analog to Digital Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#audio-over-i2s">3.  Audio over I2S</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-5-0">4.  BLE 5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-beacons">3.  BLE Beacons</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ble-wi-fi-bridge">4.  BLE Wi-Fi Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#chip-monitor">5.  Chip Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#crash-handling">6.  Crash Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#custom-atcmdlib">6.  Custom ATCMDLIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#filesystem">7.  Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#firmware-over-the-air-upgrade">8.  Firmware Over the Air Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#gpio">9.  GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#host-interface-protocol">10. Host Interface Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#http-client">11. HTTP Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#i2c">12. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ifttt">13. IFTTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-aws">14. IoT AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#iot-azure">15. IoT Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-scan">16. Low Power Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#low-power-uart">17. Low Power UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mdns">18. mDNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#memory-management-and-error-handling">19.  Memory Management and Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#message-queues">20.  Message Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#mqtt">21.  MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#provisioning">22.  Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#pulse-width-modulation">23.  Pulse Width Modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#radio-and-module-parameters">24. Radio and Module Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#secure-files">25. Secure Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#simple-network-time-protocol">26.  Simple Network Time Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#sleep-enable-disable">27.  Sleep Enable Disable</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#socket-wakeup">28. Socket Wakeup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#software-spi-master">29. Software SPI Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#spi-flash">30. SPI Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#ssbl">31. SSBL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#thread-and-semaphores">32.  Thread and Semaphores</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#throughput-measurement">32.  Throughput Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#timers-and-callouts">33. Timers and Callouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#unassociated-mode">34. Unassociated Mode</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="Applications-Landing_Page.html#using-wi-fi">35. Using Wi-Fi</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#topology">Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wi-fi-connection-manager-functionalities">Wi-Fi Connection Manager Functionalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list-of-apis">List of APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#states-and-events-of-wi-fi-connection-manager">States and Events of Wi-Fi Connection Manager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#states-of-wcm">States of WCM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#source-code-walkthrough">Source Code Walkthrough</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wifi-connect">Wifi_Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wifi-connect-disconnect">Wifi_Connect_Disconnect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wi-fi-scan">Wi-Fi Scan</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#watchdog-timer">36. Watchdog Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#websocket-client">37. Websocket Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-connection-manager-multi-ap">38. Wi-Fi Connection Manager Multi-AP</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#wi-fi-power-management">39. Wi-Fi Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Applications-Landing_Page.html#work-queues">40. Work Queues</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Regulatory%20Notices/Regulatory%20Notices.html">Regulatory Notice</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Security/Security%20-%20Landing%20Page.html">Security</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Backend%20Files%20-%20for%20cross%20referencing/Backend%20File%20Landing.html">Backend Files - for cross referencing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">InnoPhase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Applications-Landing_Page.html">Applications</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Applications/Using Wi-Fi.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<p>This application note describes the Wi-Fi Connection Manager APIs
available in the SDK, call-back events, notifications and the data
structures associated with them. The accompanying sample codes help
achieve some of these functionalities using WCM APIs.</p>
</section>
<section id="topology">
<h1>Topology<a class="headerlink" href="#topology" title="Permalink to this heading"></a></h1>
<p><a class="reference internal" href="../_images/image1.png"><img alt="Diagram Description automatically generated" src="../_images/image1.png" style="width: 5.11806in; height: 1.69861in;" /></a></p>
<p>Figure 1: Wi-Fi Connection Manager – Topology</p>
</section>
<section id="wi-fi-connection-manager-functionalities">
<h1>Wi-Fi Connection Manager Functionalities<a class="headerlink" href="#wi-fi-connection-manager-functionalities" title="Permalink to this heading"></a></h1>
<p>The Wi-Fi connection manager (WCM) contains functions for establishing
and tearing down associations to Wi-Fi access points. It initiates a
four-way handshake for encrypted connections and starts the DHCP client
from LWIP for getting allocation of the IP address.</p>
<p>Following functionalities are achieved through these APIs:</p>
<ol class="arabic simple">
<li><p>Creating and destroying interfaces</p></li>
<li><p>Scanning with different scan parameters and their indication
structure</p></li>
<li><p>Connecting and disconnecting</p></li>
<li><p>Adding network to connect and removing network</p></li>
<li><p>Querying connection information</p></li>
</ol>
<p>Accompanying sample code provides more details on how to achieve some of
the listed functionalities.</p>
</section>
<section id="list-of-apis">
<h1>List of APIs<a class="headerlink" href="#list-of-apis" title="Permalink to this heading"></a></h1>
<ol class="arabic simple">
<li><p>os_sem_post() - Unlocks the semaphore. Increments the value of a
semaphore and wakes the first thread waiting for this semaphore.</p></li>
<li><p>os_msg_release()- Frees an allocated message. Frees a message which
was previously allocated using os_msg_alloc().</p></li>
<li><p>os_get_boot_arg_str() - Returns the value of a boot argument as a
null-terminated string.</p></li>
<li><p>os_sem_init()- Initializes a semaphore. This API must be called
before calling any other semaphore related APIs. It is possible to
statically initialize a semaphore with the OS_SEM_INITALIZER macro.</p></li>
<li><p>wcm_create()- Creates a Wi-Fi network interface. Only one wcm_handle
instance is supported at the time of writing.</p></li>
<li><p>wifi_connect_to_network()- Adds a Wi-Fi network .</p></li>
<li><p>os_sem_wait()- Locks a semaphore. If the value of the semaphore is
greater than 0, it decrements the counter. If the value is 0, it puts
the current thread to sleep until the value becomes positive. This
function cannot be used in interrupt context.</p></li>
<li><p>os_msg_release()- Frees an allocated message. Free a message
previously allocated using os_msg_alloc().</p></li>
<li><p>os_create_thread()- Creates a new thread.</p></li>
</ol>
<blockquote>
<div><p>This creates a new thread with priority specified in flags (via
OS_CRTHREAD_PRIO macro). The thread is placed in the run queue, but
there is no immediate reschedule. The thread continues to run until
the entry point returns, at a point where the return value (a
pointer) can be obtained with os_join_thread().</p>
<p>If the return value is of no consequence, OS_CRTHREAD_DETACHED can be
passed in flags. This causes the OS to reap the thread. Returns
pointer to struct os_thread if successful, NULL otherwise.</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>os_join_thread()- Waits for a thread to terminate and destroy the
thread.</p></li>
</ol>
<blockquote>
<div><p>Calling this function will suspend execution of the calling thread
until the target thread exits. The memory used to hold the threads
stack and control block are freed.</p>
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>os_suspend_enable()- Enables system suspend when idle.</p></li>
</ol>
<blockquote>
<div><p>Calling os_suspend_enable() will enable the suspend (deep sleep) for
the system. If enabled, the system will go into suspended mode when
there is nothing to do for the processor. Entering and leaving
suspend mode takes some extra time, so enabling this will affect the
real-time response of the system. When in suspended state, the system
will still wakeup if an interrupt occurs, but the latency will be
much larger compared to running with suspend mode disabled.</p>
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>os_get_boot_arg_int()- Returns the value of a boot argument as an
integer</p></li>
<li><p>wifi_init_scan_default()- Gets the default parameters for the scan
operation. The wifi_scan_param will be updated with the default
values for the scan operation. This function is used to get the
default values and alter the parameters whose values are different
from the default. Finally, provide these parameters while calling
the wcm_scan() API.</p></li>
<li><p>wcm_scan()- Scans for Wi-Fi networks. Returns the number of networks
found during the scan operation. In case the scan could not be
performed, an error code (negative value) is returned. Initiate a
network scan procedure on the specified Wi-Fi Connection Manager
interface.</p></li>
<li><p>wifi_netinfo_get_ssid()-Gets the SSID information from netinfo.</p></li>
<li><p>wifi_netinfo_get_chan()-Gets the channel information from netinfo.</p></li>
<li><p>wcm_free_scanresult() - Frees the memory allocated by wcm_scan().</p></li>
<li><p>wcm_set_hostname() - Sets host name for DHCP client.</p></li>
<li><p>wcm_get_hostname() - Gets host name of DHCP client.</p></li>
</ol>
</section>
<section id="states-and-events-of-wi-fi-connection-manager">
<h1>States and Events of Wi-Fi Connection Manager<a class="headerlink" href="#states-and-events-of-wi-fi-connection-manager" title="Permalink to this heading"></a></h1>
<p>The architecture of the WCM, its calls and events with LWIP and Wi-Fi
stacks are described in detail through the API flow.</p>
<p>WCM states are explained and notifications passed to application
programmer are described.</p>
<section id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h2>
<p>When the API wcm_create() is called, the following sequence of
initializations happen on the WCM:</p>
<ol class="arabic simple">
<li><p>LWIP stack is initiated.</p></li>
<li><p>Wi-Fi interface and resources are created with the passed hwaddr.</p></li>
<li><p>Wi-Fi interface is created in WIFI_MODE_SCAN mode and a scan client
is attached with scan_notify() and scan_done() call-backs to get scan
results.</p></li>
<li><p>LWIP TCP/IP stack is started with the Wi-Fi interface in
WIFI_MODE_STA mode.</p></li>
<li><p>wcm_notify_handler() is registered with the Wi-Fi stack for listening
to the following link status notifications:</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#define WIFI_NOTIFY_MSG_LEAVE 100 /* AP disconnected us */</p>
<p>#define WIFI_NOTIFY_MSG_LOST 101 /* Lost tracking of AP */</p>
<p>#define WIFI_NOTIFY_MSG_RESTARTED 102 /* Associated AP restarted */</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><p>wcm_netif_callback() is registered with LWIP stack for listening IP
address change events.</p></li>
<li><p>A dedicated wcm_thread is created which takes care of WCM’s state
transitions at various stages of Wi-Fi connection procedure based on
the previously described call-backs from the Wi-Fi stack, scanning
interface and LWIP stack.</p></li>
</ol>
</section>
<section id="states-of-wcm">
<h2>States of WCM<a class="headerlink" href="#states-of-wcm" title="Permalink to this heading"></a></h2>
<p>All the possible states of the WCM are defined as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>enum c_state {</p>
<p>C_INITIAL,</p>
<p>C_SCANNING,</p>
<p>C_AUTHENTICATING,</p>
<p>C_ASSOCIATING,</p>
<p>C_WAIT_4WAY,</p>
<p>C_WAIT_DHCP,</p>
<p>C_CONNECTED,</p>
<p>C_FAILED, };</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>The message pointer *msg has a message type associated with it.
msg-&gt;msg_type can have a value from the enum wcm_notify_msg_type,
containing message types of WCM. This will notify message callbacks as
shown:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>enum wcm_notify_msg_type {</p>
<p>/** WiFi link is up */</p>
<p>WCM_NOTIFY_MSG_LINK_UP = 200,</p>
<p>/** WiFi link is down */</p>
<p>WCM_NOTIFY_MSG_LINK_DOWN = 201,</p>
<p>/** Address has changed.</p>
<p>WCM_NOTIFY_MSG_ADDRESS = 202</p>
<p>};</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>If the notification WCM_NOTIFY_MSG_ADDRESS occurs, then the message
received is of the type wcm_address_event. The structure definition for
wcm_address_event is as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>struct wcm_address_event {</p>
<p>/** Message header */</p>
<p>struct os_msg iev_hdr;</p>
<p>/** Typically AF_INET or AF_INET6 */</p>
<p>unsigned int iev_af;</p>
<p>/** The address of up to 16 bytes (IPv6) */</p>
<p>unsigned char iev_address[0];</p>
<p>};</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>Address type and address data can be retrieved by typecasting the
message to struct wcm_address_event.</p>
</section>
</section>
<section id="source-code-walkthrough">
<h1>Source Code Walkthrough<a class="headerlink" href="#source-code-walkthrough" title="Permalink to this heading"></a></h1>
<section id="wifi-connect">
<h2>Wifi_Connect<a class="headerlink" href="#wifi-connect" title="Permalink to this heading"></a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h3>
<p>The sample code in the path <em>apps\using_wifi\src\wifi_connect.c</em>
showcases simple connecting to a network with the API
wifi_connect_to_network().</p>
<p><strong>Note:</strong> Upon disconnection of station (Talaria TWO module) from the AP
due to various reasons such as AP power off, module tries to reconnect
by sending a probe request packet. Each failed connection attempt will
increase the reconnect backoff time exponentially as 1, 2, 4, 8, 16, 32,
60 seconds.</p>
<p>After 60 seconds, module tries to reconnect indefinitely at every 60
seconds. Below sniffer capture shows Talaria TWO’s exponential
reconnection method.</p>
<p><a class="reference internal" href="../_images/image21.png"><img alt="image1" src="../_images/image21.png" style="width: 5.90556in; height: 1.47292in;" /></a></p>
<p>Figure 2: Sniffer Capture – Wi-Fi Reconnection</p>
<p><a class="reference internal" href="../_images/image31.png"><img alt="image2" src="../_images/image31.png" style="width: 3.14931in; height: 2.88958in;" /></a></p>
<p>Figure 3: Talaria TWO Console Logs – Wi-Fi Reconnection</p>
</section>
<section id="sample-code-walkthrough">
<h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough" title="Permalink to this heading"></a></h3>
<p>To connect to a Wi-Fi network, wcm_create()API from the Wi-Fi Connection
Manager is used. Initially, the Wi-Fi network interface is created using
wcm_create().</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>h = wcm_create(NULL);</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wcm_set_hostname() API is used to set the host name in DHCP client. It
is used for identifying the client device (Talaria TWO) in the
network/AP.</p>
<p>Note: Default host name of Talaria TWO is talaria2.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>if(host_name != NULL)</p>
<p>wcm_set_hostname(wcm_handle, host_name);</p>
<p>host_name = wcm_get_hostname(wcm_handle);</p>
<p>os_printf(“host name %s\n”, host_name);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wifi_connect_to_network()API, from components library, connects to the
Wi-Fi network using the AP credentials provided.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>rval = wifi_connect_to_network(&amp;h, WCM_CONN_WAIT_INFINITE,
&amp;wcm_connect_success);</p>
<p>if(rval &lt; 0) {</p>
<p>os_printf(”\nError: Unable to connect to network\n”);</p>
<p>return 0;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application">
<h3>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this heading"></a></h3>
<p>Program wifi_connect.elf(<em>sdk_x.y\examples\using_wifi\bin</em>)using the
Download tool(<em>sdk_x.y\pc_tools\Download_Tool</em>)provided with InnoPhase
Talaria TWO SDK.</p>
<ol class="arabic simple">
<li><p>Launch the Download tool.</p></li>
</ol>
<ol class="arabic">
<li><p>In the GUI window:</p>
<ol class="loweralpha simple">
<li><p>Boot Target: Select the appropriate EVK from the drop-down.</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>ELF Input: Load the wifi_connect.elf by clicking on Select ELF
File.</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>AP Options: Pass the appropriate SSID and passphrase to connect to
an Access Point.</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>Boot Arguments: Add the host name as a boot argument.</p></li>
</ol>
</li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>host_name=&lt;host_name&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Note: Default host name is talaria2.</p>
</div></blockquote>
<ol class="loweralpha simple">
<li><p>Programming: Prog RAM or Prog Flash as per requirement.</p></li>
</ol>
<p>For more details on using the Download tool, refer to the document:
UG_Download_Tool.pdf (path: <em>sdk_x.y\pc_tools\Download_Tool\doc</em>).</p>
<p><strong>Note</strong>: x and y refer to the SDK release version. For example:
sdk_2.4\doc.</p>
</section>
<section id="expected-output">
<h3>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h3>
<p>wifi_connect.elf execution displays the following output on the console
for different scenarios:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWAEBuild $Id: git-d198c0771 $</p>
<p>np_conf_path=/data/nprofile.json ssid=InnoPhase <a class="reference external" href="mailto:passphrase=Inno&#37;&#52;&#48;1234">passphrase=Inno<span>&#64;</span>1234</a></p>
<p>$App:git-200f5dc1</p>
<p>SDK Ver: sdk_2.6.2</p>
<p>Wifi Connect Demo App</p>
<p>addr e0:69:3a:00:2d:fc</p>
<p>host name talaria2</p>
<p>Connecting to added network : InnoPhase</p>
<p>[0.987,027] CONNECT:98:da:c4:73:b7:76 Channel:10 rssi:-45 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[1.261,104] MYIP 192.168.1.222</p>
<p>[1.261,268] IPv6 [fe80::e269:3aff:fe00:2dfc]-link</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_CONNECTED</p>
<p>Connected to added network : InnoPhase</p>
<p>———— Program Exit ——————-</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="wifi-connect-disconnect">
<h2>Wifi_Connect_Disconnect<a class="headerlink" href="#wifi-connect-disconnect" title="Permalink to this heading"></a></h2>
<section id="overview-1">
<span id="id1"></span><h3>Overview<a class="headerlink" href="#overview-1" title="Permalink to this heading"></a></h3>
<p>Sample code in the path:</p>
<p><em>apps\using_wifi\src\wifi_connect_disconnect.c</em> showcases connecting
to and disconnecting from a network asynchronously with the API
wcm_auto_connect() and wcm_add_network_profile().</p>
</section>
<section id="sample-code-walkthrough-1">
<span id="id2"></span><h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-1" title="Permalink to this heading"></a></h3>
<p>This example code initializes two semaphores and creates two threads.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/* initializes the semaphores */</p>
<p>os_sem_init( &amp;my_sem1, 0 );</p>
<p>os_sem_init( &amp;my_sem2, 0 );</p>
<p>/* creates a thread */</p>
<p>thread1 = os_create_thread(“thread1”, my_app_thread_func1,</p>
<p>(void*)my_arg1, MY_APP_THREAD_PRIO, MY_APP_THREAD_STACK_SIZE);</p>
<p>/* creates a thread */</p>
<p>thread2 = os_create_thread(“thread2”, my_app_thread_func2,</p>
<p>(void*)my_arg2, MY_APP_THREAD_PRIO, MY_APP_THREAD_STACK_SIZE);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>thread2 on running enters a loop where it first waits for a semaphore
from thread1.</p>
<p>thread1 on running attempts wcm_add_network_profile()and
wcm_auto_connect()with param bool enable as 1 to connect, and waits for
10 seconds and finally enters a loop where it:</p>
<ol class="arabic simple">
<li><p>calls wcm_auto_connect()with param bool enable as 0 to asynchronously
disconnect, without removing the network</p></li>
<li><p>waits for 10 seconds and unblocks thread2 by posting a semaphore</p></li>
<li><p>Finally waits on a semaphore posted from thread2, before looping back
again to asynchronously disconnect attempt using wcm_auto_connect().</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/*the thread function */</p>
<p>static void* my_app_thread_func1(void* arg)</p>
<p>{</p>
<p>os_printf(“thread1 prints – %s\n”, (char*)arg);</p>
<p>/*Create a Wi-Fi network interface*/</p>
<p>my_wcm_handle = wcm_create(NULL);</p>
<p>wcm_notify_enable(my_wcm_handle, my_wcm_notify_cb, NULL);</p>
<p>/*”/data/nprofile.json”*/</p>
<p>const char *np_conf_path = os_get_boot_arg_str(“np_conf_path”)?:
NULL;</p>
<p>struct network_profile *profile;</p>
<p>int rval;</p>
<p>if (np_conf_path != NULL) {</p>
<p>/* Create a Network Profile from a configuration file in</p>
<p>*the file system*/</p>
<p>rval = network_profile_new_from_file_system(&amp;profile, np_conf_path);</p>
<p>} else {</p>
<p>/* Create a Network Profile using BOOT ARGS*/</p>
<p>rval = network_profile_new_from_boot_args(&amp;profile);</p>
<p>}</p>
<p>if (rval &lt; 0) {</p>
<p>pr_err(“could not create network profile %d\n”, rval);</p>
<p>return NULL;</p>
<p>}</p>
<p>rval = wcm_add_network_profile(my_wcm_handle, profile);</p>
<p>if (rval &lt; 0) {</p>
<p>pr_err(“could not associate network profile to wcm %d\n”, rval);</p>
<p>return NULL;</p>
<p>}</p>
<p>os_sleep_us(2000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>os_printf(“thread1 prints – calling api wcm_auto_connect(1) to
connect to already added network\n”);</p>
<p>wcm_auto_connect(my_wcm_handle, 1);</p>
<p>os_printf(“thread1 prints – will try a disconnect after 10
seconds… \n”);</p>
<p>os_sleep_us(10000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>while(1){</p>
<p>os_printf(“thread1 prints – calling api wcm_auto_connect(0) to just
disconnect without removing network..\n”);</p>
<p>wcm_auto_connect(my_wcm_handle, 0);</p>
<p>os_sleep_us(10000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>/*unlock Thread2 */</p>
<p>os_sem_post( &amp;my_sem2 );</p>
<p>/*block until thread 2 unblocks us */</p>
<p>os_sem_wait( &amp;my_sem1 );</p>
<p>}</p>
<p>return NULL;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>As noted earlier, thread2 is in a loop, and when unblocked:</p>
<ol class="arabic simple">
<li><p>Calls wcm_auto_connect()with param bool enable as 1 to asynchronously
connect to previously added network</p></li>
<li><p>waits for 10 seconds and unblocks thread1 by posting a semaphore</p></li>
<li><p>enters its loop again where it finally waits on a semaphore posted
from thread1, before trying to asynchronously connect attempt using
wcm_auto_connect().</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>/* the thread function */</p>
<p>static void* my_app_thread_func2(void* arg)</p>
<p>{</p>
<p>os_sleep_us(5000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>os_printf(“thread2 prints – %s\n”, (char*)arg);</p>
<p>while(1){</p>
<p>/*block until thread 1 unblocks us */</p>
<p>os_sem_wait( &amp;my_sem2 );</p>
<p>os_printf(“thread2 prints – calling api wcm_auto_connect(1) to
connect to already added network\n”);</p>
<p>wcm_auto_connect(my_wcm_handle, 1);</p>
<p>os_sleep_us(10000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>/*unlock Thread1 */</p>
<p>os_sem_post( &amp;my_sem1 );</p>
<p>}</p>
<p>return NULL;</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>In this example, the Talaria TWO module connects and disconnects from
the network approximately every 10 seconds without removing the network
name.</p>
<p>Notifications from WCM are registered and gets printed just like the
previous example.</p>
</section>
<section id="running-the-application-1">
<span id="id3"></span><h3>Running the Application<a class="headerlink" href="#running-the-application-1" title="Permalink to this heading"></a></h3>
<p>Program wifi_connect_diconnect.elf
(<em>sdk_x.y\examples\using_wifi\bin</em>) using the Download tool
(<em>sdk_x.y\pc_tools\Download_Tool</em>) provided with InnoPhase Talaria TWO
SDK.</p>
<p>Refer steps mentioned in section 8.1.3 for more details.</p>
</section>
<section id="pmk-caching">
<h3>PMK Caching<a class="headerlink" href="#pmk-caching" title="Permalink to this heading"></a></h3>
<p>When Talaria TWO connects to an Access Point, the PMK generated after
802.1X authentication method will be stored in Talaria TWO’s flash and
this cached PMK will be used for subsequent connections.</p>
<p>This ensures minimal connection latency between the Access Point and
Talaria TWO as it avoids recomputing of PMK for each connection. PMK
cache feature is supported only on WPA2-PSK or Mixed mode.</p>
</section>
<section id="expected-output-1">
<span id="id4"></span><h3>Expected Output<a class="headerlink" href="#expected-output-1" title="Permalink to this heading"></a></h3>
<p>wifi_connect_disconnect.elf execution displays the following output on
the console for different scenarios:</p>
<section id="case-1">
<h4>Case 1<a class="headerlink" href="#case-1" title="Permalink to this heading"></a></h4>
<p>AP is already ON at connection attempt, connect success, alternate
connect disconnect with autoconnect API, and add network and remove
network, as expected. Background notifications are received.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>Build $Id: git-d198c0771 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWAEBuild $Id: git-d198c0771 $</p>
<p>np_conf_path=/data/nprofile.json ssid=Asus_CC_2G1 passphrase=12345678</p>
<p>SDK Ver: sdk_2.6.2</p>
<p>Wifi Async Connect Demo App</p>
<p>thread1 prints – application thread1 will attempt
wcm_add_network_profile() and wcm_auto_connect(1) and then disconnect
with wcm_auto_connect(0) 10 seconds after every connection</p>
<p>addr e0:69:3a:00:01:05</p>
<p>thread1 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>thread1 prints – will try a disconnect after 10 seconds…</p>
<p>[2.730,711] CONNECT:24:4b:fe:5e:fd:d8 Channel:1 rssi:-36 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>[2.769,323] MYIP 192.168.1.4</p>
<p>[2.769,486] IPv6 [fe80::e269:3aff:fe00:105]-link</p>
<p>thread2 prints – application thread2 will attempt connect using
wcm_auto_connect(1).</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_DOWN</p>
<p>[12.209,898] DISCONNECTED</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[22.255,835] CONNECT:24:4b:fe:5e:fd:d8 Channel:1 rssi:-37 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[22.303,722] MYIP 192.168.1.4</p>
<p>[22.304,002] IPv6 [fe80::e269:3aff:fe00:105]-link</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_DOWN</p>
<p>[32.210,984] DISCONNECTED</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[42.253,134] CONNECT:24:4b:fe:5e:fd:d8 Channel:1 rssi:-37 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[42.296,531] MYIP 192.168.1.4</p>
<p>[42.296,694] IPv6 [fe80::e269:3aff:fe00:105]-link</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="case-2">
<h4>Case 2<a class="headerlink" href="#case-2" title="Permalink to this heading"></a></h4>
<p>AP is already ON at connection attempt, wrong password given, connect
failure, alternate connect disconnect and add network and remove network
as expected, without any thread hanging.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>Build $Id: git-d198c0771 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>[9.230,063] partitions mounted</p>
<p>UART:SNWWWWAE</p>
<p>Build $Id: git-d198c0771 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWAEBuild $Id: git-d198c0771 $</p>
<p>np_conf_path=/data/nprofile.json ssid=Asus_CC_2G1
passphrase=123456789</p>
<p>SDK Ver: sdk_2.6.2</p>
<p>Wifi Async Connect Demo App</p>
<p>thread1 prints – application thread1 will attempt
wcm_add_network_profile() and wcm_auto_connect(1) and then disconnect
with wcm_auto_connect(0) 10 seconds after every connection</p>
<p>addr e0:69:3a:00:01:05</p>
<p>thread1 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>thread1 prints – will try a disconnect after 10 seconds…</p>
<p>[2.741,498] CONNECT:24:4b:fe:5e:fd:d8 Channel:6 rssi:-34 dBm</p>
<p>thread2 prints – application thread2 will attempt connect using
wcm_auto_connect(1).</p>
<p>[10.742,444] DISCONNECTED during key negotiation, wrong key?</p>
<p>[10.764,455] Trying to connect in 2 seconds</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[22.378,399] CONNECT:24:4b:fe:5e:fd:d8 Channel:6 rssi:-34 dBm</p>
<p>[30.378,648] DISCONNECTED during key negotiation, wrong key?</p>
<p>[30.400,425] Trying to connect in 2 seconds</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[42.375,801] CONNECT:24:4b:fe:5e:fd:d8 Channel:6 rssi:-33 dBm</p>
<p>[50.376,281] DISCONNECTED during key negotiation, wrong key?</p>
<p>[50.397,366] Trying to connect in 2 seconds</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="case-3">
<h4>Case 3<a class="headerlink" href="#case-3" title="Permalink to this heading"></a></h4>
<p>AP is switched OFF at connection attempt, alternate connect disconnect
and add network and remove network as expected, without any thread
hanging.</p>
<blockquote>
<div><p>Later, AP is switched ON, connect success, alternate connect
disconnect and add remove as expected.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWAE</p>
<p>Build $Id: git-d198c0771 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>[9.426,279] partitions mounted</p>
<p>UART:SNWWWWAE</p>
<p>Build $Id: git-d198c0771 $</p>
<p>hio.baudrate=921600</p>
<p>flash: Gordon ready!</p>
<p>Y-BOOT 208ef13 2019-07-22 12:26:54 -0500 790da1-b-7</p>
<p>ROM yoda-h0-rom-16-0-gd5a8e586</p>
<p>FLASH:PNWWWWWAEBuild $Id: git-d198c0771 $</p>
<p>np_conf_path=/data/nprofile.json ssid=Asus_CC_2G1 passphrase=12345678</p>
<p>SDK Ver: sdk_2.6.2</p>
<p>Wifi Async Connect Demo App</p>
<p>thread1 prints – application thread1 will attempt
wcm_add_network_profile() and wcm_auto_connect(1) and then disconnect
with wcm_auto_connect(0) 10 seconds after every connection</p>
<p>addr e0:69:3a:00:01:05</p>
<p>thread1 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>thread1 prints – will try a disconnect after 10 seconds…</p>
<p>[2.742,962] CONNECT:24:4b:fe:5e:fd:d8 Channel:6 rssi:-34 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[4.689,892] MYIP 192.168.1.4</p>
<p>[4.690,055] IPv6 [fe80::e269:3aff:fe00:105]-link</p>
<p>thread2 prints – application thread2 will attempt connect using
wcm_auto_connect(1).</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_DOWN</p>
<p>[12.205,311] DISCONNECTED</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[22.613,616] Trying to connect in 1 seconds</p>
<p>[23.739,080] Trying to connect in 2 seconds</p>
<p>[25.864,544] Trying to connect in 4 seconds</p>
<p>[29.990,008] Trying to connect in 8 seconds</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[42.717,590] Trying to connect in 1 seconds</p>
<p>[43.843,054] Trying to connect in 2 seconds</p>
<p>[45.968,518] Trying to connect in 4 seconds</p>
<p>[50.093,983] Trying to connect in 8 seconds</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>thread2 prints – calling api wcm_auto_connect(1) to connect to
already added network</p>
<p>[62.389,674] CONNECT:24:4b:fe:5e:fd:d8 Channel:6 rssi:-33 dBm</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_UP</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_ADDRESS</p>
<p>[62.503,180] MYIP 192.168.1.4</p>
<p>[62.503,635] IPv6 [fe80::e269:3aff:fe00:105]-link</p>
<p>thread1 prints – calling api wcm_auto_connect(0) to just disconnect
without removing network..</p>
<p>wcm_notify_cb to App Layer - WCM_NOTIFY_MSG_LINK_DOWN</p>
<p>[72.207,219] DISCONNECTED</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="wi-fi-scan">
<h2>Wi-Fi Scan<a class="headerlink" href="#wi-fi-scan" title="Permalink to this heading"></a></h2>
<section id="overview-2">
<span id="id5"></span><h3>Overview<a class="headerlink" href="#overview-2" title="Permalink to this heading"></a></h3>
<p>The sample code in the path <em>example\using_wifi\src\wifi_scan.c</em>
scans for available Wi-Fi networks and prints them out.</p>
<p>Following are the steps:</p>
<ol class="arabic simple">
<li><p>Create a data structure to store the parameters and results of scan.</p></li>
<li><p>Set the default parameter for scanning using the API
wifi_init_scan_default()</p></li>
<li><p>In a loop, let the code scan and print the nearby networks from
vicinity for every 10 second interval of time.</p></li>
</ol>
</section>
<section id="sample-code-walkthrough-2">
<span id="id6"></span><h3>Sample Code Walkthrough<a class="headerlink" href="#sample-code-walkthrough-2" title="Permalink to this heading"></a></h3>
<p>The necessary data structures to store parameters and result of scan are
created as shown:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>int main(void)</p>
<p>{</p>
<p>struct wcm_handle *h;</p>
<p>const size_t max_nets = 64;</p>
<p>struct wifi_netinfo **scan_result;</p>
<p>struct wifi_scan_param param;</p>
<p>…</p>
<p>…</p>
<p>…</p>
<p>scan_result = os_alloc(max_nets * sizeof(void *));</p>
<p>assert(scan_result != NULL);</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>wifi_init_scan_default()API is used to set the default parameters for
the scanning, and wcm_scan() is used with explained parameters to start
scanning.</p>
<p>The example code runs in a loop, scans and prints the results using
wifi_netinfo_get_ssid() and wifi_netinfo_get_chan(), frees up the memory
allocated for scan result using wcm_free_scanresult() and waits for 10
seconds before scanning and printing again as shown in the following
code:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wifi_init_scan_default(&amp;param);</p>
<p>// print scan parameters</p>
<p>print_scan_params(param);</p>
<p>for (;;) {</p>
<p>// perform scan</p>
<p>int n = wcm_scan(h, &amp;param, scan_result, max_nets);</p>
<p>// print out results of scan</p>
<p>os_printf(“Found %d nets:\n”, n);</p>
<p>for (int i = 0; i &lt; n; i++) {</p>
<p>uint8_t chan;</p>
<p>struct wifi_ssid ssid;</p>
<p>wifi_netinfo_get_ssid(scan_result[i], &amp;ssid);</p>
<p>wifi_netinfo_get_chan(scan_result[i], &amp;chan);</p>
<p>os_printf(“%6pM on channel %2d &#64; %3d ‘%s’\n”,</p>
<p>scan_result[i]-&gt;ni_bssid, chan, scan_result[i]-&gt;ni_rssi,
ssid.ws_ssid);</p>
<p>}</p>
<p>wcm_free_scanresult(scan_result, n);</p>
<p>os_sleep_us(10000000, OS_TIMEOUT_NO_WAKEUP);</p>
<p>}</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-application-2">
<span id="id7"></span><h3>Running the Application<a class="headerlink" href="#running-the-application-2" title="Permalink to this heading"></a></h3>
<p>Program wifi_scan.elf (<em>sdk_x.y\examples\using_wifi\bin</em>)using the
Download tool(<em>sdk_x.y\pc_tools\Download_Tool</em>)provided with InnoPhase
Talaria TWO SDK.</p>
<p>Refer steps mentioned in section 8.1.3 for more details.</p>
</section>
<section id="expected-output-2">
<span id="id8"></span><h3>Expected Output<a class="headerlink" href="#expected-output-2" title="Permalink to this heading"></a></h3>
<p>wifi_scan.elf execution displays the following output on the console for
different scenarios:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>UART:SNWWWWWAEBuild $Id: git-ba65998b7 $</p>
<p>np_conf_path=/data/nprofile.json ssid=InnoPhase passphrase=43083191</p>
<p>SDK Ver: sdk_2.5</p>
<p>Wifi Scan Demo App</p>
<p>addr e0:69:3a:00:13:90</p>
<p>Scan parameters:</p>
<p>channel_masks: 255 255 255 255 255 255 255 255</p>
<p>bssid: 0xFFFFFFFFFFFF</p>
<p>txrate: 0</p>
<p>waittime: 0</p>
<p>ie list: 0x</p>
<p>Found 6 nets:</p>
<p>6e:8a:ce:99:b1:c8 on channel 6 &#64; -39 ‘Inno’ ‘OPEN’</p>
<p>00:5f:67:cd:c5:a6 on channel 11 &#64; -46 ‘InnoPhase’ ‘WPA2-PSK’</p>
<p>e4:a7:c5:d4:ea:86 on channel 6 &#64; -74 ‘Airtel-E5573-EA86’ ‘WPA2-PSK’</p>
<p>70:4f:57:77:7e:d4 on channel 2 &#64; -74 ‘Rahul’ ‘WPA2-PSK’</p>
<p>d8:0f:99:72:13:65 on channel 5 &#64; -79 ‘JioFi3_721365’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>d8:47:32:2e:e1:e0 on channel 11 &#64; -80 ‘GPMH’ ‘WPA2-PSK’</p>
<p>Found 7 nets:</p>
<p>6e:8a:ce:99:b1:c8 on channel 6 &#64; -34 ‘Inno’ ‘OPEN’</p>
<p>00:5f:67:cd:c5:a6 on channel 11 &#64; -46 ‘InnoPhase’ ‘WPA2-PSK’</p>
<p>ba:6b:ad:62:6d:8b on channel 11 &#64; -72 ‘DESKTOP-9B1DNVC 1786’
‘WPA2-PSK’</p>
<p>34:0a:33:70:f3:a2 on channel 1 &#64; -76 ‘Siddusm’ ‘WPA2-PSK’</p>
<p>dc:71:37:56:91:b0 on channel 8 &#64; -77 ‘Hathway_Raghuram’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>d8:0f:99:72:13:65 on channel 5 &#64; -78 ‘JioFi3_721365’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>ac:84:c6:88:10:46 on channel 13 &#64; -85 ‘Lakshmi pg 3rd floor ‘
‘WPA2-PSK’</p>
<p>Found 6 nets:</p>
<p>6e:8a:ce:99:b1:c8 on channel 6 &#64; -33 ‘Inno’ ‘OPEN’</p>
<p>00:5f:67:cd:c5:a6 on channel 11 &#64; -47 ‘InnoPhase’ ‘WPA2-PSK’</p>
<p>ba:6b:ad:62:6d:8b on channel 11 &#64; -71 ‘DESKTOP-9B1DNVC 1786’
‘WPA2-PSK’</p>
<p>d8:0f:99:72:13:65 on channel 5 &#64; -77 ‘JioFi3_721365’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
<p>b0:a7:b9:73:8e:51 on channel 4 &#64; -78 ‘Lakshmi pg 2nd floor 2g’
‘WPA2-PSK’</p>
<p>dc:71:37:56:91:b0 on channel 8 &#64; -79 ‘Hathway_Raghuram’
‘WPA-PSK/WPA2-PSK Mixed Mode’</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
</section>
<section id="power-optimization-with-rx-nap-scan">
<h3>Power Optimization with Rx Nap Scan<a class="headerlink" href="#power-optimization-with-rx-nap-scan" title="Permalink to this heading"></a></h3>
<p>In a crowded environment, Rx Nap Scan feature can be enabled to save
power during the scan process. In this mode, the Rx nap function will
turn the Talaria TWO’s receiver OFF (<em>takes a nap</em>) for the duration of
the frame when there are uninteresting frames with high signal strength.
The frames of interest are probe responses and beacon frames.</p>
<p>This mode is enabled by default in wifi_scan.elf and can be disabled
using the following boot argument:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>wifi.nap_scan=0</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>As shown in Figure 4, Talaria TWO takes naps when there are
uninteresting frames. During the naps, current consumption dips to 8mA
whereas during the scan period, the average Rx current remains at ~33mA.</p>
<p><a class="reference internal" href="../_images/image41.png"><img alt="image3" src="../_images/image41.png" style="width: 5.90556in; height: 2.95069in;" /></a></p>
<p>Figure 4: Talaria TWO naps during uninteresting frames</p>
<p>Rx nap scan mode disabled is as shown in Figure 5.</p>
<p><a class="reference internal" href="../_images/image51.png"><img alt="image4" src="../_images/image51.png" style="width: 5.90556in; height: 2.93611in;" /></a></p>
<p>Figure 5: Rx nap scan mode disabled</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Timers%20and%20Callouts.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Watchdog%20Timer.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 InnoPhase IoT, Inc. | All Rights Reserved | Proprietary &amp; Confidential.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>